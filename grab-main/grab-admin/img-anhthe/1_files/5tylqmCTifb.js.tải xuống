;/*FB_PKG_DELIM*/

__d("LSBumpE2EEMetadataThread",["LSCancelTaskByQueueName","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return d[0]=new c.Map(),d[0].set("bump_timestamp_ms",a[1]),d[0].set("thread_key",a[0]),d[0].set("bumped_by_local_device_send",a[2]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[0].set("wa_jid",f),d[0].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[0].set("message_product_type",f),d[0].set("is_message_deletion",!1),d[1]=d[0].get("thread_key"),d[0],c.sp(b("LSCancelTaskByQueueName"),c.i64.to_string(d[1]),c.i64.cast([0,389]))},function(e){return d[2]=new c.Map(),d[2].set("bump_timestamp_ms",a[1]),d[2].set("thread_key",a[0]),d[2].set("bumped_by_local_device_send",a[2]),d[2].set("tam_thread_subtype",c.i64.cast([0,0])),d[2].set("wa_jid",f),d[2].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[2].set("message_product_type",f),d[2].set("is_message_deletion",!1),d[3]=d[2].get("thread_key"),d[2],d[4]=c.toJSON(d[2]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,389]),d[4],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSBumpE2EEMetadataThreadStoredProcedure",["LSBumpE2EEMetadataThread"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.serverAuthoritativeTimestampMs;d[2]=b.bumpedByLocalDeviceSend;return c("LSBumpE2EEMetadataThread").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSCreateE2EEMetadataThread",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return d[0]=new c.Map(),d[0].set("wa_jid",a[0]),d[0].set("offline_thread_key",a[1]),d[0].set("thread_type",a[2]),d[0].set("folder_type",a[3]),d[0].set("bump_timestamp_ms",a[4]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[1]=d[0].get("offline_thread_key"),d[0],d[2]=c.toJSON(d[0]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,388]),d[2],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSCreateE2EEMetadataThreadStoredProcedure",["LSCreateE2EEMetadataThread"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.waJid;d[1]=b.offlineThreadKey;d[2]=b.threadType;d[3]=b.folderType;d[4]=b.bumpTimestampMs;return c("LSCreateE2EEMetadataThread").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSScheduleOccamThreadsIntegrityCheckerStoredProcedure",["LSScheduleOccamThreadsIntegrityChecker"],(function(a,b,c,d,e,f,g){function a(a,b){b===void 0&&(b={});var d=[];d[0]=b.delayMs;d[1]=b.maxThreadCount;return c("LSScheduleOccamThreadsIntegrityChecker").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSUpdateE2EEMetadataParticipants",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[1]=d[0].get("thread_key"),d[0],d[2]=c.toJSON(d[0]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,394]),d[2],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSUpdateE2EEMetadataParticipantsStoredProcedure",["LSUpdateE2EEMetadataParticipants"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;return c("LSUpdateE2EEMetadataParticipants").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSClearMessagePlaceholderRangeStoredProcedure",["LSClearMessagePlaceholderRange"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.messageId;d[2]=b.maxTimestampMs;return c("LSClearMessagePlaceholderRange").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSCreateOfflineThreadingIDStoredProcedure",["LSCreateOfflineThreadingID"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.timestampMs;return c("LSCreateOfflineThreadingID").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSInsertNewMessageRangeStoredProcedure",["LSInsertNewMessageRange"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.newMinTs;d[2]=b.newMaxTs;d[3]=b.newMinMid;d[4]=b.newMaxMid;d[5]=b.lowerOverlap;d[6]=b.upperOverlap;d[7]=b.hasMoreBefore;d[8]=b.hasMoreAfter;d[9]=b.requestedMessageId;return c("LSInsertNewMessageRange").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSUpsertAttachmentRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.seq([function(c){return b.fe(b.db.table(17).fetch([[[a[0],a[1]]]]),function(a){return a["delete"]()})},function(c){return b.db.table(17).add({threadKey:a[0],mediaGroup:a[1],minTimestampMs:a[2],maxTimestampMs:b.i64.cast([2328,1316134911]),hasMoreBefore:a[3],hasMoreAfter:!1,isLoadingBefore:!1,isLoadingAfter:!1})}])},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSUpsertAttachmentRangeStoredProcedure",["LSUpsertAttachmentRange"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.mediaGroup;d[2]=b.newMinTs;d[3]=b.hasMoreBefore;return c("LSUpsertAttachmentRange").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MAWCatQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="6303045499794432"}),null);
__d("MAWCatQuery.facebook.graphql",["MAWCatQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{alias:null,args:null,concreteType:"SecureMessageOverWACATGraphResult",kind:"LinkedField",name:"secure_message_over_wa_cat_query",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_serialized_cat",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"expiration_time_in_seconds",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MAWCatQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"MAWCatQuery",selections:a},params:{id:b("MAWCatQuery_facebookRelayOperation"),metadata:{},name:"MAWCatQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("MAWCatQuery.graphql",["cr:11203"],(function(a,b,c,d,e,f){"use strict";e.exports=b("cr:11203")}),null);
__d("MAWCatQuery",["MAWCatQuery.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h!==void 0?h:h=b("MAWCatQuery.graphql");c=a;g["default"]=c}),98);
__d("MAWDbContact",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;f.NON_CONTACT=a;f.ONE_WAY_CONTACT=b;f.REVERSED_ONE_WAY_CONTACT=c;f.TWO_WAY_CONTACT=d}),66);
__d("MAWCryptoAuthToken",["FBLogger","MAWCatQuery","RelayHooks"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a==null||a.secure_message_over_wa_cat_query==null||a.secure_message_over_wa_cat_query.encrypted_serialized_cat==null||a.secure_message_over_wa_cat_query.expiration_time_in_seconds==null?{error:"Crypto Auth Token was null or incomplete"}:{success:{encrypted_serialized_cat:a.secure_message_over_wa_cat_query.encrypted_serialized_cat,expiration_time_in_seconds:a.secure_message_over_wa_cat_query.expiration_time_in_seconds}}}function a(a){return d("RelayHooks").fetchQuery(a,c("MAWCatQuery"),{}).toPromise().then(h).then(function(a){if(a.error!==null&&a.error!==void 0)throw c("FBLogger")("mpf_web_foundations").mustfixThrow("[MAWCryptoAuthToken] Error while fetching CAT from GraphQL: %s",a.error);return a.success})}g.fetchFreshCAT=a}),98);
__d("MAWClientConsistencyRefresh",["ClientConsistencyEventEmitter","CurrentUser"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(c("CurrentUser").getAppID()){case 772021112871879:c("ClientConsistencyEventEmitter").emit("hardRefresh",a);break;default:c("ClientConsistencyEventEmitter").emit("softRefresh",a)}}g["default"]=a}),98);
__d("WAShiftTimer",["WAErr"],(function(a,b,c,d,e,f,g){a=function(){function a(a){var b=this;this.$2=0;this.$3=0;this.ts=0;this.$4=0;this.$5=0;this.$6=0;this.$7=void 0;this.$8=function(){var a=b.$7,c=b.$1;b.$3=0;b.$2=0;b.ts=0;b.$4=0;b.$5=0;b.$6=0;b.$7=void 0;c(a)};this.onOrBefore=function(a,c){h(a);var d=Date.now();d=d+a;var e=b.$5;if(e!==0&&e<d)return;e=b.$6;if(e!==0&&d<e)return;b.$5=d;!b.$3&&(!b.$2||d<b.ts)&&b.$9(d,a,c)};this.forceRunNow=function(a){b.$2&&clearTimeout(b.$2),b.$3&&cancelAnimationFrame(b.$3),b.$7=a,b.$8()};this.cancel=function(){b.$2&&clearTimeout(b.$2),b.$3&&cancelAnimationFrame(b.$3),b.$2=0,b.$3=0,b.ts=0,b.$4=0,b.$5=0,b.$6=0,b.$7=void 0};this.$1=a}var b=a.prototype;b.onOrBeforeRepaint=function(a){if(this.$3)return;var b=Date.now(),c=this.$6;if(c!==0&&b<c)return;c=this.$5;(c===0||b<c)&&(this.$5=b);this.$2&&(clearTimeout(this.$2),this.$2=0);(!this.ts||this.ts>b)&&(this.ts=b);this.$7=a;this.$3=requestAnimationFrame(this.$8)};b.onOrAfter=function(a,b){h(a);var c=Date.now();c=c+a;var d=this.$6;if(d!==0&&c<d)return;d=this.$5;if(d!==0&&d<c)return;this.$6=c;(!this.$2||this.ts<c)&&this.$9(c,a,b)};b.debounce=function(a,b){h(a),this.$10(Date.now(),a,b)};b.debounceAndCap=function(a,b,c){h(a);h(b);var d=Date.now();b=d+b;var e=this.$6,f=this.$5;(e===0||e<=b)&&(f===0||b<f)&&(this.$5=b);this.$10(d,a,c)};b.forceRunNowIfScheduled=function(){this.$2?(clearTimeout(this.$2),this.$8()):this.$3&&(cancelAnimationFrame(this.$3),this.$8())};b.isScheduled=function(){return this.$2!==0||this.$3!==0};b.$10=function(a,b,c){var d=a+b,e=this.$6;if(e!==0&&d<e)return;e=this.ts;var f=this.$5;f!==0&&f<d?e<f&&this.$9(f,f-a,c):e<d&&this.$9(d,b,c)};b.$9=function(a,b,c){this.$3&&(cancelAnimationFrame(this.$3),this.$3=0);this.$7=c;this.ts=a;if(this.$2){c=a-this.$4;if(-16<c&&c<16)return;clearTimeout(this.$2)}this.$2=setTimeout(this.$8,b);this.$4=a};return a}();function h(a){if(!(a>=0))throw c("WAErr")("ShiftTimer must be given delay >= 0")}g.ShiftTimer=a}),98);
__d("WABridgeBatcher",["WAShiftTimer"],(function(a,b,c,d,e,f,g){var h=20,i=1e3;a=function(){function a(a,b){var c=this;this.$1=null;this.$4=h;this.$5=Date.now();this.$6=new(d("WAShiftTimer").ShiftTimer)(function(){var a=c.$1;if(a==null)return;c.$1=null;c.$2(a)});this.$2=b;this.$3=a}var b=a.prototype;b.addEvent=function(a){var b=this.$1;this.$1=b?this.$3(b,a):[a];if(this.$6.isScheduled())return;b=this.$4;if(b<1){a=Date.now();var c=Math.max(a-this.$5,0)/i;b=Math.min(b+c,h);this.$4=b;this.$5=a}b>=1?(c=0,this.$4=b-1):(c=Math.ceil(i*(1-b)),this.$4=0);this.$6.onOrBefore(c)};b.cancel=function(){this.$1=null,this.$6.cancel()};return a}();g.BridgeBatcher=a}),98);
__d("WACrossWorkerPortal",["Promise","WABridgeBatcher","WAErr","WALogger","WAPromiseManagement"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["absorbPortal: transferring request #",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unexpected non-result to call"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unexpected result to cast: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unrecognized result ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," response of ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," request for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge queuing "," msgs"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge sending "," across (delayed)"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge received msg on old port"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge updating port"]);r=function(){return a};return a}var s=function(){function a(a,b,c,e){var f=this;this.port=null;this.$2=1;this.openRequests=new Map();this.listeners=new Set();this.processedRequests=new Set();this.$1=a;this.sendStream=new(d("WABridgeBatcher").BridgeBatcher)(b,function(a){f.$3(a)});c.forEach(function(b){a.setNamespaceHandler(b,f.$4(b))});this.clientId=e}var e=a.prototype;e.$5=function(){var a=this.clientId!=null?this.clientId+"_":"";return""+a+this.$2++};e.$6=function(a){a=a.split("_");return a.length!==2?null:a[0]};e.addListener=function(a){var b=this;this.listeners.add(a);return function(){return b.listeners["delete"](a)}};e.setPort=function(a){var b=this;d("WALogger").LOG(r());this.port=a;this.sendStream.cancel();a.onmessage=function(c){if(b.port!==a){d("WALogger").WARN(q()).devConsole(c.data);return}c=c.data;if(!c||!Array.isArray(c))return;c.forEach(function(c){b.$7(c,"incoming"),b.$8(a,c)})};this.openRequests.forEach(function(a){a=a.request;d("WALogger").LOG(p(),a.name);b.sendStream.addEvent({type:"request",content:a})})};e.getBridge=function(){return this.$1};e.$4=function(a){var b=this;return function(c,d,e,f){b.$9(a,c,d,e,f)}};e.$9=function(a,b,c,d,e){var f=this.$5();a={requestId:f,expectsResponse:!!d,namespace:a,name:b,arg:c,silentLog:e};this.openRequests.set(f,{request:a,resolver:d});this.sendStream.addEvent({type:"request",content:a})};e.$10=function(a,b){if(a!==this.port)return;this.sendStream.addEvent({type:"result",content:b})};e.$3=function(a){var b=this,c=this.port;if(!c){d("WALogger").LOG(o(),a.length);return}c.postMessage(a);a.forEach(function(a){return b.$7(a,"outgoing")})};e.$7=function(a,b){this.listeners.forEach(function(c){return c(a,b)})};e.$8=function(a,e){var f=this;if(e.type==="request"){var g=e.content,i=g.namespace,o=g.name,p=g.requestId,q=g.arg,r=g.expectsResponse,s=g.silentLog;s||d("WALogger").LOG(n(),p,o);g=this.$1;if(r){r=g.sendAndReceive(i,o,q,s).then(function(b){f.$10(a,{requestId:p,type:"success",result:b,silentLog:s})},function(b){f.$10(a,{requestId:p,type:"error",result:String(b),silentLog:s})});d("WAPromiseManagement").preventGarbageCollection(r)}else{g.fireAndForget(i,o,q,s);r={type:"result",content:{requestId:p,type:"handled",silentLog:s}};this.$7(r,"outgoing");a.postMessage([r])}}else{e.type;g=e.content;i=g.requestId;o=g.type;q=g.result;r=g.silentLog;r||d("WALogger").LOG(m(),i,o);e=this.$6(i);if(e!==this.clientId||this.processedRequests.has(i))return;g=this.openRequests.get(i);if(!g){d("WALogger").WARN(l(),i);return}switch(o){case"success":case"error":this.openRequests["delete"](i);this.processedRequests.add(i);r=g.resolver;r?r(o==="success"?q:(h||(h=b("Promise"))).reject(c("WAErr")(q))):d("WALogger").ERROR(k(),q);break;case"handled":g.resolver?d("WALogger").ERROR(j()):(this.openRequests["delete"](i),this.processedRequests.add(i));break}}};return a}();function a(a,b,c,d){return new s(a,c,b,d)}function e(a){var b;(b=a.port)==null?void 0:b.close();a.port=null;a.sendStream.cancel();b=a.openRequests;a.openRequests=new Map();var c=a.getBridge();b.forEach(function(a){var b=a.request;a=a.resolver;var e=b.namespace,f=b.name,g=b.arg,h=b.silentLog;d("WALogger").LOG(i(),b.requestId);a?a(c.sendAndReceive(e,f,g,h)):c.fireAndForget(e,f,g,h)})}g.CrossWorkerPortal=s;g.attachPortal=a;g.killPortalAndSendPendingToBridge=e}),98);
__d("MAWCrossWorkerPortal",["FBLogger","WACrossWorkerPortal","pageID"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){if(h!=null)return h;h=d("WACrossWorkerPortal").attachPortal(a,b,e,c("pageID"));return h}function b(){if(h==null){c("FBLogger")("messenger_e2ee_web").warn("Trying to kill portal before its setup");return}d("WACrossWorkerPortal").killPortalAndSendPendingToBridge(h)}g.getOrCreateCrossWorkerPortal=a;g.killPortalWhenWorkerTerminating=b}),98);
__d("MAWLoggerUtils",[],(function(a,b,c,d,e,f){"use strict";a={CleanerPurge:"CleanerPurge",CleanerStart:"CleanerStart",CleanerTimestamp:"CleanerTimestamp",CleanerUpdate:"CleanerUpdate",Countdown:"Countdown",Ephemeral:"Ephemeral",Incoming:"Incoming",MsgCleaner:"MsgCleaner",OnLoad:"OnLoad",OnRead:"OnRead",Outgoing:"Outgoing",PeerReceipt:"PeerReceipt",SettingChange:"SettingChange",SettingSync:"SettingSync",CryptoManager:"CryptoManager",SignedPrekey:"SignedPrekey",OneTimePrekey:"OneTimePrekey",DeviceRegistration:"DeviceRegistration",SignedPrekeyRotation:"SignedPrekeyRotation",PrekeyGenerateAndUpload:"PrekeyGenerateAndUpload",MessageReceive:"MessageReceive",MediaDownload:"MediaDownload",MediaPreview:"MediaPreview",WorkerSetup:"WorkerSetup",MAWWorker:"MAWWorker",MAWInit:"MAWInit",LogoutHandler:"LogoutHandler"};f.Tag=a}),66);
__d("WebWorkerV2Resource",["TrustedTypesWebWorkerScriptURLPolicy","WebWorkerV2DynamicData","XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder","forEachObject","getAsyncParamsFromCurrentPageURI","getWorkerInitScriptSPINParams","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(){if(h!=null)return h;var a={get type(){h=!0}};try{new Worker("blob://",a)}finally{h=(a=h)!=null?a:!1;return h}}function a(a,b){b=(b=b)!=null?b:a.name;a=i()?"module":"classic";var e=c("getWorkerInitScriptSPINParams")();c("forEachObject")(c("getAsyncParamsFromCurrentPageURI")(),function(a,b){e.set(b,a)});var f=c("nullthrows")(c("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder").buildUri({worker_type:i()?"MODULE":"CLASSIC"}).addQueryParams(e)).toString(),g=new Worker(c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(f),{name:b,type:a});c("promiseDone")(d("WebWorkerV2DynamicData").readDynamicDataForWorker(b).then(function(a){g.postMessage({type:"ww-hrp-init",hrp:a.hrp,js_env:a.js_env,is_dev:!1})}));return g}g.createDedicatedV2WebWorker=a}),98);
__d("WorkerBundleResource",["TrustedTypesWebWorkerScriptURLPolicy","XCometFBMultiSiteWebWorkerInitScriptControllerRouteBuilder","getWorkerInitScriptSPINParams","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var d,e,f;for(var g=arguments.length,h=new Array(g>2?g-2:0),i=2;i<g;i++)h[i-2]=arguments[i];var j=(d=b==null?void 0:b.logImportScriptsErrors)!=null?d:!1,k=(e=b==null?void 0:b.name)!=null?e:a.name,l=new window.URL(a.url,window.location.href).href;if(l==null){var m=new Error("Can't start up worker without a resource url.");m.stack;throw m}var n=c("nullthrows")((f=c("XCometFBMultiSiteWebWorkerInitScriptControllerRouteBuilder").buildUri({}).addQueryParams(c("getWorkerInitScriptSPINParams")()))==null?void 0:f.toString()),o=new Worker(c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(n),{name:k});o.postMessage({bundleUrl:l,initArgs:h,isDev:!1,resource:a,logImportScriptsErrors:j,type:"sr-init"});return o}g.createDedicatedWebWorker=a}),98);
__d("MAWWebWorkerSingleton",["FBLogger","MAWInit","MAWTTRCSafe","MAWWebWorkerInstance","Promise","SharedWorkerBundleResource","WAResolvable","WebWorkerV2Resource","WorkerBundleResource","cr:6600","err","gkx","promiseDone","qex","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MAWWebWorkerInstance").destroyWorkerInstance,j=new(d("WAResolvable").Resolvable)();function k(a,b){c("FBLogger")("messenger_e2ee_web").mustfix("[MAWWebWorkerSingletonAsync Script Import Error: "+a+"]: %s:%s:%s:%s",JSON.stringify(b==null?void 0:b.message),b==null?void 0:b.lineno,b==null?void 0:b.colno,b==null?void 0:b.filename),d("MAWInit").MAWInit.fail("import_scripts_failure")}function l(a,b){var d;d=(d=b==null?void 0:b.message)!=null?d:"";if(d.indexOf("Failed to execute 'importScripts'")>=0){k(a,b);return}c("FBLogger")("messenger_e2ee_web").mustfix("[MAWWebWorkerSingletonAsync: "+a+"]: %s:%s:%s:%s",JSON.stringify(b==null?void 0:b.message),b==null?void 0:b.lineno,b==null?void 0:b.colno,b==null?void 0:b.filename)}function m(a){var b=a.data.annotations;if(b!=null){var e={allowEarlyAnnotations:!0};Object.keys(b).forEach(function(a){var c;c=(c=b[a])!=null?c:{};Object.entries(c).forEach(function(b){var c=b[0];b=b[1];c="sharedWorkerInit"+c.charAt(0).toUpperCase()+c.substring(1);a==="int"&&typeof b==="number"?d("MAWInit").MAWInit.addIntAnnotation(c,b,e):a==="string"&&typeof b==="string"?d("MAWInit").MAWInit.addStringAnnotation(c,b,e):a==="bool"&&typeof b==="boolean"&&d("MAWInit").MAWInit.addBoolAnnotation(c,b,e)})})}var f={allowEarlyLogPoints:!0};switch(a.type){case"start":d("MAWInit").MAWInit.logPoint("shared_worker_init_start",f);break;case"end":var g;g=(g=a.data)==null?void 0:g.errorName;g!=null?d("MAWInit").MAWInit.fail("shared_worker_init_failure",c("err")(g)):d("MAWInit").MAWInit.logPoint("shared_worker_init_end",f);break;case"point":g="shared_worker_init_"+a.data.event;d("MAWInit").MAWInit.logPoint(g,f);break}}function a(a){var e=d("MAWWebWorkerInstance").getWorkerInstancePromise();if(!e){d("MAWTTRCSafe").markEvent("maw_worker_create_start");var f=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();n();if(f){f=c("qex")._("230")?d("SharedWorkerBundleResource").createPushSafeSharedWebWorkerV2Async:d("SharedWorkerBundleResource").createPushSafeSharedWebWorkerAsync;e=f(b("cr:6600"),function(){c("promiseDone")(j.promise.then(function(){return i()}))},void 0,{onQPLEvent:m,reason:a}).then(function(a){a.addEventListener("error",function(a){return l("Shared Worker",a)});return a.port})}else{var g=c("gkx")("4695");e=(h||(h=b("Promise"))).resolve(c("qex")._("230")===!0?d("WebWorkerV2Resource").createDedicatedV2WebWorker(b("cr:6600")):d("WorkerBundleResource").createDedicatedWebWorker(b("cr:6600"),{logImportScriptsErrors:g})).then(function(a){a.onerror=function(a){return l("Dedicated Worker",a)};if(g){var b=function b(d){d=d==null?void 0:d.data;if(typeof d==="object")if((d==null?void 0:d.type)==="importScripts_error"){a.removeEventListener("message",b);var e=c("FBLogger")("messenger_e2ee_web");if((d==null?void 0:d.stack)!=null){var f;e=e.addMetadata("FBLOGGER","ERROR_STACK",(f=typeof (d==null?void 0:d.stack)==="string"?d==null?void 0:d.stack:JSON.stringify(d==null?void 0:d.stack))!=null?f:"no_stack")}f=(f=d==null?void 0:d.perfEntry)!=null?f:{};var g=f.duration,h=f.encodedBodySize,i=f.responseStatus;f=f.transferSize;e.mustfix("[MAWWebWorkerSingletonAsync Script Import Error Details]: %s:%s:%s || errCode:%s || respStatus:%s || encBodySize:%s || duration:%s || transferSize:%s",(d==null?void 0:d.source)!=null&&JSON.stringify(d==null?void 0:d.source)||"no_source",(d==null?void 0:d.error_name)!=null&&JSON.stringify(d==null?void 0:d.error_name)||"no_name",(d==null?void 0:d.error_msg)!=null&&JSON.stringify(d==null?void 0:d.error_msg)||"no_msg",(d==null?void 0:d.error_code)!=null&&JSON.stringify(d==null?void 0:d.error_code)||"no_error_code",(e=JSON.stringify(i))!=null?e:"none",(i=JSON.stringify(h))!=null?i:"none",(e=JSON.stringify(g))!=null?e:"none",(h=JSON.stringify(f))!=null?h:"none")}else(d==null?void 0:d.type)==="importScripts_success"&&a.removeEventListener("message",b)};a.addEventListener("message",b)}return a})}e=e.then(function(a){d("MAWTTRCSafe").markEvent("maw_worker_create_end");return a})}d("MAWWebWorkerInstance").setWorkerInstancePromise(e);return e}function e(a){i=a,j.resolve()}function n(){}g.createWorkerIfNone=a;g.setOnCloseForWorkerInstance=e}),98);
__d("MAWSetupWorker",["CurrentUser","Deferred","IGDWebUtils","MAWClientConsistencyRefresh","MAWCommonSetupWorker","MAWCrossWorkerPortal","MAWInit","MAWLoggerUtils","MAWWebWorkerInstance","MAWWebWorkerSingleton","MessengerIntent","Promise","SharedWorkerBundleResource","WATagsLogger","asyncToGeneratorRuntime","cr:6600","err","gkx","justknobx","promiseDone","qex","setTimeout","shouldUseMAWSharedWorker","startMAWWorkerWatchdog"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker terminating: for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker doesn't exist, no need to terminate"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to startup worker watchdog: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAW worker watchdog successfully setup"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker setting up"]);m=function(){return a};return a}var n=c("justknobx")._("816"),o=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.WorkerSetup,d("MAWLoggerUtils").Tag.MAWInit]),p=d("IGDWebUtils").isInstagramWebSupportedApp(Number(c("CurrentUser").getAppID())),q=p?"IGDAWMainWorker":"MAWMainWorker",r=null,s=null,t=!1;function u(e,f,g,h,i){if(t)throw c("err")("Worker is permanently killed.");var j=function(){return u(e,f,g,h,"workerUpgraded")};d("MAWInit").MAWInit.logPoint("create_worker_start");d("MAWWebWorkerSingleton").setOnCloseForWorkerInstance(function(){y("createWorkerIfNone:onClose"),d("MAWInit").MAWInit.addBoolAnnotation("workerUpgraded",!0),c("promiseDone")(j())});d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()||c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!(yield w()))return;yield C()})());d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();i=d("MAWWebWorkerSingleton").createWorkerIfNone(i);var k=new(c("Deferred"))();r=k.getPromise();a=i;return a.then(function(a){d("MAWInit").MAWInit.logPoint("create_worker_end");if(a===null)throw c("err")("Client is starting bridge without a worker.");o.LOG(m());d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&a.addEventListener("message",function(a){var b;typeof a.data==="object"&&((b=a.data)==null?void 0:b.type)==="sw-shutdown"&&typeof a.data.response==="object"&&((b=a.data.response)==null?void 0:b.reason)==="maw-request-refresh"&&(s==null?void 0:s(),c("MAWClientConsistencyRefresh")("worker_mismatch"))});d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();var h=new(d("MAWCommonSetupWorker").BridgeAdapter)(a,q);k.resolve(h);f(h);return d("MAWInit").MAWInit.measurePerformance("maw_init_worker",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=function(){return d("MAWCommonSetupWorker").initWorker(h,e,j,g)},b;!d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&(c("qex")._("230")===!0||c("gkx")("5659"))?b=(yield h.fullyConnected.then(a)):b=(yield a());d("MessengerIntent").markWorkerReady();return b}))})}function v(a,d,e,f,g){c("promiseDone")((h||(h=b("Promise"))).race([B(n).then(function(){return!0}),a.then(function(){s=c("startMAWWorkerWatchdog")(d,e,f,g);return!1})]).then(function(a){if(a)throw c("err")("Bridge setup timed out.")}),function(){o.LOG(l())},function(a){a=a.description||a.message||a;o.ERROR(k(),a)})}function e(a,b,c,d,e){if(!r){e=u(a,b,c,d,e);v(e,a,b,c,d);return e}return r}function w(){return d("SharedWorkerBundleResource").doesSharedWorkerReferenceExist(b("cr:6600"))}function x(a,b,e){if(!r){b&&o.LOG(j());return!1}b&&o.LOG(i(),e);c("promiseDone")(r.then(function(a){return a==null?void 0:a.close()}));r=null;d("MAWCrossWorkerPortal").killPortalWhenWorkerTerminating();d("MAWWebWorkerInstance").destroyWorkerInstance();a&&s!=null&&(s(),s=null);return!0}function y(a){x(!0,!0,a)}function f(){x(!0,!0,"terminateWorkerPermanently"),t=!0}function z(){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){x(!1,!1,"killWorkerForTest")&&(yield B(45e3))});return A.apply(this,arguments)}function B(a){return new(h||(h=b("Promise")))(function(b){return c("setTimeout")(b,a)})}function C(a){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!0),yield d("SharedWorkerBundleResource").terminateSharedWorker(b("cr:6600"),null,a?"maw-request-refresh":void 0)});return D.apply(this,arguments)}function E(a){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();b?yield C(!1):y(a)});return F.apply(this,arguments)}g.getOrSetupWorker=e;g.isSharedWorkerActive=w;g.terminateWorker=y;g.terminateWorkerPermanently=f;g.killWorkerForTest=z;g.killSharedWorker=C;g.killSharedWorkerOrTerminateWebWorkerTmp=E}),98);
__d("MAWSharedWorkerReboot",["MAWSetupWorker","ODS","WALogger","promiseDone","requireDeferredForDisplay"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Clear the shared worker reference in MAWSharedWorkerReboot"]);i=function(){return a};return a}var j=c("requireDeferredForDisplay")("MAWWorkerBadStateRecovery").__setRef("MAWSharedWorkerReboot");function a(a,b,e,f){(h||(h=d("ODS"))).bumpEntityKey(3185,"armadillo_shared_worker_reboot","start_reboot_shared_worker");var g=j.getModuleIfRequireable(),k=function(){g==null?void 0:g.startSharedWorkerRestart();return d("MAWSetupWorker").getOrSetupWorker(a,b,e,f,"watchdogRestart")};d("WALogger").LOG(i());d("MAWSetupWorker").terminateWorker("Clear the shared worker reference in MAWSharedWorkerReboot");c("promiseDone")(k(),function(a){g==null?void 0:g.endSuccessSharedWorkerRestart(),b(a)},function(a){g==null?void 0:g.endFailureSharedWorkerRestart(a)})}g.rebootSharedWorker=a}),98);
__d("startMAWWorkerWatchdog",["CurrentUser","MAWBridgeLoggingUtils","MAWBridgeSendAndReceive","MAWIssueNewUserVisibleErrors","MAWSharedWorkerReboot","ODS","Promise","WALogger","clearInterval","err","justknobx","promiseDone","requireDeferredForDisplay","setInterval","setTimeout","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["shared worker reconnection failed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["starting reconnection to shared worker"]);k=function(){return a};return a}var l=c("requireDeferredForDisplay")("MAWWorkerBadStateRecovery").__setRef("startMAWWorkerWatchdog"),m=c("justknobx")._("1369"),n=m/2,o=!1;function a(a,e,f,g){var p=c("setInterval")(function(){c("promiseDone")((i||(i=b("Promise"))).race([d("MAWBridgeSendAndReceive").sendAndReceive("backend","getWorkerHeartbeat"),new i(function(a,b){c("setTimeout")(function(){b(c("err")("Armadillo web worker heartbeat timed out. "))},n)})]).then(function(a){if(!a){(a=d("MAWIssueNewUserVisibleErrors")).issueError(a.MAWGeneralErrorMsgBody,a.MAWGeneralErrorMsgTitle,a.MAWUserVisibleErrorPresentationType.BANNER);g();c("clearInterval")(p)}if(o){(a=l.getModuleIfRequireable())==null?void 0:a.workerRecoverySucceeded();(h||(h=d("ODS"))).bumpEntityKey(3185,"armadillo_worker_watch_dog","reboot_shared_worker_successfully")}o=!1})["catch"](function(b){d("MAWBridgeLoggingUtils").workerUnresponsive();var i=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();if(i&&!o&&c("CurrentUser").isLoggedInNow())d("WALogger").LOG(k()),(h||(h=d("ODS"))).bumpEntityKey(3185,"armadillo_worker_watch_dog","reboot_shared_worker_start"),o=!0,d("MAWSharedWorkerReboot").rebootSharedWorker(a,e,f,g);else{if(o){(i=l.getModuleIfRequireable())==null?void 0:i.workerRecoveryFailed("shared worker reboot failed");d("WALogger").ERROR(j());(h||(h=d("ODS"))).bumpEntityKey(3185,"armadillo_worker_watch_dog","reboot_shared_worker_failed")}d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER);c("clearInterval")(p);g();throw b}}))},m);return function(){g(),c("clearInterval")(p)}}g["default"]=a}),98);
__d("WADevToolMessageChannel",[],(function(a,b,c,d,e,f){var g=new MessageChannel();a=function(){g=new MessageChannel();return g};b=function(){return g};f.createNewChannel=a;f.getMostRecentChannel=b}),66);
__d("FuncChannel",["FBLogger","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a){var d=this,e;this.$2=[];this.callMessageHandler=function(a){return new(h||(h=b("Promise")))(function(b,c){a.result={resolveFunc:b,rejectFunc:c},d.$2.push(a)})};this.messageToCall=function(a){var b,e,f=d.proxyMethods[a.method];if(typeof f!=="function"){c("FBLogger")("worker").mustfix("proxyMethods[%s] is not a functions",a.method);return}b=(b=a.result)==null?void 0:b.resolveFunc;e=(e=a.result)==null?void 0:e.rejectFunc;if(typeof b==="function"&&typeof e==="function")try{var g=f.apply(a.thisArg,a.argList);b(g)}catch(a){e(a)}else return f.apply(a.thisArg,a.argList)};var f=this,g={},i=(e=a==null?void 0:a(g))!=null?e:{},j=babelHelpers["extends"]({},g);function k(a){j[a]=function(){var b={type:"call",method:a,thisArg:null,argList:Array.from(arguments)};return f.callMessageHandler(b)},g[a]=function(){var b=f.$1[a];if(typeof b!=="function"){c("FBLogger")("worker").mustfix("_backend[%s] is not a functions",a);return}return b.apply(f.$1,arguments)},i[a]==null&&(i[a]=g[a])}this.$1=j;if(a!=null){e=Object.keys(i);e.forEach(k);this.proxyMethods=i}else this.proxyMethods=new Proxy(i,{get:function(a,b){a=b;i[a]==null&&k(a);return i[a]}})}var d=a.prototype;d.flushBuffer=function(){var a=this.$2;this.$2=[];a.forEach(this.messageToCall)};d.setBackend=function(a){this.$1!==a&&(this.$1=a,this.flushBuffer());return this};d.setCallMessageHandler=function(a){this.callMessageHandler=a,this.flushBuffer()};return a}();g["default"]=a}),98);
__d("TimedOnceFunc",["ExecutionEnvironment"],(function(a,b,c,d,e,f,g){var h;a=function(){function a(a,b){this.$2=!1,this.$4=a,this.$3=b,(h||(h=c("ExecutionEnvironment"))).isInBrowser&&this.$5()}var b=a.prototype;b.$6=function(){this.$1!=null&&clearTimeout(this.$1),this.$1=null};b.$5=function(){var a=this;this.isDone()||(this.$6(),this.$1=setTimeout(function(){a.$2=!0,a.run()},this.$3))};b.isDone=function(){return this.$4===null};b.isCancelled=function(){return this.$1===null&&this.$4!==null};b.run=function(){this.$6();if(this.$4!=null){var a=this.$4;this.$4=null;a(this.$2)}};b.getDelay=function(){return this.$3};b.delay=function(a){this.$3=(a=a)!=null?a:this.$3;this.$5()};b.cancel=function(){this.$6()};return a}();g.TimedOnceFunc=a}),98);
__d("VirtualMessageChannel",["invariant","Promise","SimpleHook","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=function(){function a(a){a===void 0&&(a=!1),this.$2=new(d("SimpleHook").SimpleHook)(),this.onmessage=null,this.onmessageerror=null,this.$3=a}var e=a.prototype;e.setRemotePort=function(a){this.$1=a};e.addEventListener=function(a,b,c){(a==="message"||a==="error")&&c==null||h(0,55320,a);if(a==="message")if(typeof b==="function")this.$2.add(b);else{c=b.handleEvent.bind(b);this.$2.add(c);b.__handler=c}};e.removeEventListener=function(a,b,c){if(typeof b==="function")this.$2.remove(b);else{a=b.__handler;this.$2.remove(a)}};e.postMessage=function(a,d){var e=this,f=function(){var b=c("nullthrows")(e.$1,"By now remote port must have value!");b.$2.call({data:a,ports:d})};this.$3?f():c("promiseDone")((i||(i=b("Promise"))).resolve(),f)};e.start=function(){};return a}();a=function(a,b){this.port1=new j(a),this.port2=new j(b),this.port1.setRemotePort(this.port2),this.port2.setRemotePort(this.port1)};g.VirtualMessagePort=j;g.VirtualMessageChannel=a}),98);
__d("DoubleKeyMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.set=function(a,b,c){var d=this.$1.get(a);d||this.$1.set(a,d=new Map());d.set(b,c)};b.get=function(a,b){return(a=this.$1.get(a))==null?void 0:a.get(b)};b["delete"]=function(a,b){var c=this.$1.get(a);c&&(c["delete"](b),c.size===0&&this.$1["delete"](a))};b.getAll=function(a){return this.$1.get(a)};b.deleteAll=function(a){this.$1["delete"](a)};return a}();f.DoubleKeyMap=a}),66);
__d("NestedTimeRange",["SimpleHook","performance","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new(d("SimpleHook").SimpleHook)(),k=new(d("SimpleHook").SimpleHook)(),l="/";function m(a,b){return""+a+l+b}b=function(){function a(a,b){b===void 0&&(b=null),this.$3=0,this.$1=a,this.$2=b}var b=a.prototype;b.isRunning=function(){return this.$3>0};b.fullname=function(){return this.$2!==null?m(this.$2.fullname(),this.$1):this.$1};b.start=function(a){a===void 0&&(a=(h||(h=c("performanceAbsoluteNow")))());if(this.$3===0){var b;(b=this.$2)==null?void 0:b.start(a);this.__onStart(a)}++this.$3;return a};b.__onStart=function(a){j.call(this,a)};b.stop=function(a){a===void 0&&(a=(h||(h=c("performanceAbsoluteNow")))());--this.$3;if(this.$3===0){var b;this.__onStop(a);(b=this.$2)==null?void 0:b.stop(a)}return a};b.__onStop=function(a){k.call(this,a)};return a}();function a(){(i||(i=c("performance"))).mark&&(i||(i=c("performance"))).measure&&(j.add(function(a,b){(i||(i=c("performance"))).mark(a.fullname()+"_start")}),k.add(function(a,b){(i||(i=c("performance"))).measure(a.fullname(),a.fullname()+"_start")}))}g.OnRangeStart=j;g.OnRangeStop=k;g.TIME_RANGE_LEVEL_SEPARATOR=l;g.rangeFullName=m;g.NestedTimeRange=b;g.enableDevConsoleTimeline=a}),98);
__d("QLogEvent",["DoubleKeyMap","FBLogger","NestedTimeRange","QPLEvent","SimpleHook","performanceNavigationStart"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("DoubleKeyMap").DoubleKeyMap)(),j=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,d){a=b.call(this,a,d)||this;a.$QPLRange1=c;i.set(c,a.fullname(),babelHelpers.assertThisInitialized(a));return a}var e=a.prototype;e.__onStart=function(a){b.prototype.__onStart.call(this,a),this.$QPLRange1.point(this.fullname()+"_START",{timestamp:a})};e.__onStop=function(a){b.prototype.__onStop.call(this,a),this.$QPLRange1.point(this.fullname()+"_END",{timestamp:a}),i["delete"](this.$QPLRange1,this.fullname())};e.range=function(b){this.fullname().startsWith(d("NestedTimeRange").TIME_RANGE_LEVEL_SEPARATOR)||c("FBLogger")("qpl").warn("Range %s cannot have subrange since root name does not start with /",this.fullname());var e=d("NestedTimeRange").rangeFullName(this.fullname(),b);return(e=i.get(this.$QPLRange1,e))!=null?e:new a(b,this.$QPLRange1,this)};return a}(d("NestedTimeRange").NestedTimeRange),k=new(d("DoubleKeyMap").DoubleKeyMap)(),l=new((b=d("SimpleHook")).SimpleHook)(),m=new b.SimpleHook(),n=new b.SimpleHook(),o=new b.SimpleHook(),p=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,e,f){var g;c===void 0&&(c=0);e===void 0&&(e=2);f===void 0&&(f=!1);var i=(h||(h=d("QPLEvent"))).getMarkerId(a);g=b.call(this,"event_"+i)||this;g.event=a;g.instanceKey=c;g.$QPLEvent1=e;g.isUserFlow=f;k.set(i,c,babelHelpers.assertThisInitialized(g));return g}var e=a.prototype;e.action=function(a){this.$QPLEvent1=a;return this};e.getAction=function(){return this.$QPLEvent1};e.setIsUserFlow=function(a){this.isUserFlow=a;return this};e.startFromNavStart=function(){this.start(c("performanceNavigationStart")());return this};e.startFromTime=function(a){this.start(a);return this};e.__onStart=function(a){l.call(this,a)};e.__onStop=function(a){m.call(this,a),i.deleteAll(this),k["delete"]((h||(h=d("QPLEvent"))).getMarkerId(this.event),this.instanceKey)};e.range=function(a){var b;return(b=i.get(this,a))!=null?b:new j(a,this)};e.point=function(a,b){b===void 0&&(b={});n.call(this,a,b);return this};e.annotate=function(a){o.call(this,a);return this};return a}(d("NestedTimeRange").NestedTimeRange);function a(a,b){var c;b===void 0&&(b=0);return(c=k.get((h||(h=d("QPLEvent"))).getMarkerId(a),b))!=null?c:new p(a,b)}g.OnEventStart=l;g.OnEventStop=m;g.OnEventPoint=n;g.OnEventAnnotate=o;g.QPLEvent=p;g.event=a}),98);
__d("WorkerMessagePort",["FBLogger","MainPageUrl","Promise","PromiseAnnotate","QLogEvent","SimpleHook","VirtualMessageChannel","performanceAbsoluteNow","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=20,l=100,m=50;function n(a){return a}var o=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(d("SimpleHook").SimpleHook);function p(a,b){a=n(a);a.__timing=b}function q(a){return a.__timing}var r=0;function s(){return d("QLogEvent").event(c("qpl")._(41497718,"106"),r++)}var t=Math.random()<.1;function u(a,b,c){var d;if(b==null||!t)return;var e=b.sendDelayHighPrecision,f=b.sendTimestamp,g=b.sendDateTime,h=b.receiveTimestamp;b=b.receiveDateTime;d=(d=c)!=null?d:s();c==null&&d.startFromTime();var i=d.range("SEND_DELAY");i.start(f);i.stop(h);i=d.range("SEND_DELAY_LOW_PRECISION");i.start(g);i.stop(b);i=Math.abs(f-g);f=Math.abs(h-b);d.annotate({string:{port_name:a},"int":{send_delay:e,send_drift:i,receive_drift:f},bool:{send_delay_above_max:e!=null&&e>k,send_drift_above_max:i>l,receive_drift_above_max:f>l}});c==null&&d.stop()}a=function(){var a=e.prototype;a.onMessageHandler=function(a){try{this.onMessage.call(a);var b=this.$1[a.type];!b?this.onUnhandledMessage.call(a):b.call(a)}catch(a){this.onError.call(a)}};function e(a,b){var d=this;this.$1={};this.onUnhandledMessage=new o();this.onMessage=new o();this.onPostMessage=new o();this.onError=new o();this.$2=a;this.name=b;this.$2.addEventListener("message",function(a){return d.onMessageHandler(n(a.data))});this.$2.addEventListener("error",function(a){return d.onError.call(a)});this.onPostMessage.add(function(a){p(a,{sendTimestamp:(j||(j=c("performanceAbsoluteNow")))(),receiveTimestamp:-1,sendDelayHighPrecision:0,sendDateTime:Date.now(),receiveDateTime:-1,sendDelayLowPrecision:0})});this.onMessage.add(function(a){a=q(a);if(a!=null){var b=a.sendTimestamp,e=a.sendDateTime,f=(j||(j=c("performanceAbsoluteNow")))(),g=Date.now();a.receiveTimestamp=f;a.receiveDateTime=g;a.sendDelayHighPrecision=f-b;a.sendDelayLowPrecision=g-e;u(d.name,a)}})}a.postMessage=function(a,b){this.onPostMessage.call(a),b?this.$2.postMessage(a,b):this.$2.postMessage(a)};a.addMessageListener=function(a,b){var c=this.$1[a];c||(c=new o(),this.$1[a]=c);return c.add(b)};a.removeMessageListener=function(a,b){a=this.$1[a];return!!a&&a.remove(b)};a.onMessageOnce=function(a,c){var d=this;return new(i||(i=b("Promise")))(function(b){var e=d.addMessageListener(a,function(f){c(f)&&(d.removeMessageListener(a,e),b(f))})})};a.close=function(){if(this.$2 instanceof MessagePort)this.$2.close();else if(this.$2 instanceof Worker)this.$2.terminate();else if(this.$2 instanceof DedicatedWorkerGlobalScope)this.$2.close();else{var a;(a=(a=this.$2.close)!=null?a:this.$2.terminate)==null?void 0:a.call(this.$2)}};a.isWrappingVirtualMessagePort=function(){return this.$2 instanceof d("VirtualMessageChannel").VirtualMessagePort};return e}();function v(a){return n(a)}e=function(a){babelHelpers.inheritsLoose(e,a);function e(e,f){var g;g=a.call(this,e,f)||this;var j=v(babelHelpers.assertThisInitialized(g));e=j.onMessageOnce("endpoint_started",function(){return!0});f=j.onMessageOnce("endpoint_started_received",function(){return!0});void (h||(h=d("PromiseAnnotate"))).setDisplayName(e,"endpoint_started");void h.setDisplayName(f,"endpoint_started_received");j.postMessage({type:"endpoint_started",endpoint:g.name});c("promiseDone")(e,function(a){var b=q(a);j.postMessage({type:"endpoint_started_received",endpoint:a.endpoint,targetEndpoint:g.name,startSendTimestamp:b==null?void 0:b.sendTimestamp});u(g.name,b)});c("promiseDone")(f,function(a){var b=q(a);if(b!=null){var c=s();c.startFromTime();u(g.name,b,c);var d=c.range("ROUND_TRIP");d.start(a.startSendTimestamp);d.stop(b.receiveTimestamp);d=b.receiveTimestamp-a.startSendTimestamp;c.annotate({"int":{round_trip:d},bool:{round_trip_above_max:d>m}}).stop()}});g.fullyConnected=(i||(i=b("Promise"))).race([e,f]).then(function(){return babelHelpers.assertThisInitialized(g)});return g}return e}(a);g.getMessageTiming=q;g.WorkerMessagePort=a;g.CastWorkerMessagePort=v;g.WorkerSyncedMessagePort=e}),98);
__d("WorkerFuncChannel",["invariant","DateConsts","ExecutionEnvironment","FBLogger","FuncChannel","MainPageUrl","Promise","TimedOnceFunc","VirtualMessageChannel","WorkerMessagePort","err","promiseDone"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k={serialize:function(a,b){b.push(a);return a},deserialize:function(a){return a}},l=1e4,m=0,n=5,o=n+1,p=function(){function a(a){var b=self.WeakRef;b&&(this.$1=new b(a))}var b=a.prototype;b.isDead=function(){return this.$1!=null&&this.$1.deref()==null};return a}(),q=function(e){babelHelpers.inheritsLoose(a,e);function a(a,b,f,g){var i;f===void 0&&(f=null);g===void 0&&(g={});i=e.call(this,a)||this;i.$WorkerFuncChannel1=new Map();i.$WorkerFuncChannel2=new Map();i.$WorkerFuncChannel5={"function":{serialize:function(a,b){b=o++;i.$WorkerFuncChannel1.set(b,a);a={type:"function",value:b};return a},deserialize:function(a){var b=babelHelpers.assertThisInitialized(i),c=a.value;a=function(){var a={type:"call",id:c,method:"__anonymous",thisArg:null,argList:Array.from(arguments)};return b.callMessageHandler(a)};i.$WorkerFuncChannel2.set(c,new p(a));return a}},custom:{serialize:function(a,b){var c=a.constructor.name,d=i.$WorkerFuncChannel4[c];d!=null||h(0,63779,c);d=d.serialize(a,b);return{type:"custom",custom:c,value:d}},deserialize:function(a){var b=a.custom,c=i.$WorkerFuncChannel4[b];c!=null||h(0,63779,b);return c.deserialize(a.value)}},error:{serialize:function(a,b){b={name:a.name,message:a.message,stack:a.stack};return{type:"error",value:b}},deserialize:function(a){var b=c("err")(a.value.message);b.name=a.value.name;b.stack=a.value.stack;return b}},object:{serialize:function(a,b){b=a.constructor;if(b!==Object)throw new Error("Cannot clone class object");return{type:"object",value:a}},deserialize:function(a){return a.value}},raw:{serialize:function(a,b){return{type:"raw",value:a}},deserialize:function(a){return a.value}}};i.name=b;i.$WorkerFuncChannel3=f;i.$WorkerFuncChannel4=g;a=function(a){d("MainPageUrl").isWorkerLogEnabled()&&c("FBLogger")("adsworker").debug("[Channel] removing callback ids: %s",a.join()),a.forEach(function(a){return i.$WorkerFuncChannel1["delete"](a)})};var k=i.__remoteInternalFunc(m,a);typeof jest===typeof void 0&&(j||(j=c("ExecutionEnvironment"))).isInBrowser&&setInterval(function(){var a=[];i.$WorkerFuncChannel2.forEach(function(b,c){b.isDead()&&(a.push(c),i.$WorkerFuncChannel2["delete"](c))});a.length>0?k(a):i.$WorkerFuncChannel2.size>5e3&&c("FBLogger")("adsworker").warn("[%s] has too many remaining refs %s",i.name,i.$WorkerFuncChannel2.size)},l);return i}var f=a.prototype;f.__remoteInternalFunc=function(a,b){(a>n||this.$WorkerFuncChannel1.get(a)!=null)&&c("FBLogger")("adsworker").mustfix("invalid internal func id %s",a);this.$WorkerFuncChannel1.set(a,b);b=this.$WorkerFuncChannel5["function"].deserialize({type:"function",value:a});return b};f.$WorkerFuncChannel6=function(a){return a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array};f.$WorkerFuncChannel7=function(a){if(typeof a==="function")return"function";if(a===null)return"raw";if(typeof a!=="object")return"raw";if(Array.isArray(a))return"raw";if(this.$WorkerFuncChannel6(a))return"raw";var b=a.constructor.name;if(this.$WorkerFuncChannel4[b])return"custom";return a instanceof Error?"error":"object"};f.$WorkerFuncChannel8=function(a,b){var c=this.$WorkerFuncChannel7(a);return this.$WorkerFuncChannel5[c].serialize(a,b)};f.$WorkerFuncChannel9=function(a){var b=a;if(a!==null&&typeof a==="object"&&typeof a.type==="string"){var c=this.$WorkerFuncChannel5[a.type];if(c)return c.deserialize(a)}return b};f.__onPostOutMessage=function(a){return a};f.__callCallback=function(a,b){a.apply(null,b.argList)};f.setOutMessagePort=function(a,d){var e=this,f=[];this.setCallMessageHandler(function(d){d.thisArg=e.name;var g=[];d.argList=d.argList.map(function(a){return e.$WorkerFuncChannel8(a,g)});var h=new(i||(i=b("Promise")))(function(a,b){d.result={resolveFunc:e.$WorkerFuncChannel8(a,g),rejectFunc:e.$WorkerFuncChannel8(b,g)}}),j=e.__onPostOutMessage(d);j!=null&&(f!=null?f.push({message:d,transferList:g}):a.postMessage(d,g));h["catch"](function(a){c("FBLogger")("worker").catching(a).mustfix("Error: channel %s, remote call of %s returned error %s",e.name,d.method,a.message)});return h});c("promiseDone")(d||x.waitForRemote(this.name),function(){var b=f;f=null;b==null?void 0:b.forEach(function(b){a.postMessage(b.message,b.transferList)});e.$WorkerFuncChannel3==null?void 0:e.$WorkerFuncChannel3()})};f.__messageToCall=function(a){var b=this;a.argList=a.argList.map(function(a){return b.$WorkerFuncChannel9(a)});if(a.result){var d=a.result,e=d.resolveFunc;d=d.rejectFunc;e=this.$WorkerFuncChannel9(e);d=this.$WorkerFuncChannel9(d);a.result={resolveFunc:e,rejectFunc:d}}e=a.id;if(e===void 0)this.messageToCall(a);else{d=this.$WorkerFuncChannel1.get(e);d?this.__callCallback(d,a):c("FBLogger")("adsworker").mustfix("Error: callback is called but no longer available")}};f.setInMessagePort=function(a){var b=this;a.addMessageListener("call",function(a){typeof a.thisArg==="string"&&a.thisArg===b.name&&b.__messageToCall(a)});x.notifyReady(this.name)};f.setMessagePort=function(a){this.setInMessagePort(a);this.setOutMessagePort(a);return this};return a}(c("FuncChannel")),r=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(d("WorkerMessagePort").WorkerMessagePort);function s(a,b,d,e){x.exportChannel(a,function(e){var f=e.syncPort;e=e.remoteNativePort;var g=b();a===g.name||h(0,54247,a,g.name);var i;e?(i=new r(e,f.name+"("+g.name+")"),e.start(),i.onError.add(function(a){c("FBLogger")("worker").catching(a).mustfix("error caught in remotePort");throw a})):i=f;g.setMessagePort(i).setBackend(d);c("promiseDone")(f.fullyConnected,function(){f.postMessage({type:"channelReady",channelName:g.name}),x.logState("EXPORTED",a)})})}function a(a,b,c,d){d===void 0&&(d={});return s(c,function(){return new q(function(b){return a},c,null,d)},a,b)}var t=function(b){babelHelpers.inheritsLoose(a,b);function a(a,e){e===void 0&&(e="");var f=d("DateConsts").MS_PER_MIN*1;return b.call(this,function(){c("FBLogger")("worker").warn("Channel %s did not establish eventually. %s",a,e)},f)||this}return a}(d("TimedOnceFunc").TimedOnceFunc);function u(a,b){var e,f=null,g,h;b.isWrappingVirtualMessagePort()?(h=new(d("VirtualMessageChannel").VirtualMessageChannel)(!0,!0),e="on virtual dedicated channel"):(h=new MessageChannel(),e="on native dedicated channel",g=[h.port2]);var i=h.port1;f=h.port2;i.start();var j=new r(i,b.name+"("+a.name+")");c("promiseDone")(b.fullyConnected,function(){x.logState("IMPORTING "+e+" ",a.name);a.setInMessagePort(j);var d=new t(a.name,e);c("promiseDone")(b.onMessageOnce("channelReady",function(b){return b.channelName===a.name}),function(b){a.setOutMessagePort(j),d.cancel(),x.logState("ESTABLISHED",a.name)});b.postMessage({type:"channelImport",channelName:a.name,port:f},g)});return a.proxyMethods}function v(a,b,c,d){c===void 0&&(c=null);d===void 0&&(d={});b=new q(function(b){return a},b,c,d);return b}function e(a,b,c,d,e){d===void 0&&(d=null);e===void 0&&(e={});return u(v(a,c,d,e),b)}var w=function(){function a(){this.name=self.name+"_P"+Math.round(10*Math.random()),this.$1=new Map(),this.$2=new Set()}var e=a.prototype;e.logState=function(a,b){d("MainPageUrl").isWorkerLogEnabled()&&c("FBLogger")("worker").debug("%s-%s %s",this.name,a,b)};e.$3=function(a){var b=this.$1.get(a);b==null&&(b={pendingPorts:null,onImportRequest:null},this.$1.set(a,b));return b};e.exportChannel=function(a,b){var d=this,e=this.$3(a);e.onImportRequest!=null&&c("FBLogger")("worker").debug("Re-exporting channel %s",a);e.onImportRequest=b;this.logState("REGISTERED",a);a=e.pendingPorts;if(a!=null){var f=a.filter(function(a){return d.$2.has(a.syncPort)});f.forEach(b);f.length<a.length?e.pendingPorts=a.filter(function(a){return!d.$2.has(a.syncPort)}):e.pendingPorts=null}return e};e.activate=function(a,b,d){var e=this;if(this.$2.has(a)){c("FBLogger")("worker").debug("Port %sis already duplicated ",a.name);return}this.$2.add(a);a.addMessageListener("channelImport",function(b){var c=b.channelName,d=e.$3(c);b={syncPort:a,remoteNativePort:b.port};d.onImportRequest!=null?d.onImportRequest(b):d.pendingPorts!=null?d.pendingPorts.push(b):d.pendingPorts=[b];e.logState("IMPORT REQUEST",c)})};e.notifyReady=function(a){};e.waitForRemote=function(a){return(i||(i=b("Promise"))).resolve()};return a}(),x=new w();function f(a,b,c){x.activate(a,b,c)}g.TransferableTransformer=k;g.WorkerFuncChannel=q;g.exportChannelOnPort=s;g.exportChannel=a;g.importChannelOnPort=u;g.makeChannel=v;g.importChannel=e;g.activateChannels=f}),98);
__d("WorkerBanzaiLazyQueueChannelClient",["BanzaiLazyQueue","WorkerFuncChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").exportChannel(c("BanzaiLazyQueue"),a,"banzai_lazyqueue_channel")}g.init=a}),98);
__d("WorkerQPLChannel",["WorkerFuncChannel","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("WorkerFuncChannel").WorkerFuncChannel)(function(a){return{markerStartFromNavStart:null,markerStart:function(b,d,e){e===void 0&&(e=(h||(h=c("performanceAbsoluteNow")))());return a.markerStart(b,d,e)},markerAnnotate:function(b,c,d){return a.markerAnnotate(b,c,d)},markerPoint:function(b,d,e){e=(e==null?void 0:e.timestamp)===void 0?babelHelpers["extends"]({},e,{timestamp:(h||(h=c("performanceAbsoluteNow")))()}):e;return a.markerPoint(b,d,e)},markerEnd:function(b,d,e,f){f===void 0&&(f=(h||(h=c("performanceAbsoluteNow")))());return a.markerEnd(b,d,e,f)}}},"qpl");function a(a){i.setMessagePort(a)}function b(a){i.setBackend(a)}g.setMessagePort=a;g.initQPL=b}),98);
__d("WorkerClient",["WorkerBanzaiLazyQueueChannelClient","WorkerFuncChannel","WorkerQPLChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").activateChannels(a,"client","worker"),d("WorkerBanzaiLazyQueueChannelClient").init(a),d("WorkerQPLChannel").setMessagePort(a),e(["QuickPerformanceLogger"],function(a){return d("WorkerQPLChannel").initQPL(a)})}g.init=a}),98);
__d("MAWCommonSetupWorker",["Deferred","MAWCurrentUser","MAWInit","MAWSetupWorker","MessengerWebInitData","WADevToolMessageChannel","WALogger","WorkerClient","WorkerMessagePort","err","gkx","pageID"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Terminating worker and rebooting..."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker receive invalid message: ",""]);i=function(){return a};return a}b=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var e;e=a.call(this,b,c)||this;e.onmessage=null;e.$BridgeAdapter$p_1=b;d("WorkerClient").init(babelHelpers.assertThisInitialized(e));e.onUnhandledMessage.add(function(a){e.onmessage&&e.onmessage({data:a})});return e}var c=b.prototype;c.getBridgePort=function(){return this};return b}(d("WorkerMessagePort").WorkerSyncedMessagePort);function a(a,b,e,f){var g=new(c("Deferred"))();a.addMessageListener("worker-setup",function(b){if(b.setupHash!==c("pageID"))return;if(b==null||b.type!=="worker-setup"){d("WALogger").WARN(i(),b);return}if(b.status==="success")g.resolve(a.getBridgePort());else if(b.status==="failure"){var j;g.reject(c("err")((j=b.msg)!=null?j:"Encountered an error setting up the armadillo web worker"))}else if(b.status==="already-setup")if(b.action==="no-action"){g.resolve(a.getBridgePort());f();return}else if(b.action==="reboot-required"&&b.setupHash===c("pageID")){d("WALogger").DEV(h());d("MAWSetupWorker").terminateWorker("reboot required");d("MAWInit").MAWInit.addBoolAnnotation("workerRebootRequired",!0);return e().then(function(a){return g.resolve(a)})["catch"](function(a){return g.reject(a)})}else throw c("err")("received invalid action for worker-setup:already-setup: "+b.action);else throw c("err")("received invalid message for worker")});a.addMessageListener("worker-setup-ack",function(a){if(a.setupHash!==c("pageID"))return;d("MAWInit").MAWInit.logPoint("maw_init_worker_ack")});if(c("gkx")("5147")){var j=d("WADevToolMessageChannel").createNewChannel();a.postMessage({content:{devToolMessageChannelPort2:j.port2,fbId:d("MAWCurrentUser").getID(),sessionId:c("MessengerWebInitData").sessionId,vaultMaterials:b},setupHash:c("pageID"),type:"worker-setup"},[j.port2])}else a.postMessage({content:{fbId:d("MAWCurrentUser").getID(),sessionId:c("MessengerWebInitData").sessionId,vaultMaterials:b},setupHash:c("pageID"),type:"worker-setup"});return g.getPromise()}g.BridgeAdapter=b;g.initWorker=a}),98);
__d("MAWEncryptionErrorHandler",["LSPlatformErrorChannel","MAWEARDecryptionError","MAWSetupWorker","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){c("promiseDone")(d("MAWSetupWorker").killSharedWorkerOrTerminateWebWorkerTmp("EARDecryptionError")),c("LSPlatformErrorChannel").emit(new(c("MAWEARDecryptionError"))("MAW DB Decryption Error in "+a+" table"))}g.crashUiAskUserToReload=a}),98);
__d("WAFixedSizeMap",[],(function(a,b,c,d,e,f){a=function(){function a(a){a=a.max;this.$1=new Map();this.$2=new Map();this.$3=0;this.$4=100;this.$4=a}var b=a.prototype;b.has=function(a){return this.$1.has(a)};b.get=function(a){return this.$1.get(a)};b.set=function(a,b){this.$1.set(a,b);this.$2.set(this.$3,a);this.$3+=1;b=this.$2.get(this.$3-this.$4-1);b!=null&&(this.$1["delete"](b),this.$2["delete"](this.$3-this.$4-1))};b.clear=function(){this.$1.clear(),this.$2.clear(),this.$3=0};b.size=function(){return this.$1.size};return a}();f.FixedSizeMap=a}),66);
__d("MAWJobActionsV2",["MAWTransactionMode","Promise","WAFixedSizeMap","WAHex","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return new(h||(h=b("Promise")))(function(b,c){a.onsuccess=b,a.onerror=c})}function j(a){return i(a).then(function(a){return a.target.result})}function k(a,c,e){return new(h||(h=b("Promise")))(function(b,f){var g=a(d("MAWTransactionMode").READONLY).index(c);g=g.openCursor(IDBKeyRange.only(e));var h=[];g.onsuccess=function(a){a=a.target.result;if(!a){b(h);return}h.push(a.value);a["continue"]()};g.onerror=function(a){return f(a)}})}var l=new(d("WAFixedSizeMap").FixedSizeMap)({max:100});function a(a,c){var e,f=c.args,g=c.scheduleConfig,i=c.type,l=c.uniqKey;c=c.version;c=c===void 0?1:c;e=JSON.stringify([i,(e=l)!=null?e:d("WAHex").randomHex(32)]);var n={backedOffCount:0,current:f,original:f,scheduleConfig:g,startTime:d("WATimeUtils").unixTime(),step:"$unstarted",stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,type:i,uniqKey:e,version:c,waitUntil:null},o=function(){var b,c=a().add(n),d=j(c);if(n.uniqKey==null&&typeof ((b=c.transaction)==null?void 0:b.commit)==="function")try{c.transaction.commit()}catch(a){}return d.then(function(a){return{id:a,newlyCreated:!0}})};if(l!=null)return k(a,"uniqKey",e).then(function(c){if(c.length===0)return o();var d=[],e=null;c.forEach(function(b){b.step!=="$finished"?e=b:d.push(m(a,b.jobId))});return(h||(h=b("Promise"))).all(d).then(function(){return e!=null?{id:e.jobId,newlyCreated:!1}:o()})});else return o()}function m(a,b){return j(a()["delete"](b))}function c(a,b){return j(a().get(b))}function e(a,b){return j(a().put(b))}function f(a){return j(a().getAll())}function n(a){try{return i(a().clear()).then(function(){})}catch(a){if(a.name==="NotFoundError")return(h||(h=b("Promise"))).resolve();throw a}}g.recentFinishedJobsCache=l;g.maybeCreateJob=a;g.deletePersistedJob=m;g.readPersistedJob=c;g.updatePersistedJob=e;g.readAllPersistedJobs=f;g.clearJobs=n}),98);
__d("MessengerWaitForEvent",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c,d){var e,f=d;return new(g||(g=b("Promise")))(function(b){f?e=function(){f.apply(this,arguments)&&b.apply(this,arguments)}:e=b,a==null?void 0:a.addEventListener==null?void 0:a.addEventListener(c,e)})["finally"](function(){a==null?void 0:a.removeEventListener==null?void 0:a.removeEventListener(c,e)})}f.waitForEvent=a}),66);
__d("LocalStorageMutex",["MessengerWaitForEvent","Promise","QPLUserFlow","err","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=1e3;a=function(){function a(a){var b=this,d=a.mutexKey,e=a.localTakeoverKey,f=a.log,g=a.logError,h=a.getStorage,i=a.setItemGuarded,k=a.mutexTimeoutMs;k=k===void 0?j:k;a=a.mutexTimeoutCallback;this.mutexFilter=function(a){if(a.key!==b.$1)return!1;a=a.newValue||"";if(!a.includes(c("pageID")))return!0;else return!1};this.$1=d;this.$2=e;this.$5=h;this.$6=i;this.$3=f;this.$4=g;this.$7=k;this.$8=a}var e=a.prototype;e.init=function(){c("QPLUserFlow").start(c("qpl")._(1056847375,"584"));this.$3("APPMUTEX - this tab is "+c("pageID"));var a=this.getMutex();if(a!=null&&a===c("pageID")){this.$3("APPMUTEX - WE ALREADY HAVE THE MUTEX LOCK WITHIN INIT");c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return(h||(h=b("Promise"))).resolve(!0)}if(a!=null){this.$3("APPMUTEX - initiating localTAKEOVER");return this.localTakeover()}else{this.$3("APPMUTEX - NO1 ELSE IS ALIVE, GET THE MUTEX");a=this.$9(c("pageID"));var d=this.$10(c("pageID"));if(!a.success||!d.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{bool:{setMutexResult:d.success,setTakeoverResult:a.success},string:{setMutexError:d.error,setTakeoverError:a.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"fail_to_set_takeover_or_mutex");return(h||(h=b("Promise"))).resolve(!1)}c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return(h||(h=b("Promise"))).resolve(!0)}};e.localTakeover=function(){var a,e=this,f=this.$9(c("pageID"));if(!f.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{string:{initTakeoverError:f.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_init_takeover_failure");return(h||(h=b("Promise"))).resolve(!1)}var g,i=function(){g!=null&&clearTimeout(g)};f=d("MessengerWaitForEvent").waitForEvent(window,"storage",this.mutexFilter);var k=(a=this==null?void 0:this._mutexTimeoutMs)!=null?a:j;return(h||(h=b("Promise"))).race([f,new h(function(a){g=setTimeout(function(){a()},k)}),this.$8?this.$8():new(h||(h=b("Promise")))(function(a){})]).then(function(a){if(a==null){e.$3("AppMutex - Forcefully took the mutex and takeover lock");var b=e.$9(c("pageID")),d=e.$10(c("pageID"));if(!b.success||!d.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{string:{setMutexError:d.error,setTakeoverError:b.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_forcefully_takeover_failure");return!1}c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return!0}e.$3("APPMUTEX - GOT MUTEX STORAGE EVENT CHANGE FROM ANOTHER TAB");d=e.$11(a.newValue);if(!d&&e.hasTakeoverPermission()){e.$3("APPMUTEX - setting mutex on localtakeover");b=e.$10(c("pageID"));if(!b.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{string:{setMutexError:b.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_set_mutex_failure");return!1}c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return!0}else{e.hasTakeoverPermission()&&e.$12();c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_no_takeover_permission");return!1}}).then(function(a){i();return a})["catch"](function(a){i();e.$4("AppMutex - localTakeover error no permission - "+a);c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_general_failure");return!1})};e.onMutexDeath=function(){var a=this.getMutex();a!=null&&a==c("pageID")&&(this.$3("APPMUTEX - removing mutex on death"),this.$13(),this.hasTakeoverPermission()&&this.$12())};e.takeoverFilter=function(a){if(a.key!==this.$2)return!1;a=a.newValue||"";if(!a.includes(c("pageID")))return!0;else return!1};e.$14=function(){if(!i){var a=this.$5();if(!a)throw c("err")("Could not get localStorage");i=a}return i};e.getMutex=function(){i=this.$14();return i.getItem(this.$1)};e.$10=function(a){i=this.$14();return this.$6(i,this.$1,a)};e.$13=function(){i=this.$14(),i.removeItem(this.$1)};e.getTakeover=function(){i=this.$14();return i.getItem(this.$2)};e.$9=function(a){i=this.$14();a=this.$6(i,this.$2,a);return a};e.$12=function(){i=this.$14(),i.removeItem(this.$2)};e.$11=function(a){return a!=null?a:""};e.hasTakeoverPermission=function(){var a=this.getTakeover();return a!=null&&a==c("pageID")};return a}();g.THIS_TAB=c("pageID");g.LocalStorageMutex=a}),98);
__d("MAWAppMutex",["LocalStorageMutex","MAWLocalStorage","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h="armadillo_msgr_mutex",i="armadillo_msgr_local_takeover",j=null;function a(){j==null&&(j=new(d("LocalStorageMutex").LocalStorageMutex)({getStorage:d("MAWLocalStorage").getStorage,localTakeoverKey:i,log:function(a){d("WALogger").LOG([a])},logError:function(a){d("WALogger").ERROR([a])},mutexKey:h,setItemGuarded:d("MAWLocalStorage").setItemGuarded}));return j}g.MAW_MUTEX_KEY=h;g.MAW_LOCALTAKEOVER_KEY=i;g.use=a}),98);
__d("LSOfflineQueueStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({INITIALIZING:0,PROCESSING:1,COMPLETE:2,FAILED:3});f["default"]=a}),66);
__d("MAWOfflineQueueStatusUtils",["I64","LSIntEnum","LSOfflineQueueStatus","MAWProtocolQueueConst","Promise","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=new Map([[d("MAWProtocolQueueConst").OfflineConsumerStatus.Initializing,(j||(j=d("LSIntEnum"))).ofNumber(c("LSOfflineQueueStatus").INITIALIZING)],[d("MAWProtocolQueueConst").OfflineConsumerStatus.Processing,j.ofNumber(c("LSOfflineQueueStatus").PROCESSING)],[d("MAWProtocolQueueConst").OfflineConsumerStatus.Complete,j.ofNumber(c("LSOfflineQueueStatus").COMPLETE)],[d("MAWProtocolQueueConst").OfflineConsumerStatus.Failed,j.ofNumber(c("LSOfflineQueueStatus").FAILED)]]);function a(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){a=(yield a);return a.runInTransaction(function(a){var f=Object.keys(c);return(h||(h=b("Promise"))).all(f.map(function(b){var c=k.get(e);if(c!=null){var f=d("WAJids").switchOnMsgrChatJidType(b,{group:function(a){return d("WAJids").groupIdFromJid(a)},user:function(a){return d("WAJids").userIdFromJid(a)}});return d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("offline_queue_thread_status")).getKeyRange((i||(i=d("I64"))).of_string(f))).then(function(b){if(b==null)return a.table("offline_queue_thread_status").put({offlineQueueStatus:c,threadJid:(i||(i=d("I64"))).of_string(f)});else return a.table("offline_queue_thread_status").upsert([b.threadJid],{latestMessageTimestampMs:b.latestMessageTimestampMs,offlineQueueStatus:c,threadJid:b.threadJid})})}})).then(function(){})},"readwrite")});return l.apply(this,arguments)}function e(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("offline_queue_thread_status")).getKeyRange(b)).then(function(a){return!(a!=null&&a.offlineQueueStatus!=null&&(i||(i=d("I64"))).to_int32(a.offlineQueueStatus)!==c("LSOfflineQueueStatus").COMPLETE)})}g.markThreadWithOfflineQueueStatus=a;g.isOfflineQueueDoneForThread=e}),98);
__d("MAWLocalizationEphemeralSettingSetAdminMsg",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF}g.isEphemeralSettingSetAdminMsg=a}),98);
__d("MAWAdminMsgCTA",["fbt","I64","MAWLocalizationEphemeralSettingSetAdminMsg","MAWLocalizationType","MAWTimeUtils","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=h._("__JHASH__iw7A0LnsmaW__JHASH__").toString(),l=h._("__JHASH__jODYJ2eW1Pa__JHASH__").toString(),m=h._("__JHASH__xAOSvpC7vLN__JHASH__").toString(),n=h._("__JHASH__P5k2go6lj2P__JHASH__").toString();function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("admin_message_ctas").index("ctaId"))));return a!=null?(j||(j=d("I64"))).add(a.ctaId,(j||(j=d("I64"))).one):(j||(j=d("I64"))).zero});return p.apply(this,arguments)}function q(a,b,c){b=[b,c];return d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("admin_message_ctas")).bounds({gte:b,lte:b}))}function r(a){if(a==null)return{showAdChoiceIcon:!1};if(d("MAWLocalizationEphemeralSettingSetAdminMsg").isEphemeralSettingSetAdminMsg(a))return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:k};switch(a){case d("MAWLocalizationType").CUTOVER_THREAD_ADMIN_MESSAGE:case d("MAWLocalizationType").CUTOVER_IGD_THREAD_ADMIN_MESSAGE:case d("MAWLocalizationType").E2EE_THREAD_DESCRIPTION:return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:l};case d("MAWLocalizationType").CUTOVER_ROLLBACK_ADMIN_MESSAGE:return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:m};case d("MAWLocalizationType").DUAL_THREAD_CUTOVER_ADMIN_MESSAGE:return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:n};default:return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:void 0}}}function s(a){if(a==null)return;if(d("MAWLocalizationEphemeralSettingSetAdminMsg").isEphemeralSettingSetAdminMsg(a))return"admin_msg_armadillo_ephemeral_change_duration";switch(a){case d("MAWLocalizationType").CUTOVER_THREAD_ADMIN_MESSAGE:case d("MAWLocalizationType").CUTOVER_IGD_THREAD_ADMIN_MESSAGE:return"admin_msg_thread_level_cutover";case d("MAWLocalizationType").E2EE_THREAD_DESCRIPTION:return"admin_msg_e2ee_thread";case d("MAWLocalizationType").CUTOVER_ROLLBACK_ADMIN_MESSAGE:return"admin_msg_cutover_rollback";case d("MAWLocalizationType").DUAL_THREAD_CUTOVER_ADMIN_MESSAGE:return"admin_msg_dual_thread_cutover"}}function t(a,b,c,e,f){return a.table("admin_message_ctas").add({actionUrl:f.actionUrl,adClientToken:f.adClientToken,adHelpUrl:f.adHelpUrl,adminMessageNicknameParticipantId:f.adminMessageNicknameParticipantId,adPreferenceUrl:f.adPreferenceUrl,ctaId:b,messageId:e.msgId,showAdChoiceIcon:f.showAdChoiceIcon,targetId:f.targetId,targetTitle:f.targetTitle,threadKey:c,timestampMs:d("MAWTimeUtils").toTimestamp(e.ts),title:f.title})}function u(a,b,c){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){var e=(yield (i||(i=b("Promise"))).all([q(a,c,d.msgId),o(a)])),f=e[0];e=e[1];if(f!=null)return{ctaId:f.ctaId,ctaType:s(d.adminType),title:f.title};else{f=r(d.adminType);yield t(a,e,c,d,f);return{ctaId:e,ctaType:s(d.adminType),title:f.title}}});return v.apply(this,arguments)}function a(a,c,e){var f=e.adminType;return f!=null&&(d("MAWLocalizationEphemeralSettingSetAdminMsg").isEphemeralSettingSetAdminMsg(f)||f===d("MAWLocalizationType").CUTOVER_THREAD_ADMIN_MESSAGE||f===d("MAWLocalizationType").CUTOVER_IGD_THREAD_ADMIN_MESSAGE||f===d("MAWLocalizationType").E2EE_THREAD_DESCRIPTION||f===d("MAWLocalizationType").CUTOVER_ROLLBACK_ADMIN_MESSAGE||f===d("MAWLocalizationType").DUAL_THREAD_CUTOVER_ADMIN_MESSAGE)?u(a,c,e):(i||(i=b("Promise"))).resolve()}g.getAdminMsgCtaStep=a}),98);
__d("MAWContactRelationshipType",["I64","LSContactBitOffset","MAWDbContact"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=d("LSContactBitOffset").hasWithDefault(64,a,!0);a=(h||(h=d("I64"))).ge(a.contactViewerRelationship,h.of_string("2"));if(a&&b)return d("MAWDbContact").ONE_WAY_CONTACT;else if(!a&&!b)return d("MAWDbContact").REVERSED_ONE_WAY_CONTACT;else if(a&&!b)return d("MAWDbContact").TWO_WAY_CONTACT;return d("MAWDbContact").NON_CONTACT}g.getContactRelationshipType=a}),98);
__d("MAWMedia",["LSIntEnum","MAWDbMedia","MessagingAttachmentType"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){if(a===d("MAWDbMedia").IMAGE)return b!=null?(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").EPHEMERAL_IMAGE):(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE);else if(a===d("MAWDbMedia").VIDEO)return b!=null?(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").EPHEMERAL_VIDEO):(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO);else if(a===d("MAWDbMedia").PTT)return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO);else if(a===d("MAWDbMedia").GIF)return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE);else if(a===d("MAWDbMedia").STICKER)return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").STICKER);else if(a===d("MAWDbMedia").DOCUMENT_FILE)return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").FILE);return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").NONE)}g.mediaTypeToMessageAttachmentType=a}),98);
__d("LSCoreClientFolderType",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:0,PENDING:1,OTHER:2,SPAM:3,ARCHIVED:4,HIDDEN:5,MARKETPLACE:12,RESTRICTED:15});f["default"]=a}),66);
__d("MessagingFolderTag",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:"inbox",OTHER:"other",SPAM:"spam",PENDING:"pending",MONTAGE:"montage",HIDDEN:"hidden",LEGACY:"legacy",DISABLED:"disabled",PAGE_BACKGROUND:"page_background",PAGE_DONE:"page_done",BLOCKED:"blocked",COMMUNITY:"community",RESTRICTED:"restricted",BC_PARTNERSHIP:"bc_partnership",E2EE_CUTOVER:"e2ee_cutover",INTEROP:"interop",ARCHIVED:"archived",UNKNOWN:""});f["default"]=a}),66);
__d("MAWFolderUtils",["LSCoreClientFolderType","LSIntEnum","MAWFolderTypes","MessagingFolderTag"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){switch(a){case d("MAWFolderTypes").PENDING:return c("MessagingFolderTag").PENDING;case d("MAWFolderTypes").OTHER:return c("MessagingFolderTag").OTHER;case d("MAWFolderTypes").SPAM:return c("MessagingFolderTag").SPAM;case d("MAWFolderTypes").ARCHIVED:return c("MessagingFolderTag").UNKNOWN;default:return c("MessagingFolderTag").INBOX}}function b(a){switch(a){case d("MAWFolderTypes").PENDING:return(h||(h=d("LSIntEnum"))).ofNumber(-101);case d("MAWFolderTypes").OTHER:return(h||(h=d("LSIntEnum"))).ofNumber(-102);case d("MAWFolderTypes").SPAM:return(h||(h=d("LSIntEnum"))).ofNumber(-103);case d("MAWFolderTypes").ARCHIVED:return(h||(h=d("LSIntEnum"))).ofNumber(-110);default:return(h||(h=d("LSIntEnum"))).ofNumber(-100)}}function e(a){switch(a){case d("MAWFolderTypes").INBOX:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").INBOX);case d("MAWFolderTypes").PENDING:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").PENDING);case d("MAWFolderTypes").OTHER:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").OTHER);case d("MAWFolderTypes").SPAM:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").SPAM);case d("MAWFolderTypes").ARCHIVED:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").ARCHIVED)}}function f(a){switch(a){case(h||(h=d("LSIntEnum"))).ofNumber(-1):return(h||(h=d("LSIntEnum"))).ofNumber(-101);case(h||(h=d("LSIntEnum"))).ofNumber(-2):return(h||(h=d("LSIntEnum"))).ofNumber(-102);case(h||(h=d("LSIntEnum"))).ofNumber(-3):return(h||(h=d("LSIntEnum"))).ofNumber(-103);case(h||(h=d("LSIntEnum"))).ofNumber(-10):return(h||(h=d("LSIntEnum"))).ofNumber(-110);default:return(h||(h=d("LSIntEnum"))).ofNumber(-100)}}g.getMessagingFolderTag=a;g.getClientSystemFolder=b;g.systemFolderToLSCoreClientFolder=e;g.systemFolderToClientSystemFolder=f}),98);
__d("getMAWLastMessageCtaType",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.snippetType;switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL:return"xma_rtc_missed_audio";case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL:return"xma_rtc_missed_group_audio";case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL:return"xma_rtc_missed_video";case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL:return"xma_rtc_missed_group_video"}}g["default"]=a}),98);
__d("MAWFrontendMediaUtils",["MAWDbMedia"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a==="image/gif")return{mediaType:d("MAWDbMedia").MEDIA_TYPE.GIF,serverMediaType:"gif"};if(a==="image/webp")return{mediaType:d("MAWDbMedia").MEDIA_TYPE.STICKER,serverMediaType:"sticker"};a=a.split("/")[0];switch(a){case"image":if(b===!0)return{mediaType:d("MAWDbMedia").MEDIA_TYPE.IMAGE,serverMediaType:"xma-image"};else return{mediaType:d("MAWDbMedia").MEDIA_TYPE.IMAGE,serverMediaType:"image"};case"video":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.VIDEO,serverMediaType:"video"};case"audio":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.PTT,serverMediaType:"ptt"};case"application":default:return{mediaType:d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE,serverMediaType:"document"}}}g.getMediaTypeAndServerMediaTypeFromBlob=a}),98);
__d("EphemeralMediaViewMode",[],(function(a,b,c,d,e,f){a=Object.freeze({READ_ONCE:0,REPLAYABLE:1,PERMANENT:2});f["default"]=a}),66);
__d("MAWRavenUtils",["EphemeralMediaViewMode","MAWMsg","RavenMessagingState"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:return c("RavenMessagingState").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN:return c("RavenMessagingState").UNSEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN:return c("RavenMessagingState").SEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.REPLAYED:return c("RavenMessagingState").REPLAYED;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.EXPIRED:return c("RavenMessagingState").EXPIRED}};b=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return c("EphemeralMediaViewMode").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:return c("EphemeralMediaViewMode").REPLAYABLE;case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return c("EphemeralMediaViewMode").READ_ONCE}};function a(a,b){switch(b){case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN?c("RavenMessagingState").SEEN:h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN)return c("RavenMessagingState").SEEN;else if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN)return c("RavenMessagingState").REPLAYED;return h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return h(a)}}g.getEphemeralMediaState=h;g.getEphemeralMediaViewMode=b;g.getNextRavenMessageEphemeralState=a}),98);
__d("MNXMAPreviewImageDecorationType",[],(function(a,b,c,d,e,f){a=Object.freeze({DEFAULT:0,COLLAGE:1,VIDEO:2,MESSENGER_ICON:3,INSTAGRAM_ICON:4,SHOPPING:5,UPCOMING_EVENT:6,LIVE:7,REEL:8,IGTV:9,YOUTUBE_VIDEO:10,YOUTUBE_SHORTS:11,COMMENT:12});f["default"]=a}),66);
__d("MAWBridgeNewXMAHandler",["I64","LSIntEnum","MAWBridgeUIEventDataValidation","MAWDbMsg","MAWMiActOnMiThreadReadyForChatId","MNLSXMALayoutType","MNXMAPreviewImageDecorationType","MessagingAttachmentType","Promise","ReQL","WAArmadilloXMA.pb","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b){if(a==null)return;a=a[b-1];if(a==null)return;return a.buttonType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE?"xma_open_native":void 0}function l(a,b){if(a==null)return;a=a[b-1];if(a!=null)return a.title}function m(a){return a===0||a!==3?(i||(i=d("LSIntEnum"))).ofNumber(c("MNLSXMALayoutType").SINGLE):(i||(i=d("LSIntEnum"))).ofNumber(c("MNLSXMALayoutType").PORTRAIT)}function n(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").COLLAGE);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").REEL);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").INSTAGRAM_ICON);default:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").DEFAULT)}}function o(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=String(e.xmaId),o=e.msgId;if(o!=null){var p=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("attachment_ctas"))));p=p!=null?(j||(j=d("I64"))).add(p.ctaId,(j||(j=d("I64"))).one):(j||(j=d("I64"))).one;var q=e.defaultCTA;if(q!=null){var r=q.actionUrl,s=q.nativeUrl,t="xma_web_url";switch(e.targetType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:t="xma_rtc_audio";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:t="xma_rtc_video";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:t="xma_rtc_missed_audio";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:t="xma_rtc_missed_video";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:t="igd_web_post_share";break}var u=e.targetId!=null?d("MAWBridgeUIEventDataValidation").stringToI64Opt(e.targetId):void 0;yield a.table("attachment_ctas").add({actionContentBlob:void 0,actionUrl:r!=null?r:s,attachmentFbid:g,attachmentIndex:(j||(j=d("I64"))).zero,ctaId:p,enableExtensions:!1,extensionHeightType:void 0,messageId:o,nativeUrl:s!=null?s:r,platformToken:void 0,targetId:u,threadKey:f,title:(s=q.title)!=null?s:"",type_:t,urlWebviewType:void 0})}r=q==null?void 0:p;var v=p,w=[];u=e.ctas;if(u!=null){s=u.map(function(b,c){c=(j||(j=d("I64"))).add(v,j.of_int32(c+1));w.push(c);var e=b.actionUrl,h=b.nativeUrl;return a.table("attachment_ctas").add({actionContentBlob:void 0,actionUrl:e!=null?e:h,attachmentFbid:g,attachmentIndex:j.zero,ctaId:c,enableExtensions:!1,extensionHeightType:void 0,messageId:o,nativeUrl:h!=null?h:e,platformToken:void 0,targetId:void 0,threadKey:f,title:(c=b.title)!=null?c:"Tap to view status update",type_:"xma_web_url",urlWebviewType:void 0})});yield (h||(h=b("Promise"))).all(s)}t=(j||(j=d("I64"))).of_int32(d("MAWDbMsg").getInChatMsgIdFromMsgId(o));var x;switch(e.targetType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:x={height:(j||(j=d("I64"))).of_int32(108),width:(j||(j=d("I64"))).of_int32(72),xmaContentType:"xma_montage_share"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:x={xmaContentType:"xma_rtc_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:x={xmaContentType:"xma_rtc_video"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:x={xmaContentType:"xma_rtc_missed_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:x={xmaContentType:"xma_rtc_missed_video"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:x={xmaContentType:"xma_rtc_missed_group_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:x={xmaContentType:"xma_rtc_missed_group_video"};break;default:x={height:e.previewHeight!=null?(j||(j=d("I64"))).of_int32(e.previewHeight):void 0,width:e.previewWidth!=null?(j||(j=d("I64"))).of_int32(e.previewWidth):void 0,xmaContentType:"xma_web_url"};break}return a.table("attachments").add({accessibilitySummaryText:void 0,actionUrl:void 0,attachmentCta1Id:w.length>0?w[0]:void 0,attachmentCta2Id:w.length>1?w[1]:void 0,attachmentCta3Id:w.length>2?w[2]:void 0,attachmentFbid:g,attachmentIndex:j.zero,attachmentLoggingType:void 0,attachmentType:(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA),attributionAppIcon:void 0,attributionAppIconFallback:void 0,attributionAppIconUrlExpirationTimestampMs:void 0,attributionAppId:void 0,attributionAppName:void 0,authorityLevel:j.zero,avatarCount:void 0,avatarViewAccessibilityLabel:void 0,avatarViewSize:void 0,avatarViewTitleList:void 0,avatarViewUrlExpirationTimestampList:void 0,avatarViewUrlFallbackList:void 0,avatarViewUrlList:void 0,captionBodyText:void 0,cta1Title:l(e.ctas,1),cta1Type:k(e.ctas,1),cta2Title:l(e.ctas,2),cta2Type:k(e.ctas,2),cta3Title:l(e.ctas,3),cta3Type:k(e.ctas,3),dashManifest:void 0,decryptionKey:void 0,defaultCtaId:r,defaultCtaTitle:(q=e.defaultCTA)==null?void 0:q.title,defaultCtaType:x.xmaContentType,descriptionText:void 0,ephemeralMediaState:void 0,faviconUrl:void 0,faviconUrlExpirationTimestampMs:void 0,faviconUrlFallback:void 0,filename:void 0,filesize:e.filesize!=null?(j||(j=d("I64"))).of_int32(e.filesize):void 0,gatingTitle:e.overlayTitle,gatingType:e.overlayIconGlyph!=null?String(e.overlayIconGlyph):void 0,hasMedia:!1,hasXma:!0,headerImageUrl:void 0,headerImageUrlExpirationTimestampMs:void 0,headerImageUrlFallback:void 0,headerImageUrlMimeType:void 0,headerTitle:e.headerTitle,imageUrl:void 0,imageUrlExpirationTimestampMs:void 0,imageUrlFallback:void 0,imageUrlMimeType:void 0,isBorderless:void 0,isPreviewImage:void 0,isSharable:!0,listItemAccessibilityText1:void 0,listItemAccessibilityText2:void 0,listItemAccessibilityText3:void 0,listItemContactUrlExpirationTimestampList1:void 0,listItemContactUrlExpirationTimestampList2:void 0,listItemContactUrlExpirationTimestampList3:void 0,listItemContactUrlFallbackList1:void 0,listItemContactUrlFallbackList2:void 0,listItemContactUrlFallbackList3:void 0,listItemContactUrlList1:void 0,listItemContactUrlList2:void 0,listItemContactUrlList3:void 0,listItemId1:void 0,listItemId2:void 0,listItemId3:void 0,listItemProfilePictureUrl1:void 0,listItemProfilePictureUrl2:void 0,listItemProfilePictureUrl3:void 0,listItemProfilePictureUrlExpirationTimestamp1:void 0,listItemProfilePictureUrlExpirationTimestamp2:void 0,listItemProfilePictureUrlExpirationTimestamp3:void 0,listItemProfilePictureUrlFallback1:void 0,listItemProfilePictureUrlFallback2:void 0,listItemProfilePictureUrlFallback3:void 0,listItemProgressBarFilledPercentage1:void 0,listItemProgressBarFilledPercentage2:void 0,listItemProgressBarFilledPercentage3:void 0,listItemsDescriptionSubtitleText:void 0,listItemsDescriptionText:void 0,listItemsId:void 0,listItemsSecondaryDescriptionText:void 0,listItemTitleText1:void 0,listItemTitleText2:void 0,listItemTitleText3:void 0,localPlayableUrl:void 0,maxSubtitleNumOfLines:e.maxSubtitleNumOfLines!=null?(j||(j=d("I64"))).of_int32(e.maxSubtitleNumOfLines):void 0,maxTitleNumOfLines:e.maxTitleNumOfLines!=null?(j||(j=d("I64"))).of_int32(e.maxTitleNumOfLines):void 0,messageId:o,miniPreview:void 0,offlineAttachmentId:(p=e.offlineAttachmentId)!=null?p:g,originalFileHash:void 0,originalPageSenderId:void 0,playableDurationMs:void 0,playableUrl:void 0,playableUrlExpirationTimestampMs:void 0,playableUrlFallback:void 0,playableUrlMimeType:void 0,preheaderText:void 0,previewHeight:x.height,previewHeightLarge:e.previewHeightLarge!=null?(j||(j=d("I64"))).of_int32(e.previewHeightLarge):void 0,previewImageDecorationType:n(e.targetType),previewUrl:void 0,previewUrlExpirationTimestampMs:void 0,previewUrlFallback:void 0,previewUrlLarge:void 0,previewUrlMimeType:void 0,previewWidth:x.width,previewWidthLarge:e.previewWidthLarge!=null?(j||(j=d("I64"))).of_int32(e.previewWidthLarge):void 0,samplingFrequencyHz:void 0,shouldAutoplayVideo:void 0,shouldHighlightHeaderTitleInTitle:void 0,shouldRespectServerPreviewSize:void 0,sourceText:void 0,subtitleIconUrl:void 0,subtitleText:e.subtitleText,targetId:void 0,threadKey:f,timestampMs:t,titleText:e.titleText,viewerSeenTimestampMs:void 0,waveformData:void 0,xmaLayoutType:e.xmaLayoutType!=null?m(e.xmaLayoutType):void 0,xmasTemplateType:e.xmaLayoutType!=null?m(e.xmaLayoutType):void 0})}});return p.apply(this,arguments)}function q(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeNewXMAHandler",function(a,c){return o(a,b,c)})}function a(a,b){return q(a,b)}g.call=a}),98);
__d("MAWBridgeDeleteGroupInviteHandler",["MAWMiActOnMiThreadReadyForChatId","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeDeleteGroupInviteHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("group_invites")).getKeyRange(c)));return(h||(h=b("Promise"))).all(c.map(function(b){return a.table("group_invites")["delete"](b.threadKey,b.inviterId,b.inviteeId)})).then(function(){})});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeDeleteMessageRangesV2Handler",["I64","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeDeleteMessageRangesV2Handler",function(a,c){return a.table("messages_ranges_v2__generated")["delete"](c,(h||(h=d("I64"))).of_float(b.minTimestampMs),b.minMsgId)})}g.call=a}),98);
__d("MAWBridgeDeleteMessagesHandler",["MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeDeleteMessagesHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){for(var e of c.messages)yield a.table("messages")["delete"](b,d("MAWTimeUtils").toTimestamp(e.ts),e.msgId)});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeDeleteReactionHandler",["I64","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeDeleteReactionHandler",function(a,c){return a.table("reactions")["delete"](c,b.messageId,(h||(h=d("I64"))).of_string(b.actorId))})}g.call=a}),98);
__d("MAWBridgeGroupInfoUpdatedHandler",["MAWMiActOnMiThreadReadyForChatId","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeGroupInfoUpdatedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;e=(e=c.threadName)!=null?e:void 0;a=a.table("threads");b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(b)));if(b==null)return;return a.put(babelHelpers["extends"]({},b,{threadName:e}))});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeGroupInviteLoadedHandler",["fbt","I64","LSMessagingThreadTypeUtil","MAWMiActOnMiThreadReadyForChatId","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";var i;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeGroupInviteLoadedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.table("threads"),f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e).getKeyRange(b)));if(f==null)return;var g=d("LSMessagingThreadTypeUtil").isGroup(f.threadType);if(!g)return;var j=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("group_invites")).getKeyRange(b)));if(j==null)return;g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("contacts")).filter(function(a){return!(i||(i=d("I64"))).equal((i||(i=d("I64"))).of_string(c.actorId),j.inviterId)&&(i||(i=d("I64"))).equal(a.id,j.inviterId)})));if(g==null)return;b=h._("__JHASH__UJFQkCMRFkv__JHASH__",[h._param("Inviter Name",g.name)]).toString();a=f.folderName==="inbox"?h._("__JHASH__4F6x7gUU1-S__JHASH__").toString():f.additionalThreadContext;return e.put(babelHelpers["extends"]({},f,{additionalThreadContext:a,snippet:b}))});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeGroupInviteUpdateHandler",["I64","MAWMiActOnMiThreadReadyForChatId","MAWUpdateLSThreadCapabilities","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeGroupInviteUpdateHandler",function(a,e){var f=(i||(i=d("I64"))).of_string(c.inviterId);return(h||(h=b("Promise"))).all([d("MAWUpdateLSThreadCapabilities").setGroupInviteTxn(a,e,f)]).then(function(){})})}g.call=a}),98);
__d("MAWBridgeHandleCOPDigest",["I64","LSIntEnum","LSOfflineQueueStatus","Promise","ReQL","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,e){e=e.map(function(b){var e=(i||(i=d("I64"))).of_string(d("WAJids").switchOnMsgrChatJidType(b.from,{group:function(a){return d("WAJids").groupIdFromJid(a)},user:function(a){return d("WAJids").userIdFromJid(a)}}));return d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("offline_queue_thread_status")).getKeyRange(e)).then(function(f){if(f==null)return a.table("offline_queue_thread_status").put({latestMessageTimestampMs:(i||(i=d("I64"))).of_float(b.t),offlineQueueStatus:(j||(j=d("LSIntEnum"))).ofNumber(c("LSOfflineQueueStatus").INITIALIZING),threadJid:e});else return a.table("offline_queue_thread_status").upsert([f.threadJid],{latestMessageTimestampMs:(i||(i=d("I64"))).of_float(b.t),offlineQueueStatus:f.offlineQueueStatus,threadJid:f.threadJid})})});return(h||(h=b("Promise"))).all(e).then(function(){})}g.call=a}),98);
__d("MAWBridgeMediaExpiredHandler",["MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeMediaExpiredHandler.bs",function(a,c){return a.table("attachments")["delete"](c,b.msgId,String(b.mediaId))})}g.call=a}),98);
__d("MAWBridgeMsgRangeLoadedHandler",["I64","LSFactory","LSInsertNewMessageRangeStoredProcedure","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No messages found for thread "," with message id ",""]);j=function(){return a};return a}function a(a,e){if(e.rangeExtensionType==null){d("WALogger").ERROR(j(),e.threadId,e.offsetMsgId);return(i||(i=b("Promise"))).resolve()}return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeMsgRangeLoadedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var f,g,i,j,k,l;f=((f=e.rangeExtensionType)==null?void 0:f.minMsgTs)!=null?(h||(h=d("I64"))).of_float(e.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;g=((g=e.rangeExtensionType)==null?void 0:g.maxMsgTs)!=null?(h||(h=d("I64"))).of_float(e.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;i=(i=(i=e.rangeExtensionType)==null?void 0:i.minMsgId)!=null?i:"";j=(j=(j=e.rangeExtensionType)==null?void 0:j.maxMsgId)!=null?j:"";k=(k=(k=e.rangeExtensionType)==null?void 0:k.hasMoreBefore)!=null?k:!1;l=(l=(l=e.rangeExtensionType)==null?void 0:l.hasMoreAfter)!=null?l:!1;var m=e.offsetMsgId;yield c("LSInsertNewMessageRangeStoredProcedure")(c("LSFactory")(a),{hasMoreAfter:l,hasMoreBefore:k,lowerOverlap:f,newMaxMid:j,newMaxTs:g,newMinMid:i,newMinTs:f,requestedMessageId:m,threadKey:b,upperOverlap:g})});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeMsgUpdatedHandler",["I64","LSIntEnum","MAWAckLevel","MAWAdminMsgCTA","MAWMiActOnMiThreadReadyForChatId","MAWMsgReplySnippet","MAWUpdateMsg","MWChatInteraction","MWLSLogSend","QPLUserFlow","ReQL","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){var e=d("MWChatInteraction").get(d("MWChatInteraction").s2sKey(a));a=d("MWLSLogSend").getS2sKeyFromOfflineMessageId(a);if(e!=null){var f=d("MAWAckLevel").levelToMessagingSendStatusV2(b.ack);(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(2))?d("MWChatInteraction").addMarkerPoint(e,"received_successful_server_ack"):(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(4))&&d("MWChatInteraction").addMarkerPoint(e,"received_failure_server_ack")}if(a!=null){f=d("MAWAckLevel").levelToMessagingSendStatusV2(b.ack);(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(2))?c("QPLUserFlow").endSuccess(c("qpl")._(25313175,"1551"),{instanceKey:a}):(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(4))&&c("QPLUserFlow").endFailure(c("qpl")._(25313175,"1551"),"error_from_server",{instanceKey:a})}}function a(a,c,e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(c,e.chatId,"MAWBridgeMsgUpdatedHandler",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c){var f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("messages")).getKeyRange(c).filter(function(a){return a.messageId===e.msgId})));if(f==null)return;var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("attachments")).getKeyRange(c,e.msgId)));g=[f.offlineThreadingId,g==null?void 0:g.offlineAttachmentId];g.forEach(function(a){a!=null&&j(a,e)});g=(yield d("MAWAdminMsgCTA").getAdminMsgCtaStep(b,c,e));c=(yield d("MAWMsgReplySnippet").getReplySnippet(a,b,e,c));return d("MAWUpdateMsg").call(a,b,e,f,g,c)});return function(a,b){return c.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeMsgsLoadedHandler",["I64","LSClearMessagePlaceholderRangeStoredProcedure","LSFactory","LSInsertNewMessageRangeStoredProcedure","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeMsgsLoadedHandler",function(a,e){return c("LSClearMessagePlaceholderRangeStoredProcedure")(c("LSFactory")(a),{maxTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,messageId:"",threadKey:e}).then(function(){if(c("gkx")("6884")){var f,g,i,j,k,l,m,n;f=(f=(f=b.rangeExtensionType)==null?void 0:f.hasMoreBefore)!=null?f:!1;g=(g=(g=b.rangeExtensionType)==null?void 0:g.hasMoreAfter)!=null?g:!1;i=f&&((i=b.rangeExtensionType)==null?void 0:i.minMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;j=g&&((j=b.rangeExtensionType)==null?void 0:j.maxMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;k=(k=(k=b.rangeExtensionType)==null?void 0:k.minMsgId)!=null?k:"";l=(l=(l=b.rangeExtensionType)==null?void 0:l.maxMsgId)!=null?l:"";m=((m=b.rangeExtensionType)==null?void 0:m.rangeKind)==="before"?i:d("MAWTimeUtils").MIN_TIMESTAMP_MS;n=((n=b.rangeExtensionType)==null?void 0:n.rangeKind)==="after"?j:d("MAWTimeUtils").MAX_TIMESTAMP_MS;return c("LSInsertNewMessageRangeStoredProcedure")(c("LSFactory")(a),{hasMoreAfter:g,hasMoreBefore:f,lowerOverlap:m,newMaxMid:l,newMaxTs:j,newMinMid:k,newMinTs:i,threadKey:e,upperOverlap:n})}else{f=((g=b.rangeExtensionType)==null?void 0:g.minMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;l=((m=b.rangeExtensionType)==null?void 0:m.maxMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;i=(k=(j=b.rangeExtensionType)==null?void 0:j.minMsgId)!=null?k:"";m=(g=(n=b.rangeExtensionType)==null?void 0:n.maxMsgId)!=null?g:"";k=((j=b.rangeExtensionType)==null?void 0:j.rangeKind)==="extensionBefore"?f:d("MAWTimeUtils").MIN_TIMESTAMP_MS;g=((n=b.rangeExtensionType)==null?void 0:n.rangeKind)==="extensionAfter"?l:d("MAWTimeUtils").MAX_TIMESTAMP_MS;j=(n=(j=b.rangeExtensionType)==null?void 0:j.hasMoreBefore)!=null?n:!1;n=(n=(n=b.rangeExtensionType)==null?void 0:n.hasMoreAfter)!=null?n:!1;return c("LSInsertNewMessageRangeStoredProcedure")(c("LSFactory")(a),{hasMoreAfter:n,hasMoreBefore:j,lowerOverlap:k,newMaxMid:m,newMaxTs:l,newMinMid:i,newMinTs:f,threadKey:e,upperOverlap:g})}})})}g.call=a}),98);
__d("MAWEphemeralMessageExpirationStorage",["LSDatabaseSingleton","MAWBridgeDeleteMessagesHandler","Promise","asyncToGeneratorRuntime","clearTimeout","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new Map();function k(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){yield (i||(i=b("Promise"))).all(c.map(function(b){var c=b.ts,e=b.chatId,f=b.msgId;f={msgId:f,threadId:e,ts:c};e=b.chatId;c=[f];b={messages:c,threadId:e};return d("MAWBridgeDeleteMessagesHandler").call(a,b)})),j["delete"](e)});return l.apply(this,arguments)}function m(a,d,e){return c("setTimeout")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=(yield h||(h=c("LSDatabaseSingleton")));c("promiseDone")(e.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield k(b,a,d)});return function(a){return c.apply(this,arguments)}}(),"readwrite"))}),e)}function a(a,b,d,e){a=j.get(d);var f;if(a==null)f=[b];else{c("clearTimeout")(a.timeoutId);var g=a.msgs.map(function(a){return a.msgId}).indexOf(b.msgId)===-1;g&&a.msgs.push(b);f=a.msgs}g=m(f,d,e);j.set(d,{expirationTs:d,msgs:f,timeoutId:g})}function e(a){var b=a.msgId;a=j.get(a.countdownTs);if(a==null)return;b=a.msgs.map(function(a){return a.msgId}).indexOf(b);if(b>-1){a.msgs.splice(b,1);return}}g.setMessageForExpiration=a;g.clearMessageFromExpiration=e}),98);
__d("MAWBridgeMsgsStartCountdownHandler",["I64","MAWEphemeralMessageExpirationStorage","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){return c.msgs.reduce(function(c,e){return c.then(function(){d("MAWEphemeralMessageExpirationStorage").setMessageForExpiration(a,e,e.countdownTs,e.millisecondsUntilCountdownTs);(i||(i=d("I64"))).of_int32(e.millisecondsUntilCountdownTs);return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.chatId,"MAWBridgeMsgsStartCountdownHandler",function(a,c){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("messages")).getKeyRange(c,d("MAWTimeUtils").toTimestamp(e.ts),e.msgId)).then(function(c){if(c==null)return(h||(h=b("Promise"))).resolve();c=babelHelpers["extends"]({},c,{ephemeralExpirationTs:(i||(i=d("I64"))).of_float(e.countdownTs)});return a.table("messages").put(c)})})})},(h||(h=b("Promise"))).resolve())}g.call=a}),98);
__d("MAWBridgeNewMediaHandler",["I64","MAWMedia","MAWMiActOnMiThreadReadyForChatId","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,c,e,f,g){return{attachmentFbid:e,attachmentIndex:(e=a==null?void 0:a.attachmentIndex)!=null?e:(i||(i=d("I64"))).zero,attachmentType:(e=a==null?void 0:a.attachmentType)!=null?e:d("MAWMedia").mediaTypeToMessageAttachmentType(b.mediaType,b.ephemeralMediaViewMode),authorityLevel:(e=a==null?void 0:a.authorityLevel)!=null?e:(i||(i=d("I64"))).zero,ephemeralMediaState:b.ephemeralMediaState!=null?(i||(i=d("I64"))).of_int32(b.ephemeralMediaState):a==null?void 0:a.ephemeralMediaState,ephemeralMediaViewMode:b.ephemeralMediaViewMode!=null?(i||(i=d("I64"))).of_int32(b.ephemeralMediaViewMode):a==null?void 0:a.ephemeralMediaViewMode,filename:(e=(e=b.filenames!=null?b.filenames[c]:null)!=null?e:b.defaultFilename)!=null?e:a==null?void 0:a.filename,filesize:b.filesize==null?a==null?void 0:a.filesize:(i||(i=d("I64"))).of_int32(b.filesize),hasMedia:b.hasMedia,hasXma:!1,isSharable:!1,messageId:c,offlineAttachmentId:f,playableDurationMs:b.duration==null?a==null?void 0:a.playableDurationMs:(i||(i=d("I64"))).of_int32(b.duration),previewHeight:b.previewHeight==null?a==null?void 0:a.previewHeight:(i||(i=d("I64"))).of_int32(b.previewHeight),previewHeightLarge:b.previewHeightLarge==null?a==null?void 0:a.previewHeightLarge:(i||(i=d("I64"))).of_int32(b.previewHeightLarge),previewWidth:b.previewWidth==null?a==null?void 0:a.previewWidth:(i||(i=d("I64"))).of_int32(b.previewWidth),previewWidthLarge:b.previewWidthLarge==null?a==null?void 0:a.previewWidthLarge:(i||(i=d("I64"))).of_int32(b.previewWidthLarge),threadKey:g,timestampMs:(i||(i=d("I64"))).of_int32(b.ts)}}function k(a,c){var e=c.mediaId,f=c.msgIds,g=c.offlineAttachmentId,i=c.threadId;return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,i,"MAWBridgeNewMediaHandler",function(a,i){var k,l=e.toString(),m=(k=g)!=null?k:l;return(h||(h=b("Promise"))).all(f.map(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=a.table("attachments"),f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e).getKeyRange(i,b)));b=j(f,c,b,l,m,i);return f!=null?e.put(babelHelpers["extends"]({},f,b)):e.add(b)});return function(a){return e.apply(this,arguments)}}())).then(function(){})})}function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield k(a,b)});return l.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeNewMediaRangeHandler",["I64","LSFactory","LSIntEnum","LSThreadMediaGalleryGroup","LSUpsertAttachmentRangeStoredProcedure","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeNewMediaRangeHandler",function(a,e){var f=(h||(h=d("I64"))).of_int32(b.minMsgRowId),g=b.hasMoreBefore;return c("LSUpsertAttachmentRangeStoredProcedure")(c("LSFactory")(a),{hasMoreBefore:g,mediaGroup:(i||(i=d("LSIntEnum"))).ofNumber(c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS),newMinTs:f,threadKey:e})})}function a(a,b){return j(a,b).then(function(){})}g.call=a}),98);
__d("MAWBridgeNewMsgHandler",["I64","LSAuthorityLevel","LSIntEnum","LSMessageUnsendabilityStatus","LSQuickReplyType","MAWAckLevel","MAWAdminMsgCTA","MAWBridgeBuildMsg","MAWBridgeMsg","MAWMiActOnMiThreadReadyForChatId","MAWMsg","MAWMsgReply","MAWMsgReplySnippet","MAWMsgReplyStatus","MAWTimeUtils","MAWUpdateMsg","Promise","ReQL","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b,c,d,e,f){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h){var k;k=d("MAWTimeUtils").toTimestamp(f.type_===d("MAWMsg").unsent?(k=f.originalTs)!=null?k:f.ts:f.ts);a=(yield d("MAWBridgeBuildMsg").buildMessage(a,b,f,k));return b.table("messages").add(babelHelpers["extends"]({},a,{adminMsgCtaId:g==null?void 0:g.ctaId,adminMsgCtaTitle:g==null?void 0:g.title,adminMsgCtaType:g==null?void 0:g.ctaType,authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),cannotUnsendReason:f.type_===d("MAWMsg").unsent||!f.isAuthorMe?(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageUnsendabilityStatus").DENY_FOR_NON_SENDER):void 0,displayedContentTypes:d("MAWMsg").getDisplayedContentTypes(f.type_,f.isForwarded,f.isExpiredXmaMsg),editCount:(j||(j=d("I64"))).of_int32(0),ephemeralDurationInSec:d("MAWBridgeBuildMsg").getEphemeralDurationInSec(f),ephemeralExpirationTs:void 0,forwardScore:j.of_float(f.forwardingScore),hasQuickReplies:!1,hotEmojiSize:d("MAWBridgeMsg").getSpecialTextSize(f),isAdminMessage:f.isAdminMessage,isCollapsed:!1,isForwarded:f.isForwarded,isUnsent:f.type_===d("MAWMsg").unsent,localDataId:void 0,messageId:f.msgId,msUntilExpirationTs:void 0,offlineThreadingId:f.externalId!=null?f.externalId:f.msgId,primarySortKey:j.of_float(f.sortOrderMs),quickReplyType:i.ofNumber(c("LSQuickReplyType").NONE),replyAttachmentExtra:void 0,replyAttachmentId:d("MAWMsgReply").getReplyAttachmentId(f),replyAttachmentType:d("MAWMsgReply").getReplyAttachmentType(f),replyCtaId:void 0,replyCtaTitle:void 0,replyMediaExpirationTimestampMs:d("MAWMsgReply").getReplyMediaExpirationTimestampMs(f),replyMediaPreviewHeight:d("MAWMsgReply").getReplyMediaHeight(f),replyMediaPreviewWidth:d("MAWMsgReply").getReplyMediaWidth(f),replyMediaUrl:void 0,replyMediaUrlFallback:void 0,replyMediaUrlMimeType:d("MAWMsgReply").getReplyMediaMimeType(f),replySnippet:h,replySourceId:d("MAWMsgReply").getReplySourceId(f),replySourceTimestampMs:d("MAWMsgReply").getReplySourceTimestampMs(f),replySourceType:d("MAWMsgReply").getReplySourceType(f),replySourceTypeV2:d("MAWMsgReply").getReplySourceTypeV2(f),replyStatus:d("MAWMsgReplyStatus").getLSReplyMessageStatus(f),replyToUserId:d("MAWMsgReply").getReplyUserId(f),replyType:void 0,secondarySortKey:void 0,senderId:j.of_string(f.sender),sendStatus:d("MAWAckLevel").levelToMessagingSendStatus(f.ack),sendStatusV2:d("MAWAckLevel").levelToMessagingSendStatusV2(f.ack),stickerId:void 0,subscriptErrorMessage:void 0,takedownState:void 0,textHasLinks:!1,threadKey:e,timestampMs:k,unsentTimestampMs:d("MAWTimeUtils").toTimestamp(f.ts),viewedPluginContext:void 0,viewedPluginKey:void 0,viewFlags:i.ofNumber(0)}))});return l.apply(this,arguments)}function m(a,e,f){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(e,f.chatId,"BridgeNewMsgHandler",function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(g,l){var m=(yield d("MAWAdminMsgCTA").getAdminMsgCtaStep(g,l,f)),n=(yield d("MAWMsgReplySnippet").getReplySnippet(a,g,f,l)),o=f.offlineMsg;if(o==null)return k(a,g,l,f,m,n);o=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(g.table("messages")).getKeyRange(l,(j||(j=d("I64"))).of_float(o.ts),o.msgId)));if(o==null){var p=!1;if(c("gkx")("8015")&&f.externalId!=null){var q=f.externalId;o=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(g.table("messages").index("optimistic")).getKeyRange(q)));if(o!=null){(j||(j=d("I64"))).to_int32(o.authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC&&(p=!0,yield d("MAWUpdateMsg").call(a,g,f,o,m,n));q=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(g.table("attachments")).getKeyRange(l,q)));yield (h||(h=b("Promise"))).all(q.filter(function(a){return(j||(j=d("I64"))).to_int32(a.authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC}).map(function(a){return e.table("attachments").put(babelHelpers["extends"]({},a,{authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),messageId:f.msgId}))}));return h.resolve()}}if(!p)return k(a,g,l,f,m,n)}else return d("MAWUpdateMsg").call(a,g,f,o,m,n);return(h||(h=b("Promise"))).resolve()});return function(a,b){return g.apply(this,arguments)}}())}function a(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){yield (h||(h=b("Promise"))).all(d.map(function(b){return m(a,c,b)}))});return n.apply(this,arguments)}g.call=m;g.bulkCall=a}),98);
__d("MAWThreadDefaults",["fbt","I64","LSBitOffset","LSIntEnum","gkx","qex"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;function k(){if(c("qex")._("327")===!0)return!0;else return c("qex")._("121")===!0}function a(a){if(k())return d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(42),a);else return a}function b(a){if(c("gkx")("7045"))return d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(4),a);else return a}function e(a){return c("qex")._("227")?d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(7),a):a}function f(a){return c("qex")._("229")?d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(6),a):a}function l(a){return c("qex")._("231")?d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(9),a):a}var m=d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(25),d("LSBitOffset").set(j.ofNumber(24),d("LSBitOffset").set(j.ofNumber(18),d("LSBitOffset").set(j.ofNumber(56),d("LSBitOffset").set(j.ofNumber(17),d("LSBitOffset").set(j.ofNumber(14),d("LSBitOffset").set(j.ofNumber(23),d("LSBitOffset").set(j.ofNumber(8),d("LSBitOffset").set(j.ofNumber(15),d("LSBitOffset").set(j.ofNumber(2),d("LSBitOffset").empty))))))))));a=a(b(e(f(l(d("LSBitOffset").set(j.ofNumber(10),d("LSBitOffset").set(j.ofNumber(19),d("LSBitOffset").set(j.ofNumber(35),d("LSBitOffset").set(j.ofNumber(43),m)))))))));b=d("LSBitOffset").set(j.ofNumber(17),d("LSBitOffset").set(j.ofNumber(60),d("LSBitOffset").set(j.ofNumber(16),d("LSBitOffset").set(j.ofNumber(26),d("LSBitOffset").set(j.ofNumber(28),d("LSBitOffset").clear(j.ofNumber(27),a))))));e=d("LSBitOffset").set((i||(i=d("I64"))).sub(j.ofNumber(103),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(85),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(109),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(74),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(65),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(64),i.of_string("64")),d("LSBitOffset").empty))))));f=h._("__JHASH__9ZFn8zMzjpf__JHASH__").toString();g.defaultThreadCapabilities=a;g.defaultGroupThreadCapabilities=b;g.defaultThreadCapabilities_2=e;g.nullstateDescriptionText1=f;g.defaultThreadCapabilities_3=d("LSBitOffset").empty;g.defaultThreadCapabilities_4=d("LSBitOffset").empty}),98);
__d("MAWBridgeOccamadilloVerifyThreadExistsHandler",["FBLogger","I64","LSAuthorityLevel","LSCoreClientFolderType","LSCreateE2EEMetadataThreadStoredProcedure","LSCreateOfflineThreadingIDStoredProcedure","LSFactory","LSIntEnum","LSThreadBitOffset","MAWFolderUtils","MAWJidUtils","MAWMiActGetThreadLifecycleState","MAWMiActOnActThreadReadyQueue","MAWMiActOnMiThreadReadyQueue","MAWMiActThreadLifecycleState","MAWThreadDefaults","MAWTimeUtils","Promise","WALoggerDeferred","WATimeUtils","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 3. Thread loading is fully complete for threadKey: ",", JID: ",", and state: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 2. Handle new authoritative thread for threadKey: ",", JID: ",", and state: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 1. Let MI server know about WA thread for JID: "," and state: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 5. Authoritative thread not found for chatId: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Thread is missing in Occamadillo verify thread exists"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Creating e2ee metadata optimistic thread.\n  threadKey: ","\n  bumpTimestampMs: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Detected 0 for last activity timestamp from MI for thread: ",", using local state timestamp: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] no folder type was supplied to Occamadillo verify thread exists handler"]);r=function(){return a};return a}function s(a){return(j||(j=d("I64"))).of_string(d("MAWJidUtils").threadIdForChatJid(a))}function t(a){a=d("MAWFolderUtils").systemFolderToLSCoreClientFolder(a);a==null&&(c("promiseDone")(d("WALoggerDeferred").WARN(r())),a=(j||(j=d("I64"))).of_int32(c("LSCoreClientFolderType").INBOX));return a}function u(a,e){return e==null?c("LSCreateOfflineThreadingIDStoredProcedure")(a,{timestampMs:(j||(j=d("I64"))).of_float(Date.now())}).then(function(a){return a[0]}):(h||(h=b("Promise"))).resolve((j||(j=d("I64"))).of_string(e))}function v(a){a=d("MAWTimeUtils").millisTimeToTimestamp(a);return(j||(j=d("I64"))).equal(a,(j||(j=d("I64"))).of_int32(0))?d("MAWTimeUtils").millisTimeToTimestamp(d("WATimeUtils").millisTime()):a}function w(a,b){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=c("LSFactory")(a),f=v(b.lastActivityTs),g=(yield u(e,b.clientThreadKey)),h=(j||(j=d("I64"))).of_int32(b.chatId),k=t(b.folder),l=s(b.jid);b=b.isGroup?(i||(i=d("LSIntEnum"))).ofNumber(16):(i||(i=d("LSIntEnum"))).ofNumber(15);yield a.table("mi_act_mapping_table").put({clientThreadPk:h,jid:l,serverThreadKey:g});c("promiseDone")(d("WALoggerDeferred").LOG(p(),j.to_string(g),j.to_string(f)));return c("LSCreateE2EEMetadataThreadStoredProcedure")(e,{bumpTimestampMs:f,folderType:k,offlineThreadKey:g,threadType:b,waJid:l})});return x.apply(this,arguments)}function y(a,b,e){a=a;(j||(j=d("I64"))).equal(a,(j||(j=d("I64"))).of_int32(0))&&(c("promiseDone")(d("WALoggerDeferred").WARN(q(),(j||(j=d("I64"))).to_string(e),j.to_string(b))),a=b);return a}function z(a,b){var c=[],e=105;a=d("LSThreadBitOffset").has(e,a);a&&c.push(e);return d("LSThreadBitOffset").set(c,b?d("MAWThreadDefaults").defaultGroupThreadCapabilities:d("MAWThreadDefaults").defaultThreadCapabilities,d("MAWThreadDefaults").defaultThreadCapabilities_2,d("MAWThreadDefaults").defaultThreadCapabilities_3,d("MAWThreadDefaults").defaultThreadCapabilities_4)}function A(a,b,c){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=(yield a.table("threads").get(e));if(g==null){c("promiseDone")(d("WALoggerDeferred").ERROR(o()));return(h||(h=b("Promise"))).resolve()}var i=f.clientThreadKey!=null?(j||(j=d("I64"))).of_string(f.clientThreadKey):g.clientThreadKey,k=y(g.lastActivityTimestampMs,d("MAWTimeUtils").millisTimeToTimestamp(f.lastActivityTs),e),l=d("MAWTimeUtils").millisTimeToTimestamp(f.lastReadTs);f=z(g,f.isGroup);return a.table("threads").upsert([e],babelHelpers["extends"]({},g,{capabilities:f[0],capabilities2:f[1],capabilities3:f[2],capabilities4:f[3],clientThreadKey:i,lastActivityTimestampMs:k,lastReadWatermarkTimestampMs:l}))});return B.apply(this,arguments)}function C(a,b,c){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){yield a.table("mi_act_mapping_table").put({clientThreadPk:(j||(j=d("I64"))).of_int32(e.chatId),jid:s(e.jid),serverThreadKey:c}),yield (h||(h=b("Promise"))).all([A(a,c,e),E(a,c,e)])});return D.apply(this,arguments)}function E(a,b,c){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(c.clientThreadKey!=null){c=(j||(j=d("I64"))).of_string(c.clientThreadKey);(j||(j=d("I64"))).equal(b,c)||(yield a.table("threads")["delete"](c))}});return F.apply(this,arguments)}function G(a,b,c){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=(yield a.table("threads").get(e));g!=null&&(j||(j=d("I64"))).to_int32(g.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE&&(yield (h||(h=b("Promise"))).all([A(a,e,f),E(a,e,f)]));g==null&&c("promiseDone")(d("WALoggerDeferred").LOG(n(),f.chatId))});return H.apply(this,arguments)}function I(a,b){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=(j||(j=d("I64"))).of_string(d("MAWJidUtils").threadIdForChatJid(b.jid));e=(yield d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJid(a,e,"MAWBridgeOccamadilloVerifyThreadExistsHandler"));switch(e.type){case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY_BY_JID:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY_BY_CHAT_ID:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD:c("promiseDone")(d("WALoggerDeferred").LOG(m(),b.jid,e.type));return w(a,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:var f=(j||(j=d("I64"))).to_string(e.serverThreadKey);c("promiseDone")(d("WALoggerDeferred").LOG(l(),f,b.jid,e.type));return C(a,e.serverThreadKey,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE:f=(j||(j=d("I64"))).to_string(e.serverThreadKey);c("promiseDone")(d("WALoggerDeferred").LOG(k(),f,b.jid,e.type));return G(a,e.serverThreadKey,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.THREAD_KEY_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT:throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[Occamadillo] Unimplemented VerifyThreadExists state: %s for JID: %s",e.type,b.jid);default:e.type;throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[Occamadillo] Unhandled VerifyThreadExists state: %s for JID: %s",e.type,b.jid)}});return J.apply(this,arguments)}function a(a,b){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield I(a,b);if(b.clientThreadKey!=null){var e=(j||(j=d("I64"))).of_string(b==null?void 0:b.clientThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.chatId,b.jid))}if(b.authoritativeThreadKey!=null){e=(j||(j=d("I64"))).of_string(b.authoritativeThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.chatId,b.jid))}e=(e=b.authoritativeThreadKey)!=null?e:b.clientThreadKey;if(e!=null)return d("MAWMiActOnMiThreadReadyQueue").processQueueOnMiThreadReady(a,(j||(j=d("I64"))).of_string(e),b.chatId,b.jid);return});return K.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeOneToOneMessageRequestLoadedHandler",["fbt","I64","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWContactRelationshipType","MAWDbContact","MAWMessageRequestUtil","MAWMiActOnMiThreadReadyForChatId","Promise","ReQL"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k;function a(a,e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeOneToOneMessageRequestLoadedHandler",function(a,f){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(f)).then(function(c){if(c==null)return(k||(k=b("Promise"))).resolve([void 0,void 0,void 0,!1]);var f=d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("contacts")).getKeyRange((i||(i=d("I64"))).of_string(e.fbid)));return(k||(k=b("Promise"))).all([k.resolve(c),f,k.resolve(e.relationship),k.resolve(d("LSMessagingThreadTypeUtil").isOneToOne(c.threadType))])}).then(function(e){var f=e[0];if(f==null)return(k||(k=b("Promise"))).resolve();var g=e[1];if(g==null)return(k||(k=b("Promise"))).resolve();var l=e[2];if(l==null)return(k||(k=b("Promise"))).resolve();if(!e[3])return(k||(k=b("Promise"))).resolve();e=(i||(i=d("I64"))).equal(g.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))?d("MAWContactRelationshipType").getContactRelationshipType(g):l;if(f.folderName==="pending"||f.folderName==="other"||f.folderName==="spam"||f.folderName==="inbox"&&e===d("MAWDbContact").REVERSED_ONE_WAY_CONTACT&&!(i||(i=d("I64"))).equal(f.lastActivityTimestampMs,(i||(i=d("I64"))).zero)){g=d("LSThreadBitOffset").clear(d("MAWMessageRequestUtil").disabledThreadCapabilitiesForIncomingRequest,f.capabilities,f.capabilities2,f.capabilities3,f.capabilities4);l=f.folderName==="inbox"?h._("__JHASH__4F6x7gUU1-S__JHASH__").toString():void 0;e=[d("LSThreadBitOffset").set(d("MAWMessageRequestUtil").enabledThreadCapabilitiesForIncomingRequest,g[0],g[1],g[2],g[3]),l]}else e=[[f.capabilities,f.capabilities2,f.capabilities3,f.capabilities4],void 0];g=e[0];l=babelHelpers["extends"]({},f,{additionalThreadContext:e[1],capabilities:g[0],capabilities2:g[1],capabilities3:g[2],capabilities4:g[3]});return a.table("threads").put(l).then(function(){})})})}g.call=a}),98);
__d("MAWBridgeParticipantRemovedHandler",["I64","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeParticipantRemovedHandler",function(a,c){return a.table("participants")["delete"](c,(h||(h=d("I64"))).of_string(b.userId))})}g.call=a}),98);
__d("MAWBridgeParticipantUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","MAWCurrentUser","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","MAWUpdateLSThreadCapabilities","Promise","ReQLTable"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=d("MAWCurrentUser").getID(),m=(k||(k=d("I64"))).of_string(l);function a(a,e){if(e.fbid.startsWith("shadow_"))return(i||(i=b("Promise"))).resolve();else return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeParticipantUpdatedHandler",function(a,f){var g=(k||(k=d("I64"))).of_string(e.fbid),n=d("MAWTimeUtils").toTimestamp(e.readWatermarkTs),o=d("MAWTimeUtils").toTimestamp(e.deliveredWatermarkTs),p=d("MAWTimeUtils").toTimestamp(e.lastReadActionTs),q=e.isSuperAdmin?h._("__JHASH__I9SRoIOJzWH__JHASH__").toString():void 0,r={contents:!1},s={contents:!1};return d("ReQLTable").update(a.table("participants"),[f,g],function(a){if(a!=null){s.contents=!0;return{authorityLevel:a.authorityLevel,contactId:g,deliveredWatermarkTimestampMs:o,groupParticipantJoinState:e.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:a.isSuperAdmin,nickname:a.nickname,normalizedSearchTerms:a.normalizedSearchTerms,participantCapabilities:a.participantCapabilities,readActionTimestampMs:p,readWatermarkTimestampMs:n,subscribeSource:q,threadKey:f}}else{s.contents=!0;r.contents=!0;return{authorityLevel:(k||(k=d("I64"))).zero,contactId:g,deliveredWatermarkTimestampMs:o,groupParticipantJoinState:e.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:e.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:k.zero,readWatermarkTimestampMs:n,subscribeSource:q,threadKey:f}}}).then(function(){if(s.contents)return d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,f).then(function(){var c=(k||(k=d("I64"))).equal(m,g),h=e.isAdmin;if(c)if(h)return d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,f);else return d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,f);else return(i||(i=b("Promise"))).resolve()});else return(i||(i=b("Promise"))).resolve()}).then(function(){if(r.contents)return c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:g,isBlocked:!1,isMemorialized:!1,isSelf:l===e.fbid,workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)});else return(i||(i=b("Promise"))).resolve()})})}g.call=a}),98);
__d("MAWBridgeParticipantsUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","MAWCurrentUser","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","MAWUpdateLSThreadCapabilities","Promise","ReQLTable","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=d("MAWCurrentUser").getID(),m=(k||(k=d("I64"))).of_string(l);function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e=e.participants.filter(function(a){return!a.fbid.startsWith("shadow_")});yield (i||(i=b("Promise"))).all(e.map(function(e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeParticipantsUpdatedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var f=(k||(k=d("I64"))).of_string(e.fbid),g=d("MAWTimeUtils").toTimestamp(e.readWatermarkTs),i=d("MAWTimeUtils").toTimestamp(e.deliveredWatermarkTs),n=d("MAWTimeUtils").toTimestamp(e.lastReadActionTs),o=e.isSuperAdmin?h._("__JHASH__-gVxfbL98KU__JHASH__").toString():void 0,p=!1,q=!1;yield d("ReQLTable").update(a.table("participants"),[b,f],function(a){if(a!=null){q=!0;return{authorityLevel:a.authorityLevel,contactId:f,deliveredWatermarkTimestampMs:(k||(k=d("I64"))).equal(i,(k||(k=d("I64"))).zero)?a.deliveredWatermarkTimestampMs:i,groupParticipantJoinState:e.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:a.isSuperAdmin,nickname:a.nickname,normalizedSearchTerms:a.normalizedSearchTerms,participantCapabilities:a.participantCapabilities,readActionTimestampMs:(k||(k=d("I64"))).equal(n,(k||(k=d("I64"))).zero)?a.readActionTimestampMs:n,readWatermarkTimestampMs:(k||(k=d("I64"))).equal(g,(k||(k=d("I64"))).zero)?a.readWatermarkTimestampMs:g,subscribeSource:o,threadKey:b}}else{q=!0;p=!0;return{authorityLevel:(k||(k=d("I64"))).zero,contactId:f,deliveredWatermarkTimestampMs:i,groupParticipantJoinState:e.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:e.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:k.zero,readWatermarkTimestampMs:g,subscribeSource:o,threadKey:b}}});q&&(yield d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,b),(k||(k=d("I64"))).equal(m,f)&&(e.isAdmin?yield d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,b):yield d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,b)));p&&(yield c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:f,isBlocked:!1,isMemorialized:!1,isSelf:l===e.fbid,workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)}))});return function(b,c){return a.apply(this,arguments)}}())}))});return n.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeRavenActionMsgForUIHandler",["I64","MAWMiActOnMiThreadReadyForChatId","MAWMsg","MAWRavenUtils","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeRavenActionMsgForUIHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){a=a.table("attachments");e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(e,c.ravenMsgId)));if(e==null)return(i||(i=b("Promise"))).resolve();if(e.ephemeralMediaState==null)return(i||(i=b("Promise"))).resolve();var f=(h||(h=d("I64"))).to_int32(e.ephemeralMediaState);if(e.ephemeralMediaViewMode==null)return(i||(i=b("Promise"))).resolve();var g=h.to_int32(e.ephemeralMediaViewMode);f=d("MAWMsg").MAWRavenMsgEphemeralMediaState.cast(f);g=d("MAWMsg").MAWRavenMsgEphemeralType.cast(g);if(f==null||g==null)return(i||(i=b("Promise"))).resolve();f=d("MAWRavenUtils").getNextRavenMessageEphemeralState(f,g);if(f==null)return(i||(i=b("Promise"))).resolve();e.ephemeralMediaState;g=babelHelpers.objectWithoutPropertiesLoose(e,["ephemeralMediaState"]);e=babelHelpers["extends"]({ephemeralMediaState:h.of_int32(f)},g);f=[g.threadKey,g.messageId,g.attachmentFbid];return a.upsert(f,e)});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeReactionUpsertHandler",["I64","LSAuthorityLevel","LSIntEnum","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeReactionUpsertHandler",function(a,e){return a.table("reactions").upsert([e,b.messageId,(h||(h=d("I64"))).of_string(b.actorId)],{actorId:h.of_string(b.actorId),authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),messageId:b.messageId,reaction:b.reaction,threadKey:e,timestampMs:d("MAWTimeUtils").toTimestamp(b.ts)})})}function a(a,b,e,f,g,j){return a.table("reactions").upsert([e,f,(h||(h=d("I64"))).of_string(b)],{actorId:h.of_string(b),authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),messageId:f,reaction:j,threadKey:e,timestampMs:d("MAWTimeUtils").toTimestamp(g)})}function b(a,b){return j(a,b).then(function(){})}g.attachmentMutationsOptimisticHandler=a;g.call=b}),98);
__d("MAWBridgeReceivedChatStateHandler",["I64","MAWMiActOnMiThreadReadyForChatId","Promise","ServerTime","WAChatState"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeReceivedChatStateHandler",function(a,e){var f=(i||(i=d("I64"))).of_string(c.senderId),g=i.of_float(3e3+d("ServerTime").getMillis());if(c.state===d("WAChatState").TYPING)return a.table("typing_indicator").upsert([e,f],{expirationTimestampMs:g,senderId:f,threadKey:e}).then(function(){});else if(c.state===d("WAChatState").IDLE)return a.table("typing_indicator")["delete"](e,f).then(function(){});else return(h||(h=b("Promise"))).resolve()})}g.call=a}),98);
__d("MAWBridgeReceivedReceiptHandler",["I64","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeReceivedReceiptHandler",function(a,e){var f=(i||(i=d("I64"))).of_string(c.fbid),g=d("MAWTimeUtils").toTimestamp(c.lastReadWatermarkTs),j=d("MAWTimeUtils").toTimestamp(c.deliveredWatermarkTs),k=d("MAWTimeUtils").toTimestamp(c.lastReadActionTs);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("participants")).getKeyRange(e,f)).then(function(c){if(c!=null)return a.table("participants").put({authorityLevel:c.authorityLevel,contactId:c.contactId,deliveredWatermarkTimestampMs:(i||(i=d("I64"))).equal(j,(i||(i=d("I64"))).zero)?c.deliveredWatermarkTimestampMs:j,groupParticipantJoinState:c.groupParticipantJoinState,isAdmin:c.isAdmin,isModerator:c.isModerator,isSuperAdmin:c.isSuperAdmin,nickname:c.nickname,normalizedSearchTerms:c.normalizedSearchTerms,participantCapabilities:c.participantCapabilities,readActionTimestampMs:(i||(i=d("I64"))).equal(k,(i||(i=d("I64"))).zero)?c.readActionTimestampMs:k,readWatermarkTimestampMs:(i||(i=d("I64"))).equal(g,(i||(i=d("I64"))).zero)?c.readWatermarkTimestampMs:g,subscribeSource:c.subscribeSource,threadKey:c.threadKey,threadRoles:(i||(i=d("I64"))).zero});else return(h||(h=b("Promise"))).resolve()}).then(function(){})})}g.call=a}),98);
__d("MAWBridgeSyncContacts",["CurrentUser","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("CurrentUser").getID();function a(a,e){return e.reduce(function(b,e){var f=(i||(i=d("I64"))).of_string(e);return b.then(function(){return c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:f,isBlocked:!1,isMemorialized:!1,isSelf:k===e,workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)})}).then(function(){})},(h||(h=b("Promise"))).resolve())}g.call=a}),98);
__d("MAWBridgeBuildThreadSnippet",["MAWAdminMsg","MAWBridgeBuildMsgMentions","MAWDbChatId","MAWLocalizationType","MAWMiActOnMiThreadReadyForChatId","MAWVault","ReQL","asyncToGeneratorRuntime","first"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=null?d("MAWVault").unvault(a):void 0}function i(a,b,c){if(a==null)return b;b=[].concat(b);switch(c){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:b[0]=a;break}return b}function a(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=e.snippetContactIDs,j=e.snippetMentionJIDs,l=e.snippetParams,m=e.snippetType,n=e.threadId;if(l==null||m==null||g==null)return f;e=(yield d("MAWBridgeBuildMsgMentions").buildThreadSnippetWithMentions(a,b,n,h(c("first")(l)),j,g,m,function(b){var c=b[0];b=b[1];c=d("MAWAdminMsg").buildLocalizedString(i(c,l,m),b,m);return k(a,n,c)}));f=e[0];b=e[1];return d("MAWAdminMsg").buildLocalizedString(i(f,l,m),b,m)});return j.apply(this,arguments)}function k(a,c,e){return a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,d("MAWDbChatId").unsafeCoerceToChatId(c),"MAWBridgeBuildThreadSnippet",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=a.table("threads");b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(b)));b&&(yield a.put(babelHelpers["extends"]({},b,{snippet:e})))});return function(b,c){return a.apply(this,arguments)}}())});return function(b){return a.apply(this,arguments)}}(),"readwrite")}g.buildBridgeThreadSnippet=a}),98);
__d("MAWBridgeThreadBumpedHandler",["I64","MAWBridgeBuildThreadSnippet","MAWBumpThread","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","ReQL","asyncToGeneratorRuntime","getMAWLastMessageCtaType"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e,f){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(e,f.threadId,"MAWBridgeThreadBumpedHandler",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("threads")).getKeyRange(e)));if(g==null)return;g=(yield d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(a,b,f,g.snippet));var i=f.snippetSenderContactId!=null?(h||(h=d("I64"))).of_string(f.snippetSenderContactId):void 0,j=c("getMAWLastMessageCtaType")(f);return d("MAWBumpThread").threadMutation(b,e,d("MAWTimeUtils").millisTimeToTimestamp(f.lastActivityTs),d("MAWTimeUtils").millisTimeToTimestamp(f.lastReadTs),g,i,j)});return function(a,b){return e.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeThreadBumpedServerHandler",["I64","LSBumpE2EEMetadataThreadStoredProcedure","LSFactory","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","WALoggerDeferred","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Bumping thread on server. threadKey: ",", bumpTimestampMs: ",", isLocalDeviceSend: ",""]);i=function(){return a};return a}function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeThreadBumpedServerHandle",function(a,e){var f=b.lastActivityTs;f=d("MAWTimeUtils").millisTimeToTimestamp(f);c("promiseDone")(d("WALoggerDeferred").LOG(i(),(h||(h=d("I64"))).to_string(e),h.to_string(f),b.isCurrentDeviceSendingMsg));return c("LSBumpE2EEMetadataThreadStoredProcedure")(c("LSFactory")(a),{bumpedByLocalDeviceSend:b.isCurrentDeviceSendingMsg,serverAuthoritativeTimestampMs:f,threadKey:e})})}g.call=a}),98);
__d("MAWBridgeThreadHiddenHandler",["LSFactory","LSIntEnum","LSOptimisticRemoveThreadStoredProcedure","LSThreadRemoveType","MAWDbChatId","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,d("MAWDbChatId").unsafeCoerceToChatId(b),"MAWBridgeThreadHiddenHandler",function(a,b){a=c("LSFactory")(a);return c("LSOptimisticRemoveThreadStoredProcedure")(a,{removeType:(h||(h=d("LSIntEnum"))).ofNumber(c("LSThreadRemoveType").DELETE_THREAD),threadKey:b})})}g.call=a}),98);
__d("MAWBridgeThreadTimestampsHandler",["CurrentUser","I64","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeThreadTimestampsHandler",function(a,e){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(e)).then(function(e){if(e==null)return(i||(i=b("Promise"))).resolve();e=babelHelpers["extends"]({},e,{lastReadWatermarkTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.lastReadWatermarkTs)});return a.table("threads").put(e)})})}function a(a,e){return j(a,e).then(function(){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeThreadTimestampsHandler",function(a,f){var g=(h||(h=d("I64"))).of_string(c("CurrentUser").getID());return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("participants")).getKeyRange(f,g)).then(function(c){if(c!=null)return a.table("participants").put({authorityLevel:c.authorityLevel,contactId:c.contactId,deliveredWatermarkTimestampMs:c.deliveredWatermarkTimestampMs,groupParticipantJoinState:c.groupParticipantJoinState,isAdmin:c.isAdmin,isModerator:c.isModerator,isSuperAdmin:c.isSuperAdmin,nickname:c.nickname,normalizedSearchTerms:c.normalizedSearchTerms,participantCapabilities:c.participantCapabilities,readActionTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(e.lastActivityTimestampMs),readWatermarkTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(e.lastReadWatermarkTs),subscribeSource:c.subscribeSource,threadKey:c.threadKey});else return(i||(i=b("Promise"))).resolve()})})})}g.call=a}),98);
__d("MAWBridgeThreadUpdatedHandler",["FBLogger","I64","LSBitOffset","MAWBridgeBuildThreadSnippet","MAWBridgeUIEventDataValidation","MAWFolderUtils","MAWMiActOnMiThreadReadyForChatId","ReQL","asyncToGeneratorRuntime","getMAWLastMessageCtaType"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return b!=null&&b==="viewer_not_subscribed"?d("LSBitOffset").clear((h||(h=d("I64"))).sub(h.of_int32(28),h.of_string("64")),a):a}function j(a,b){var c=b.folder!=null?d("MAWFolderUtils").getMessagingFolderTag(b.folder):a.folderName;return(b=b.cannotReplyReason)!=null?b:c==="inbox"?void 0:a.cannotReplyReason}function a(a,e,f){var g=f.muteExpireTimeMs,k=f.snippetSenderContactId,l=f.threadId;return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(e,l,"MAWBridgeThreadUpdatedHandler",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("threads")).getKeyRange(e)));if(e==null)return;f.fromCheckIfParticipant!=null&&f.fromCheckIfParticipant&&c("FBLogger")("labyrinth_web","checkIfParticipant").warn("[Occamdillo] User not a participant from checkIfParticipant, thread folder: %s",e.folderName);var l=(yield d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(a,b,f,e.snippet)),m=j(e,f),n=c("getMAWLastMessageCtaType")(f);return b.table("threads").put(babelHelpers["extends"]({},e,{cannotReplyReason:m,capabilities2:i(e.capabilities2,m),folderName:e.folderName,lastMessageCtaType:n,muteExpireTimeMs:g==null?e.muteExpireTimeMs:(h||(h=d("I64"))).of_float(g),parentThreadKey:e.parentThreadKey,snippet:l,snippetSenderContactId:k==null?e.snippetSenderContactId:d("MAWBridgeUIEventDataValidation").stringToI64Opt(k)}))});return function(a,b){return e.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeThreadsLoadedHandler",["I64","MAWFolderUtils","MAWThreadId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){var e=d("MAWFolderUtils").getClientSystemFolder(c.folderId);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads_ranges_v2__generated")).getKeyRange(e)).then(function(f){if(f!=null)return a.table("threads_ranges_v2__generated")["delete"](f.parentThreadKey,f.minThreadKey,f.minLastActivityTimestampMs).then(function(){return c.rangeKind==="threadRangeExtensionForLoadBefore"?d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,c.minThreadId).then(function(b){if(b!=null)return a.table("threads_ranges_v2__generated").put({hasMoreAfter:f.hasMoreAfter,hasMoreBefore:c.hasMore,isLoadingAfter:f.isLoadingAfter,isLoadingBefore:!1,maxLastActivityTimestampMs:f.maxLastActivityTimestampMs,maxThreadKey:f.maxThreadKey,minLastActivityTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.minLastActivityTs),minThreadKey:b,parentThreadKey:f.parentThreadKey})}):a.table("threads_ranges_v2__generated").put({hasMoreAfter:f.hasMoreAfter,hasMoreBefore:f.hasMoreBefore,isLoadingAfter:f.isLoadingAfter,isLoadingBefore:!1,maxLastActivityTimestampMs:f.maxLastActivityTimestampMs,maxThreadKey:f.maxThreadKey,minLastActivityTimestampMs:f.minLastActivityTimestampMs,minThreadKey:f.minThreadKey,parentThreadKey:f.parentThreadKey})});switch(c.rangeKind){case"initialNoThread":return a.table("threads_ranges_v2__generated").put({hasMoreAfter:!1,hasMoreBefore:!1,isLoadingAfter:!1,isLoadingBefore:!1,maxLastActivityTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,maxThreadKey:(i||(i=d("I64"))).zero,minLastActivityTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,minThreadKey:(i||(i=d("I64"))).zero,parentThreadKey:e});case"initialThreadRange":return(h||(h=b("Promise"))).all([d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,c.minThreadId),d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,c.maxThreadId)]).then(function(b){var f=b[0];b=b[1];if(f!=null&&b!=null)return a.table("threads_ranges_v2__generated").add({hasMoreAfter:!1,hasMoreBefore:c.hasMore,isLoadingAfter:!1,isLoadingBefore:!1,maxLastActivityTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.maxLastActivityTs),maxThreadKey:b,minLastActivityTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.minLastActivityTs),minThreadKey:f,parentThreadKey:e})});case"threadRangeExtensionForLoadBefore":return(h||(h=b("Promise"))).resolve()}})}g.call=a}),98);
__d("MAWBridgeUIEventQueueQPLLogger",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("QPLUserFlow").start(c("qpl")._(1056849266,"1765"),{annotations:{string_array:{events:b}},instanceKey:a})}function b(a){c("QPLUserFlow").endSuccess(c("qpl")._(1056849266,"1765"),{instanceKey:a})}function d(a,b){c("QPLUserFlow").endFailure(c("qpl")._(1056849266,"1765"),"MAWBridgeUIEventHandlerFailure",{annotations:{string:{failedEventTag:b}},instanceKey:a})}g.start=a;g.endSuccess=b;g.endFailure=d}),98);
__d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve()}f.call=a}),66);
__d("MAWBridgeUpdateE2EEMetadataParticipantsHandler",["LSFactory","LSUpdateE2EEMetadataParticipantsStoredProcedure","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeThreadsLoadedHandler",function(a,b){return c("LSUpdateE2EEMetadataParticipantsStoredProcedure")(c("LSFactory")(a),{threadKey:b})})}g.call=a}),98);
__d("MAWBridgeUpdateMessageRangeHandler",["I64","LSClearMessagePlaceholderRangeStoredProcedure","LSFactory","LSInsertNewMessageRangeStoredProcedure","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeUpdateMessageRangeHandler",function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,f){var g;yield c("LSClearMessagePlaceholderRangeStoredProcedure")(c("LSFactory")(b),{maxTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,messageId:"",threadKey:f});var i=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("messages_ranges_v2__generated")).getKeyRange(f)));i!=null&&(yield a.table("messages_ranges_v2__generated")["delete"](i.threadKey,i.minTimestampMs,i.minMessageId));var j=e.hasMoreAfter,k=e.hasMoreBefore,l=e.maxMsgId,m=e.minMsgId,n=k&&e.minMsgTs!=null?(h||(h=d("I64"))).of_float(e.minMsgTs):(i==null?void 0:i.minTimestampMs)||d("MAWTimeUtils").MIN_TIMESTAMP_MS,o=(i==null?void 0:i.minTimestampMs)!=null&&(h||(h=d("I64"))).lt(i==null?void 0:i.minTimestampMs,n),p=j&&e.maxMsgTs!=null?(h||(h=d("I64"))).of_float(e.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS,q=d("MAWTimeUtils").MIN_TIMESTAMP_MS;g=(g=p)!=null?g:d("MAWTimeUtils").MAX_TIMESTAMP_MS;return c("LSInsertNewMessageRangeStoredProcedure")(c("LSFactory")(b),{hasMoreAfter:j,hasMoreBefore:o?(i==null?void 0:i.hasMoreBefore)||!0:k,lowerOverlap:q,newMaxMid:(b=l)!=null?b:"",newMaxTs:p,newMinMid:o?(j=i==null?void 0:i.minMessageId)!=null?j:"":(k=m)!=null?k:"",newMinTs:o?(i==null?void 0:i.minTimestampMs)||d("MAWTimeUtils").MIN_TIMESTAMP_MS:n,threadKey:f,upperOverlap:g})});return function(a,b){return f.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeUpdateMinMessageHandler",["I64","MAWMiActOnMiThreadReadyForChatId","ReQL","ReQLTable","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var e=(h||(h=d("I64"))).of_float(b.minTimestampMs),f=b.minMessageId;return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeUpdateMinMessageHandler",function(a,g){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("messages_ranges_v2__generated")).getKeyRange(g)).then(function(h){if(h==null)return;var i=b.hasMoreBefore,j=i!=null?i:h.hasMoreBefore;return d("ReQLTable").update(a.table("messages_ranges_v2__generated"),[g,h.minTimestampMs,h.minMessageId],function(a){if(a!=null)return{hasMoreAfter:a.hasMoreAfter,hasMoreBefore:j,isLoadingAfter:a.isLoadingAfter,isLoadingBefore:a.isLoadingBefore,maxMessageId:a.maxMessageId,maxTimestampMs:a.maxTimestampMs,minMessageId:f,minTimestampMs:e,threadKey:a.threadKey};throw c("unrecoverableViolation")("Thread is missing in updating the min message in message range","messenger_e2ee_web")})})})}g.call=a}),98);
__d("MAWBridgeXMAShareExpiredHandler",["MAWMiActOnMiThreadReadyForChatId","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){var e=String(c.xmaId);return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.chatId,"MAWBridgeXMAShareExpiredHandler",function(a,d){return a.table("attachments").get(d,c.msgId,e).then(function(f){if(f==null)return(h||(h=b("Promise"))).resolve();f=[f.defaultCtaId,f.attachmentCta1Id,f.attachmentCta2Id,f.attachmentCta3Id].filter(Boolean);f=f.map(function(b){return a.table("attachment_ctas")["delete"](b)});return(h||(h=b("Promise"))).all(f).then(function(){return a.table("attachments")["delete"](d,c.msgId,e)})})})}g.call=a}),98);
__d("MAWBridgeXMAShareTombstonedHandler",["FBLogger","MAWMiActOnMiThreadReadyForChatId","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e){var f=String(e.xmaId);return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeXMAShareTombstonedHandler",function(a,g){return a.table("attachments").get(g,e.msgId,f).then(function(i){if(i==null)return(h||(h=b("Promise"))).resolve();i=[i.defaultCtaId,i.attachmentCta1Id,i.attachmentCta2Id,i.attachmentCta3Id].filter(Boolean);i=i.map(function(b){return a.table("attachment_ctas")["delete"](b)});return(h||(h=b("Promise"))).all(i).then(function(){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("attachments")).getKeyRange(g,e.msgId,f)).then(function(d){if(d!=null){d=babelHelpers["extends"]({},d,{attachmentCta1Id:void 0,attachmentCta2Id:void 0,attachmentCta3Id:void 0,cta1Title:void 0,cta1Type:void 0,cta2Title:void 0,cta2Type:void 0,cta3Title:void 0,cta3Type:void 0,defaultCtaId:void 0,defaultCtaTitle:void 0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,previewHeight:void 0,previewHeightLarge:void 0,previewWidth:void 0,previewWidthLarge:void 0,subtitleText:void 0,titleText:void 0});return a.table("attachments").put(d)}c("FBLogger")("messenger_e2ee_web").blameToPreviousFrame().mustfix("Trying to tombstone a secure xma attachment but no existing attachment");return(h||(h=b("Promise"))).resolve()})})})})}g.call=a}),98);
__d("MAWBridgeUIEventHandler",["FBLogger","JSResourceForInteraction","MAWAbPropsClient","MAWBridgeDeleteGroupInviteHandler","MAWBridgeDeleteMessageRangesV2Handler","MAWBridgeDeleteMessagesHandler","MAWBridgeDeleteReactionHandler","MAWBridgeDropAllSecureThreadsHandler","MAWBridgeGroupInfoUpdatedHandler","MAWBridgeGroupInviteLoadedHandler","MAWBridgeGroupInviteUpdateHandler","MAWBridgeHandleCOPDigest","MAWBridgeMediaExpiredHandler","MAWBridgeMsgRangeLoadedHandler","MAWBridgeMsgUpdatedHandler","MAWBridgeMsgsLoadedHandler","MAWBridgeMsgsStartCountdownHandler","MAWBridgeNewMediaHandler","MAWBridgeNewMediaRangeHandler","MAWBridgeNewMsgHandler","MAWBridgeNewXMAHandler","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWBridgeOneToOneMessageRequestLoadedHandler","MAWBridgeParticipantRemovedHandler","MAWBridgeParticipantUpdatedHandler","MAWBridgeParticipantsUpdatedHandler","MAWBridgeRavenActionMsgForUIHandler","MAWBridgeReactionUpsertHandler","MAWBridgeReceivedChatStateHandler","MAWBridgeReceivedReceiptHandler","MAWBridgeSyncContacts","MAWBridgeThreadBumpedHandler","MAWBridgeThreadBumpedServerHandler","MAWBridgeThreadHiddenHandler","MAWBridgeThreadTimestampsHandler","MAWBridgeThreadUpdatedHandler","MAWBridgeThreadsLoadedHandler","MAWBridgeUIEventQPLLogger","MAWBridgeUIEventQueueQPLLogger","MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler","MAWBridgeUpdateClientRestoreStatus","MAWBridgeUpdateE2EEMetadataParticipantsHandler","MAWBridgeUpdateMessageRangeHandler","MAWBridgeUpdateMinMessageHandler","MAWBridgeXMAShareExpiredHandler","MAWBridgeXMAShareTombstonedHandler","MAWEphemeralMessageExpirationStorage","Promise","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","getErrorSafe","gkx","isArmadillo","promiseDone","recoverableViolation","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle UI Events: ",""]);i=function(){return a};return a}var j=(f=c("requireDeferred"))("MAWBridgeIssuePointQueryHandler").__setRef("MAWBridgeUIEventHandler"),k=f("MAWBridgeStartTraceHandler").__setRef("MAWBridgeUIEventHandler"),l=f("MAWBridgeStartTraceWithTraceIdHandler").__setRef("MAWBridgeUIEventHandler"),m=f("MAWBridgeTraceRecordCheckpointHandler").__setRef("MAWBridgeUIEventHandler"),n=f("MAWBridgeUpdateDyiStatus").__setRef("MAWBridgeUIEventHandler"),o=f("MAWBridgeUpdateTraceHandler").__setRef("MAWBridgeUIEventHandler"),p=f("MAWBridgeUploadMessageByBatchHandler").__setRef("MAWBridgeUIEventHandler"),q=f("MAWBridgeUploadMessageHandler").__setRef("MAWBridgeUIEventHandler"),r=f("MAWBridgeUploadProtoBackupMsgsHandler").__setRef("MAWBridgeUIEventHandler"),s=f("MAWBridgeUploadThreadHandler").__setRef("MAWBridgeUIEventHandler"),t=c("gkx")("9017")===!0;function u(a,e,f){switch(f.tag){case"NewMsg":return d("MAWBridgeNewMsgHandler").call(a,e,f.value);case"MsgsStartCountdown":return d("MAWBridgeMsgsStartCountdownHandler").call(e,f.value);case"MsgClearCountdown":return(h||(h=b("Promise"))).resolve(d("MAWEphemeralMessageExpirationStorage").clearMessageFromExpiration(f.value));case"DropAllSecureThreads":return d("MAWBridgeDropAllSecureThreadsHandler").call(e);case"VerifyThreadExists":var g=f.value;return d("MAWBridgeOccamadilloVerifyThreadExistsHandler").call(e,g);case"MsgUpdated":return d("MAWBridgeMsgUpdatedHandler").call(a,e,f.value);case"NewMedia":return d("MAWBridgeNewMediaHandler").call(e,f.value);case"NewMediaRange":return d("MAWBridgeNewMediaRangeHandler").call(e,f.value);case"MediaExpired":return d("MAWBridgeMediaExpiredHandler").call(e,f.value);case"XMAShareExpired":return d("MAWBridgeXMAShareExpiredHandler").call(e,f.value);case"NewXMA":return d("MAWBridgeNewXMAHandler").call(e,f.value);case"XMAShareTombstoned":return d("MAWBridgeXMAShareTombstonedHandler").call(e,f.value);case"ParticipantUpdated":return d("MAWBridgeParticipantUpdatedHandler").call(e,f.value);case"ParticipantRemoved":return d("MAWBridgeParticipantRemovedHandler").call(e,f.value);case"UpdateE2EEMetadataParticipants":return d("MAWBridgeUpdateE2EEMetadataParticipantsHandler").call(e,f.value);case"ReceivedReceipt":return d("MAWBridgeReceivedReceiptHandler").call(e,f.value);case"ThreadUpdated":return d("MAWBridgeThreadUpdatedHandler").call(a,e,f.value);case"GroupInfoUpdated":return d("MAWBridgeGroupInfoUpdatedHandler").call(e,f.value);case"ThreadBumped":return d("MAWBridgeThreadBumpedHandler").call(a,e,f.value);case"ThreadsLoaded":return d("MAWBridgeThreadsLoadedHandler").call(e,f.value);case"ThreadTimestampsUpdated":return d("MAWBridgeThreadTimestampsHandler").call(e,f.value);case"MsgsLoaded":return d("MAWBridgeMsgsLoadedHandler").call(e,f.value);case"MsgRangeLoaded":return d("MAWBridgeMsgRangeLoadedHandler").call(e,f.value);case"StartTrace":return k.load().then(function(a){return a.call(e,f.value)});case"UpdateTrace":return o.load().then(function(a){return a.call(e,f.value)});case"ThreadHidden":return d("MAWBridgeThreadHiddenHandler").call(e,f.value);case"SyncContacts":return d("MAWBridgeSyncContacts").call(e,f.value);case"ReceivedChatState":return d("MAWBridgeReceivedChatStateHandler").call(e,f.value);case"ClockSkewUpdated":return(h||(h=b("Promise"))).resolve(d("WATimeUtils").setClockSkew(f.value));case"ABPropsUpdated":return(h||(h=b("Promise"))).resolve(d("MAWAbPropsClient").rewrite(f.value));case"COPDigestReceived":return d("MAWBridgeHandleCOPDigest").call(e,f.value);case"UpsertReaction":return d("MAWBridgeReactionUpsertHandler").call(e,f.value);case"DeleteReaction":return d("MAWBridgeDeleteReactionHandler").call(e,f.value);case"UploadMessage":return q.load().then(function(a){return a.call(e,f.value)});case"UploadProtoBackupMsgs":return r.load().then(function(a){return a.call(e,f.value)});case"UploadMessageByBatch":return p.load().then(function(a){return a.call(e,f.value)});case"UploadThread":return s.load().then(function(a){return a.call(e,f.value)});case"UploadAttachment":return c("JSResourceForInteraction")("MAWBridgeUploadAttachmentHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"ResignAttachmentCDNUrl":return c("JSResourceForInteraction")("MAWBridgeResignAttachmentCDNUrlHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"DeleteMessages":return d("MAWBridgeDeleteMessagesHandler").call(e,f.value);case"RestoreMessageBatch":return c("JSResourceForInteraction")("MAWBridgeRestoreMessageBatchHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"OneToOneMessageRequestLoaded":return d("MAWBridgeOneToOneMessageRequestLoadedHandler").call(e,f.value);case"GroupInviteUpdate":return d("MAWBridgeGroupInviteUpdateHandler").call(e,f.value);case"UpdateDyiStatus":return n.load().then(function(a){return a.call(e,f.value)});case"DeleteGroupInvite":return d("MAWBridgeDeleteGroupInviteHandler").call(e,f.value);case"TraceRecordCheckpoint":return m.load().then(function(a){return a.call(e,f.value)});case"DeleteMessageRangesV2":return d("MAWBridgeDeleteMessageRangesV2Handler").call(e,f.value);case"UpdateMinMessage":return d("MAWBridgeUpdateMinMessageHandler").call(e,f.value);case"IssuePointQuery":return j.load().then(function(a){return a.call(e,f.value)});case"ThreadBumpedServer":return d("MAWBridgeThreadBumpedServerHandler").call(e,f.value);case"ParticipantsUpdated":return d("MAWBridgeParticipantsUpdatedHandler").call(e,f.value);case"StartTraceWithTraceId":return l.load().then(function(a){return a.call(e,f.value)});case"UpdateClientRestoreStatus":return d("MAWBridgeUpdateClientRestoreStatus").call(e,f.value);case"NewMsgs":return d("MAWBridgeNewMsgHandler").bulkCall(a,e,f.value.msgs);case"UnArchivedSelfDeviceChangeAlerts":return d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler").call(e,f.value);case"EphemeralSettingsUpdatedForUI":return c("JSResourceForInteraction")("MAWBridgeEphemeralSettingsUpdatedForUIHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"RavenActionUpdate":return d("MAWBridgeRavenActionMsgForUIHandler").call(e,f.value);case"GroupInviteLoaded":return d("MAWBridgeGroupInviteLoadedHandler").call(e,f.value);case"UpdateMessageRange":return d("MAWBridgeUpdateMessageRangeHandler").call(e,f.value);default:return(h||(h=b("Promise"))).resolve()}}function a(a,b){if(t)return;if(!c("isArmadillo")()){c("recoverableViolation")("User is neither part of armadillo QE and dual send QE but somehow loaded this handler","messenger_web_product");return}var e={};e=b.reduce(function(a,b){a[b.tag]=((b=a[b.tag])!=null?b:0)+1;return a},e);d("WATagsLogger").TAGS(["MAWBridgeUIEvent"]).LOG(i(),e);c("promiseDone")(v(a,b))}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=(yield a);a=d("MAWBridgeUIEventQPLLogger").getInstanceKey();var g=e.map(function(a){return a.tag}),h="";d("MAWBridgeUIEventQueueQPLLogger").start(a,g);var i;try{i=(yield f.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){for(var b=0;b<e.length;b++){var g=e[b],i=d("MAWBridgeUIEventQPLLogger").getInstanceKey();d("MAWBridgeUIEventQPLLogger").start(i,g,{suppress:t});try{yield u(f,a,g),d("MAWBridgeUIEventQPLLogger").endSuccess(i)}catch(a){var j=c("getErrorSafe")(a);h=g.tag;d("MAWBridgeUIEventQPLLogger").endFailure(i,g.tag);c("FBLogger")("messenger_e2ee_web").catching(j).mustfix("[MAWBridgeUIEventHandler] Failed to handle UI event: %s",g.tag);return!1}}return!0});return function(b){return a.apply(this,arguments)}}(),"readwrite"))}catch(a){c("FBLogger")("messenger_e2ee_web").catching(a).info("DbError handling UI events"),i=!1}!i?(d("MAWBridgeUIEventQueueQPLLogger").endFailure(a,h),c("FBLogger")("messenger_e2ee_web").mustfix("MAWBridgeUIEventHandler] Did not commit UI events to DB: %s",g.toString())):d("MAWBridgeUIEventQueueQPLLogger").endSuccess(a)});return w.apply(this,arguments)}function e(a,b,c){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=d("MAWBridgeUIEventQPLLogger").getInstanceKey();try{d("MAWBridgeUIEventQPLLogger").start(f,e,{suppress:t}),yield u(a,b,e),d("MAWBridgeUIEventQPLLogger").endSuccess(f)}catch(b){a=c("getErrorSafe")(b);d("MAWBridgeUIEventQPLLogger").endFailure(f,e.tag);c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("[handleShimEvent] Failed to handle UI event: %s",e.tag);c("FBLogger")("messenger_e2ee_web").mustfix("handleShimEvent] Did not commit UI events to DB: %s",e.tag);throw b}});return x.apply(this,arguments)}g.handleEvents=a;g.handleShimEvent=e}),98);
__d("MAWOccamadilloOnMutexChange",["I64","LSDefaultSyncGroups","LSIntEnum","LSSyncGroupsUtils","Promise","WALogger","isOccamadilloResumeSyncEnabled","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Resetting sync cursor and network request"]);k=function(){return a};return a}function l(a){var e=d("LSDefaultSyncGroups").e2eeMetadataSyncGroup;if(!c("isOccamadilloResumeSyncEnabled")()&&e!=null)return a.table("sync_groups").put(babelHelpers["extends"]({},d("LSSyncGroupsUtils").defaultSyncGroup,{groupId:(j||(j=d("LSIntEnum"))).ofNumber(e.groupId)}));else return(h||(h=b("Promise"))).resolve()}function m(a){if(!c("isOccamadilloResumeSyncEnabled")())return a.table("network_requests").put({epochId:void 0,failureCount:(i||(i=d("I64"))).zero,lastDelayedRequestTimestampMs:void 0,lastSentTimestampMs:i.zero,lastSyncRequestTimestampMs:i.zero,networkTaskIdentifier:void 0,syncDatabaseId:(j||(j=d("LSIntEnum"))).ofNumber(95),taskQueueName:""});else return(h||(h=b("Promise"))).resolve()}function a(a){d("WALogger").LOG(k()),c("promiseDone")(a.runInTransaction(function(a){return(h||(h=b("Promise"))).all([l(a),m(a)])},"readwrite"))}g.onOccamadilloMutexChange=a}),98);
__d("MAWCommonBackendSetup",["MAWAppMutex","MAWEncyptionIndexedDbV2","MAWInit","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWVaultMaterialsStorage","MWSetupDBEncryption","Promise","asyncToGeneratorRuntime","cr:3484","promiseDone","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("MAWMainThreadLogger").__setRef("MAWCommonBackendSetup");function a(a,b,c,d,e){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j){e.start();e.logPoint("setup_armadillo_backend");i.onReadyImmediately(function(a){a=a.setupMainWaLogger;return a()});var k=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();yield e.measurePerformance("detection_support",function(){var a=window.indexedDB!=null;if(!a)throw new(d("MAWInit").MAWInitError)("indexeddb_not_supported_by_browser");if(k)return(h||(h=b("Promise"))).resolve();a=d("MAWLocalStorage").isLocalStorageAvailable();if(!a)throw new(d("MAWInit").MAWInitError)("localstorage_not_supported");return(h||(h=b("Promise"))).resolve()});var l=e.measurePerformance("setup_vault_materials",function(){return d("MAWVaultMaterialsStorage").setupVaultMaterials()}),m=(yield e.measurePerformance("acquire_mutex",function(){try{d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();var a=d("MAWAppMutex").use().init();if(k){c("promiseDone")(a);return(h||(h=b("Promise"))).resolve(!0)}return a}catch(a){if(k)return(h||(h=b("Promise"))).resolve(!0);throw a}})),n=(yield e.measurePerformance("ear_db_setup",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("MWSetupDBEncryption").setPerformanceMeasurementTool(d("MAWInit").MAWInit.measurePerformance);var a=(yield d("MWSetupDBEncryption").init());d("MAWEncyptionIndexedDbV2").maybeSetEncryptionDbOnVersionChange(function(){var a;(a=d("MAWIssueNewUserVisibleErrors")).issueError(a.MAWLegacyUserErrorMsgBody,a.MAWLegacyUserErrorMsgTitle,a.MAWUserVisibleErrorPresentationType.BANNER)});return a})));if(!n.success){e.logPoint("keychain_setup_failure");throw new(d("MAWInit").MAWInitError)("keychain_setup_failure")}b("cr:3484")!=null&&c("promiseDone")(b("cr:3484").setupArmadilloPushNotifications());if(!m){e.logPoint("maw_appmutex_no_permission");throw new(d("MAWInit").MAWInitError)("maw_appmutex_no_permission")}var o=(yield l);yield e.measurePerformance("setup_worker",function(){return a(o,f,g,j,"backendSetup")})});return j.apply(this,arguments)}g.setupArmadilloBackend=a}),98);
__d("MAWReinit",["ExecutionEnvironment","MAWCurrentUser","MAWEBSwitch","QPLUserFlow","QuickPerformanceLogger","UserTimingUtils","asyncToGeneratorRuntime","gkx","performanceNow","qpl","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("qpl")._(25310984,"169");function a(a){var e=a!=null?{instanceKey:a}:void 0,f=!1,g=!1;function l(){if(g)return;g=!0;c("QPLUserFlow").start(k,babelHelpers["extends"]({cancelOnUnload:!0,onFlowTimeout:function(){f=!0},timeoutInMs:(h||(h=c("ExecutionEnvironment"))).canUseDOM?6e4:0},e));t()}function m(a){if(!g||f)return;t();c("QPLUserFlow").addPoint(k,a,e)}function n(a,b){var d;if(!g||f)return;c("QPLUserFlow").addAnnotations(k,{bool:(d={},d[a]=b,d)})}function o(a,b){var d;if(!g||f)return;c("QPLUserFlow").addAnnotations(k,{string:(d={},d[a]=b,d)})}function p(a,b){var d;if(!g||f)return;c("QPLUserFlow").addAnnotations(k,{"int":(d={},d[a]=b,d)})}function q(a){t(),f=!0,c("QPLUserFlow").addAnnotations(k,{string:{failReason:a}},e),c("QPLUserFlow").endFailure(k,"maw_init_fail",e),s=!1}function r(a){t(),f=!0,s=!1,c("QPLUserFlow").addAnnotations(k,{string:{dropReason:a}},e),(i||(i=c("QuickPerformanceLogger"))).markerDrop(k)}var s=!1;function t(){if(s)return;s=!0;c("QPLUserFlow").addAnnotations(k,{bool:{armadillo_init_sync_api_improvements:c("gkx")("1115"),isArmadilloPublicLaunchUser:c("gkx")("688"),isEBEnabled:c("MAWEBSwitch").isEnabled(),isIndexedDbEarEnabled:!0,isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()}})}function u(a){t(),f=!0,c("QPLUserFlow").addAnnotations(k,{string:{cancelReason:a}},e),c("QPLUserFlow").endCancel(k,e),s=!1}function v(){t(),f=!0,c("QPLUserFlow").endSuccess(k,e),s=!1}function w(a,b){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=(j||(j=c("performanceNow")))(),f=a+"_start",g=a+"_end";m(f);f=(yield b());m(g);c("gkx")("8518")&&d("UserTimingUtils").measureModern(a,{end:(j||(j=c("performanceNow")))(),start:e});return f});return x.apply(this,arguments)}return{addBoolAnnotation:n,addIntAnnotation:p,addStringAnnotation:o,cancel:u,drop:r,endSuccess:v,fail:q,logPoint:m,measurePerformance:w,start:l}}g.getMAWReinit=a}),98);
__d("MAWReinitWorker",["MAWCommonBackendSetup","MAWOccamadilloOnMutexChange","MAWReinit","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.allTablesPersisted,e=a.db,f=a.dispatch,g=a.dispatchClearEphemeralSettings,h=a.environment,i=a.getOrSetupWorker,j=a.instanceKey,k=a.logout,l=a.reregisterDevice,m=a.setupBridge;a=d("MAWReinit").getMAWReinit(j);j=function(){f({tag:"InitOfflineQueueSyncComplete",value:void 0})};yield d("MAWCommonBackendSetup").setupArmadilloBackend(i,a,function(a){c("promiseDone")(m({dispatch:f,environment:h,logout:k,reregisterDevice:l,worker:a}).then(function(){b||d("MAWOccamadilloOnMutexChange").onOccamadilloMutexChange(e)}))},j,j);a.endSuccess();g()});return h.apply(this,arguments)}g["default"]=a}),98);
__d("MAWCommonSetupBridge",["BrowserLockManager","CurrentUser","ErrorTransport","I64","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadAttributionType","MAWBridge","MAWChatJid","MAWCrossWorkerPortal","MAWCurrentUser","MAWDbMedia","MAWEBSwitch","MAWFrontendMediaUtils","MAWJobActionsV2","MAWTTRCSafe","MAWThreadCutover","MAWVault","MAWXMAUtils","MWLogSend","MultipleTabsLogger","ODS","Promise","QPLEvent","QPLUserFlow","URLMatcher","WACrossWorkerPortal","WADevToolMessageChannel","WADevToolsBridge","WAJids","cr:2036","err","gkx","justknobx","pageID","promiseDone","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=c("requireDeferred")("MAWMainThreadLogger").__setRef("MAWCommonSetupBridge"),o=new Set([25312111,25311870]),p=new Map(),q=new Map(),r=new Map([[(a=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,8],[a.MEDIA_TYPE.VIDEO,10],[a.MEDIA_TYPE.GIF,6],[a.MEDIA_TYPE.STICKER,4],[a.MEDIA_TYPE.PTT,11],[a.MEDIA_TYPE.DOCUMENT_FILE,9]]),s=new Set([25312150,25313100,25304093,1056840931,25299294]);function t(a,b){return a+"_"+b}function u(a,b,c,d,e,f,g){if(a==="revokeMsg")return 26;if(e!=null)return e;if(c)return 3;if(d&&f===!1)return 13;if(g===!0)return 13;a=b!=null?r.get(b):null;return(e=a)!=null?e:0}function v(a,b,e){return(m||(m=c("LSDatabaseSingleton"))).then(function(f){return d("MAWThreadCutover").isCutoverSecureThreadFromChatJid(f,a).then(function(a){c("QPLUserFlow").addAnnotations(b,{bool:{isCutover:a}},{instanceKey:e})})})}var w={fbErrorProxy:function(a){d("ErrorTransport").log(a)},log:function(a){var b=a.logLevel,c=a.logString,d=a.tags;switch(b){case"log":n.onReadyImmediately(function(a){a=a.info;return a(c,d)});return;case"warn":n.onReadyImmediately(function(a){a=a.warn;return a(c,d)});return;case"logRestricted":n.onReadyImmediately(function(a){a=a.logRestricted;return a(c,d)});return;case"debug":break;case"error":break;default:break}},logError:function(a){var b=a.entriesToReport,c=a.framesToPop,d=a.logString,e=a.message,f=a.stack,g=a.tags;n.onReadyImmediately(function(a){a=a.logError;return a(d,g,e,f,c,b)})},odsBumpEntityKey:function(a){var b=a.amount,e=a.entity;a=a.key;(i||(i=d("ODS"))).bumpEntityKey(3185,e,a+"."+(c("CurrentUser").getAppID()||"unknown"),b)},onJobFinished:function(a){a.type==="createGroup"&&a.originalArgs.key!=null&&d("MAWJobActionsV2").recentFinishedJobsCache.set(a.originalArgs.key,a.result);switch(a.type){case"sendMsg":case"sendMediaMsg":case"sendReactionMsg":case"sendXMAShareMsg":case"forwardMsg":var b=a.originalArgs.chatJid,e=a.type==="sendXMAShareMsg"?a.originalArgs.xmaMsgExternalId:a.originalArgs.externalId;p.set(t(b,e),babelHelpers["extends"]({},a.originalArgs,{type:"sendMsg"}));break;case"revokeMsgs":b=a.result;b.forEach(function(a){var b=a.deleting;a=a.original;p.set(t(b.chat,b.externalId),{chatJid:a.chat,externalId:a.externalId,type:"revokeMsg"})});break;case"sendAppData":e=a.originalArgs;var f=a.result;(b=e.args.contents.actions)==null?void 0:b.forEach(function(a){a=a.messageAction;if(a==null||a.type!=="delete_for_me"||f.type!=="not_sent")return;q.set(f.appDataExternalId,{chatJid:a.protocolMsgId.chat,externalId:a.protocolMsgId.externalId,type:"deleteMsgForMe"})});break}if(a.type==="sendWrittenMsg"){e=a.originalArgs.protocolMsgId;b=e.chat;e=e.externalId;b=t(b,e);var g=p.get(b);p["delete"](b);if(a.result.type==="success"&&g!=null){var h,i=g.type!=="revokeMsg"?e:g.externalId,l=g.args,n=g.chatJid;b=g.file;e=g.type;g=(l==null?void 0:l.reactToAuthor)!=null;var o=null;g&&(o=(l==null?void 0:l.reaction)!=null?20:27);g=(l==null?void 0:l.specialTextSize)!=null;b=b!=null?d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type).mediaType:null;var r=(l==null?void 0:l.xmaMessageType)!=null,s=(l==null?void 0:l.quote)!=null||d("MAWXMAUtils").isXMAStoryReply(l==null?void 0:l.xmaMessageType);h=c("URLMatcher").match(d("MAWVault").unvault((h=l==null?void 0:l.content)!=null?h:""));h=h!=null&&h.length>0;var v=u(e,b,g,r,o,s,h),w=d("WAJids").switchOnMsgrChatJidType(n,{group:function(){return(j||(j=d("LSIntEnum"))).ofNumber(16)},user:function(){return(j||(j=d("LSIntEnum"))).ofNumber(15)}});c("promiseDone")((m||(m=c("LSDatabaseSingleton"))).then(function(a){var b=(l==null?void 0:l.source)!=null?l.source:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN);c("promiseDone")(d("MAWChatJid").toThreadKey(a,n).then(function(e){if(c("justknobx")._("154")&&d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&(c("BrowserLockManager")!=null&&!d("MultipleTabsLogger").hasUniqueLock()))return;d("MWLogSend").log(a,e,w,i,[],(k||(k=d("I64"))).of_string(d("MAWCurrentUser").getID()),b,v,s,1,1,k.to_string(e),l==null?void 0:(e=l.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec,void 0,l==null?void 0:l.initiatingSource)}))}))}}if(a.type==="sendWrittenAppData"){e=a.originalArgs.appDataExternalId;b=q.get(e);q["delete"](e);if(b!=null&&b.type==="deleteMsgForMe"&&a.result.type==="success"){var x=b.chatJid,y=b.externalId,z=d("WAJids").switchOnMsgrChatJidType(x,{group:function(){return(j||(j=d("LSIntEnum"))).ofNumber(16)},user:function(){return(j||(j=d("LSIntEnum"))).ofNumber(15)}});c("promiseDone")((m||(m=c("LSDatabaseSingleton"))).then(function(a){c("promiseDone")(d("MAWChatJid").toThreadKey(a,x).then(function(b){d("MWLogSend").log(a,b,z,y,[],(k||(k=d("I64"))).of_string(d("MAWCurrentUser").getID()),(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN),25,!1,3,1,k.to_string(b),void 0)}))}))}}},qplEvent:function(a){var e=a.action,f=a.annotations,g=a.debugInfo,i=a.error,j=a.event,k=a.instanceKey,m=a.timestamp;if(!c("CurrentUser").isEmployee()&&o.has((l||(l=d("QPLEvent"))).getMarkerId(j)))return;var n=k||0;k=f==null?void 0:(a=f.string)==null?void 0:a.jid;a=k!=null?d("WAJids").validateChatJid(k):void 0;k=s.has((l||(l=d("QPLEvent"))).getMarkerId(j))&&a!=null?v(a,j,n):(h||(h=b("Promise"))).resolve();switch(e.type){case"start":c("QPLUserFlow").start(j,{annotations:babelHelpers["extends"]({},f||{},{bool:babelHelpers["extends"]({},(f==null?void 0:f.bool)||{},{handleDeviceNotificationInWa:c("gkx")("4464"),isArmadilloPublicLaunchUser:c("gkx")("688"),isDev:0,isDeviceRegistrationDomainUniquenessEnabled:c("gkx")("7858"),isEBEnabled:c("MAWEBSwitch").isEnabled(),isExperimentWithDeviceNotificationInWa:c("gkx")("891"),isGifSearchEnbled:c("gkx")("7045"),isM1M2OverrideUser:c("gkx")("3444"),isSpillOverCAUser:c("gkx")("5014"),isSpillOverVNUser:c("gkx")("5264"),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),usePersistedQueueV2:c("gkx")("1139"),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker(),useUuidForDeviceRegistration:c("gkx")("7464")})}),instanceKey:n,timestamp:m});break;case"success":c("QPLUserFlow").addAnnotations(j,{bool:{isRelaxedDurability:!0}},{instanceKey:n});k["finally"](function(){c("QPLUserFlow").endSuccess(j,{annotations:f,instanceKey:n,timestamp:m})});break;case"point":f&&c("QPLUserFlow").addAnnotations(j,f,{instanceKey:n});(l||(l=d("QPLEvent"))).getMarkerId(j)===1056839232?d("MAWTTRCSafe").markEvent(e.name,m):c("QPLUserFlow").addPoint(j,e.name,{instanceKey:n,timestamp:m});break;case"annotations":c("QPLUserFlow").addAnnotations(j,(a=f)!=null?a:{},{instanceKey:n});break;case"failure":c("QPLUserFlow").addAnnotations(j,{bool:{isRelaxedDurability:!0}},{instanceKey:n});k["finally"](function(){c("QPLUserFlow").endFailure(j,e.name,{annotations:f,instanceKey:n,timestamp:m})});break;case"error":c("QPLUserFlow").markError(j,e.name,{debugInfo:g,error:i,instanceKey:n});break;default:throw c("err")("Bridge sends unreachable qplEvent action type")}}},x=function(a,b){a.push(b);return a};e=function(a){var e=a.customizeEventHandlers;a=a.worker;var f=d("MAWBridge").getBridge();f.setHandlers("event",babelHelpers["extends"]({},w,e));e=d("MAWCrossWorkerPortal").getOrCreateCrossWorkerPortal(f,["backend"],x);e.setPort(a);if(c("gkx")("5147")){var g=d("WADevToolsBridge").getDevToolBridge();a=new MessageChannel();var i=d("WACrossWorkerPortal").attachPortal(g,["backend"],x,c("pageID")),j=d("WACrossWorkerPortal").attachPortal(g,["devtool"],x,c("pageID"));i.setPort(d("WADevToolMessageChannel").getMostRecentChannel().port1);j.setPort(a.port1);b("cr:2036")==null?void 0:b("cr:2036").connectAddonPort(a.port2);e.addListener(function(a,b){return g.fireAndForget("devtool","bridgeMessage",{direction:b==="outgoing"?"toWorker":"toMain",msg:a,ts:Date.now()},!0)})}return(h||(h=b("Promise"))).resolve(f)};g.initBridge=e}),98);
__d("MAWSetupBridgeOfflineConsumer",["InteractionTracingMetrics","MAWBridgeInitOfflineQueueSyncCompleteHandler","MAWOfflineQueueStatus","MAWOfflineQueueStatusUtils","MAWProtocolQueueConst","MAWTTRC","MWChatInteraction","WATagsLogger","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats failed: expected: ",", processed: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats end: expected: ",", processed: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats: expected: ",", processed: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["ServerRPC","OfflineConsumer"]);function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a;return d("MAWBridgeInitOfflineQueueSyncCompleteHandler").call()});return n.apply(this,arguments)}function o(a){d("MAWTTRC").addIntAnnotation("offlineQueueSize",a);var b=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"offlineQueueSize",a)}function a(a,b){return function(e){var f=e.chatJidStatus,g=e.status,n=e.timestamp,p=e.totalExpectedCount;e=e.totalProcessedCount;switch(g){case d("MAWProtocolQueueConst").OfflineConsumerStatus.Initializing:l.LOG(k(),p);o(p);b({tag:"InitOfflineQueueSyncStart",value:p});c("promiseDone")(d("MAWOfflineQueueStatusUtils").markThreadWithOfflineQueueStatus(a,f,d("MAWProtocolQueueConst").OfflineConsumerStatus.Initializing));d("MAWTTRC").markEvent("worker_process_offline_queue_start",n);return;case d("MAWProtocolQueueConst").OfflineConsumerStatus.Processing:l.LOG(j(),p,e);b({tag:"InitOfflineQueueConsumerSyncProgress",value:{chatJidStatus:f,processed:e}});c("promiseDone")(d("MAWOfflineQueueStatusUtils").markThreadWithOfflineQueueStatus(a,f,d("MAWProtocolQueueConst").OfflineConsumerStatus.Processing));d("MAWOfflineQueueStatus").resetOfflineQueueState();return;case d("MAWProtocolQueueConst").OfflineConsumerStatus.Complete:l.LOG(i(),p,e);b({tag:"InitOfflineQueueSyncComplete",value:f});c("promiseDone")(m(a));c("promiseDone")(d("MAWOfflineQueueStatusUtils").markThreadWithOfflineQueueStatus(a,f,d("MAWProtocolQueueConst").OfflineConsumerStatus.Complete));d("MAWTTRC").markEvent("worker_process_offline_queue_end",n);d("MAWOfflineQueueStatus").markOfflineQueueComplete();return;case d("MAWProtocolQueueConst").OfflineConsumerStatus.Failed:l.LOG(h(),p,e);d("MAWTTRC").markEvent("worker_process_offline_queue_failed",n);d("MAWTTRC").markEvent("worker_process_offline_queue_end",n);b({tag:"InitOfflineQueueSyncComplete",value:void 0});c("promiseDone")(m(a));c("promiseDone")(d("MAWOfflineQueueStatusUtils").markThreadWithOfflineQueueStatus(a,f,d("MAWProtocolQueueConst").OfflineConsumerStatus.Failed));d("MAWOfflineQueueStatus").markOfflineQueueComplete();return}}}g["default"]=a}),98);
__d("WAOfflineUtils",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["INIT","OFFLINE_RESUME","ONLINE"]);c=b("$InternalEnum")({Initializing:"initializing",Failed:"failed",Processing:"processing",Complete:"complete"});f.ServerRPCMode=a;f.WAClientInfraOfflineProgress=c}),66);
__d("MAWSetupBridgeOfflineSnapshot",["InteractionTracingMetrics","MAWTTRC","MWChatInteraction","WAOfflineUtils","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WA infra offline sync failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats end: "," / ",", messages: "," / ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Progress: "," / ",", messages: "," / ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",", messages: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["ServerRPC","Offline"]);function m(a){d("MAWTTRC").addIntAnnotation("offlineQueueSize",a);var b=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"offlineQueueSize",a)}a=function(a){return function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=b.downloaded,e=b.expected,f=b.status;b=b.timestamp;switch(f){case d("WAOfflineUtils").WAClientInfraOfflineProgress.Initializing:l.LOG(k(),e.count,e.message);m(e.count);a({tag:"InitOfflineQueueSyncStart",value:e.count});d("MAWTTRC").markEvent("worker_download_offline_queue_start",b);return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Processing:l.LOG(j(),c.count,e.count,c.message,e.message);a({tag:"InitOfflineQueueSyncProgress",value:c.count});return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Complete:l.LOG(i(),c.count,e.count,c.message,e.message);d("MAWTTRC").addIntAnnotation("offlineQueueDownloadedCount",c.count);a({tag:"InitOfflineQueueSyncProgress",value:e.count});d("MAWTTRC").markEvent("worker_download_offline_queue_end",b);return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Failed:l.LOG(h());d("MAWTTRC").markEvent("worker_download_offline_queue_fail",b);d("MAWTTRC").markEvent("worker_download_offline_queue_end",b);return}});return function(a){return c.apply(this,arguments)}}()};e=a;g["default"]=e}),98);
__d("MAWSetupBridge",["LSDatabaseSingleton","LSInitSyncCompleteSubscription","MAWBridgeUIEventHandler","MAWCommonSetupBridge","MAWCryptoAuthToken","MAWEncryptionErrorHandler","MAWGetEphemeralSettings","MAWSetupBridgeOfflineConsumer","MAWSetupBridgeOfflineSnapshot","Run","Visibility","cr:1265","cr:5889","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("ArmadilloCutoverClientFalcoEvent").__setRef("MAWSetupBridge"),j=(h||(h=c("LSDatabaseSingleton"))).then(d("LSInitSyncCompleteSubscription").use).then(function(){return h||(h=c("LSDatabaseSingleton"))}),k=function(a){i.loadImmediately(function(b){b=b.log;return b(function(){return{armadillo_thread_id:a.armadilloThreadId,domain:a.domain,event:a.event,event_details:a.eventDetails,open_thread_id:a.openThreadId,success:a.success,trace_id:a.traceId}})})};function a(a){var e=a.dispatch,f=a.environment,g=a.logout,h=a.reregisterDevice,i=a.worker;function l(){i.postMessage({type:"force-flush-data"})}d("Run").onUnload(l);d("Run").onBeforeUnload(l,!1);c("Visibility").addListener(c("Visibility").HIDDEN,function(){i.postMessage({type:"force-flush-logs-only"})});return d("MAWCommonSetupBridge").initBridge({customizeEventHandlers:{earDecryptionFailure:function(a){d("MAWEncryptionErrorHandler").crashUiAskUserToReload(a.tableName)},getLSDBEphemeralSetting:function(a){return d("MAWGetEphemeralSettings").getEphemeralSetting(a.chatJid)},logCutoverEvent:k,logout:g,offlineConsumerProgress:function(){return c("MAWSetupBridgeOfflineConsumer")(j,e).apply(void 0,arguments)},offlineSnapshot:c("MAWSetupBridgeOfflineSnapshot")(e),relayUpdate:function(a){b("cr:5889")==null?void 0:b("cr:5889").handleUpdateFromWorker(a)},reregisterDevice:h,rotateCryptoAuthToken:function(){return d("MAWCryptoAuthToken").fetchFreshCAT(f)},uiUpdate:function(a){a=a.events;e&&a.forEach(function(a){return e(a)});b("cr:1265")==null?void 0:b("cr:1265").recordBridgeUIEvent(a);d("MAWBridgeUIEventHandler").handleEvents(j,a)}},worker:i})}g.setupBridge=a}),98);
__d("useMWEncryptedBackupsProcessBackupIdsDeferred",["gkx","react","requireDeferred","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useEffect,k=c("requireDeferred")("MWEncryptedBackupsProcessBackupIds").__setRef("useMWEncryptedBackupsProcessBackupIdsDeferred");function a(a){var b=(h||(h=c("useReStore")))();j(function(){if(c("gkx")("5448")){var d,e=!1;k.onReadyImmediately(function(c){e||(d=c.subscribeToEncryptedBackupsRow(b,a))});return function(){e=!0,d==null?void 0:d()}}else{var f=function(){};k.onReady(function(c){f=c.subscribeToEncryptedBackupsRow(b,a)});return f}},[b,a])}g["default"]=a}),98);
__d("MAWCommonSetup",["CometRelay","InteractionTracingMetrics","MAWBridge","MAWBridgeFireAndForget","MAWCommonBackendSetup","MAWEncryptedBackupsStateManager","MAWInit","MAWIssueNewUserVisibleErrors","MAWJobDefinitions","MAWRestoreRewriteUtils","MAWSetupBridge","MAWStateContext.react","MAWTTRC","MAWTTRCSafe","MAWUIJob","MAWWaitForBackendSetup","MWChatInteraction","Promise","WAJobOrchestratorTypes","asyncToGeneratorRuntime","getErrorSafe","promiseDone","react","requireDeferred","useMWEncryptedBackupsProcessBackupIdsDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i;e=i||d("react");var j=e.useContext,k=e.useEffect,l=c("requireDeferred")("FBLogger").__setRef("MAWCommonSetup"),m=!1,n=function(a){d("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(a),d("MAWBridgeFireAndForget").fireAndForget("backend","setEncryptedBackupsState",{newState:a})};function a(a){var b=d("CometRelay").useRelayEnvironment(),e=j(d("MAWStateContext.react").MAWStateContext),f=e.dispatch;k(function(){c("promiseDone")(r(b,a,f))},[b,a,f]);c("useMWEncryptedBackupsProcessBackupIdsDeferred")(n)}var o,p=new(h||(h=b("Promise")))(function(a){o=function(c){a(c),c.onmessage=function(a){return q.onmessage==null?void 0:q.onmessage(a)},o=function(a){a.onmessage=function(a){return q.onmessage==null?void 0:q.onmessage(a)},p=(h||(h=b("Promise"))).resolve(a)}}}),q={onmessage:null,postMessage:function(a){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield p);b.postMessage(a)})())}};function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(m)return;m=!0;d("MAWTTRC").startMAWTTRCFlow();try{d("MAWIssueNewUserVisibleErrors").deleteAllErrors();var f=b.logout,g=b.reregisterDevice;yield d("MAWCommonBackendSetup").setupArmadilloBackend(b.getOrSetupWorker,d("MAWInit").MAWInit,function(b){var h={close:function(){},onmessage:null,postMessage:function(a){return b.postMessage(a)}},i={close:function(){return b.close()},onmessage:null,postMessage:function(a){return b.postMessage(a)}};o==null?void 0:o(h);b.onmessage=function(a){h.onmessage==null?void 0:h.onmessage(a),i.onmessage==null?void 0:i.onmessage(a)};c("promiseDone")(d("MAWSetupBridge").setupBridge({dispatch:e,environment:a,logout:f,reregisterDevice:g,worker:i}))},function(){e({tag:"InitOfflineQueueSyncComplete",value:void 0}),d("MAWTTRC").endSuccess(!0)},function(){e({tag:"InitOfflineQueueSyncComplete",value:void 0})});d("MAWUIJob").UIJobStarters.fireAndForget(d("MAWJobDefinitions").jobSerializers.handleFutureproofMsg({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}));d("MAWInit").MAWInit.endSuccess();d("MAWRestoreRewriteUtils").isOneDBEnabled()||c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("backend","getSecureThreadTotalCount"),function(a){d("MAWTTRCSafe").addIntAnnotation("totalSecureThreadCount",a);var b=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"totalSecureThreadCount",a)});d("MAWWaitForBackendSetup").resolveBackendSetup()}catch(a){var h=a,i="failure_during_armadillo_backend_setup";if(h instanceof d("MAWInit").MAWInitError){h=c("getErrorSafe")((b=h.error)!=null?b:a);i=(b=h.message)!=null?b:"Error: MAWInitError without message."}else{h=c("getErrorSafe")(a);i=((b=(b=h)==null?void 0:b.name)!=null?b:"Error:")+": "+((b=(b=h)==null?void 0:b.message)!=null?b:"Unknown")}b=i==="maw_appmutex_no_permission"&&document.visibilityState!=="visible";b?d("MAWInit").MAWInit.cancel(i,h):(d("MAWWaitForBackendSetup").rejectBackendSetup(a),d("MAWInit").MAWInit.fail(i,h));d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER,i);void l.load().then(function(a){return a("messenger_e2ee_web").catching(h).mustfix("MAW backend setup failed -- %s",i)});throw h}});return s.apply(this,arguments)}g.useArmadillo=a;g.workerProxy=q}),98);
__d("MAWSetupMutex",["FBLogger","LocalStorageMutex","MAWAppMutex","MAWBridge","MAWClientConsistencyRefresh","MAWInit","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWReinitWorker","MAWStateContext.react","MAWTTRC","MAWWaitForBackendSetup","QPLUserFlow","Run","WALoggerDeferred","asyncToGeneratorRuntime","qpl","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["AppMutex - Shouldn't reinitialize, shared worker is active on a different tab"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["AppMutex - Shouldn't reinitialize, worker already exists"]);k=function(){return a};return a}a=i||d("react");var l=a.useCallback,m=a.useEffect,n=a.useMemo,o=c("FBLogger")("messenger_e2ee_web"),p=!1,q=0;function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(document.visibilityState!=="visible")return!1;a=a();var f=window.indexedDB!=null,g=d("MAWLocalStorage").isLocalStorageAvailable();if(a){void d("WALoggerDeferred").DEV(k());return!1}if(!f||!g)return!1;if(yield b()){void d("WALoggerDeferred").DEV(j());c("MAWClientConsistencyRefresh")("worker_mismatch");e();return!1}return!0});return s.apply(this,arguments)}e=function(a,e,f){var g=e.doesWorkerExist,i=e.getOrSetupWorker,j=e.isSharedWorkerActive,k=e.logout,s=e.reregisterDevice,t=e.setupBridge,u=e.terminateWorker,v=e.terminateWorkerPermanently,w=n(function(){return d("MAWAppMutex").use()},[]),x=(h||(h=c("useReStore")))(),y=d("MAWStateContext.react").useDispatchClearEphemeralSettings(),z=x.persistenceTypes.includes("indexeddb"),A=l(function(a){var b=w.takeoverFilter(a);if(!b||a.newValue===d("LocalStorageMutex").THIS_TAB||a.newValue==="")return;z||d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"DropAllSecureThreads",value:void 0}]});u("MAWSetupMutexV2:handleStoreChange");d("MAWWaitForBackendSetup").resetBackendSetup();d("MAWTTRC").cancel("workerMutexLost");d("MAWInit").MAWInit.cancel("workerMutexLost");w.onMutexDeath()},[w,z,u]),B=l(function(){u("MAWSetupMutexV2:handleUnload"),w.onMutexDeath()},[w,u]),C=l(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield r(g,j,v));if(!b||p)return;p=!0;q++;try{yield c("MAWReinitWorker")({allTablesPersisted:z,db:x,dispatch:f,dispatchClearEphemeralSettings:y,environment:a,getOrSetupWorker:i,instanceKey:q,logout:k,reregisterDevice:s,setupBridge:t}),d("MAWWaitForBackendSetup").resolveBackendSetup(),d("MAWIssueNewUserVisibleErrors").deleteUserVisibleErrorByJSErrorMessage("maw_appmutex_no_permission")}catch(a){o.mustfix("AppMutex - failed to reinitialize worker: "+a.message.concat(" (",a.error,")")),o.catching(a),c("QPLUserFlow").endFailure(c("qpl")._(25310984,"169"),"failed_to_reinitialize_worker",{annotations:{string:{error:a.message.concat(": ",a.error)}},error:a,instanceKey:q})}finally{p=!1}}),[z,x,f,y,g,a,i,j,k,s,t,v]);m(function(){window.addEventListener("storage",A);var a=d("Run").onBeforeUnload(B,!1),b=d("Run").onUnload(B);window.addEventListener("visibilitychange",C);return function(){window.removeEventListener("storage",A),a.remove(),b.remove(),window.removeEventListener("visibilitychange",C)}},[A,B,C])};g.useMutex=e}),98);
__d("MAWSetupMutex.react",["MAWSetupMutex","react"],(function(a,b,c,d,e,f,g){"use strict";var h;h||d("react");function a(a){var b=a.dispatch,c=a.environment;a=a.platformSetupUtils;d("MAWSetupMutex").useMutex(c,a,b);return null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatFetchThreadMessageCounts",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return{}});return g.apply(this,arguments)}function c(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return 0});return h.apply(this,arguments)}f.fetchArmadilloThreadMessageCounts=a;f.fetchArmadilloThreadMessageCount=c}),66);
__d("useDataLossStatisticsStorageListener",["LSDatabaseSingleton","MWChatFetchThreadMessageCounts","Visibility","WebStorage","promiseDone","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(j||d("react")).useEffect,l="armadillo_msgr_data_loss_stats";function a(){k(function(){var a;window.setTimeout(function(){a=c("Visibility").addListener(c("Visibility").HIDDEN,function(){c("promiseDone")((h||(h=c("LSDatabaseSingleton"))).then(function(a){return d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(a).then(function(a){(i||(i=c("WebStorage"))).setItemGuarded(i.getLocalStorage(),l,JSON.stringify(a))})}))})},3e4);return function(){var b;(b=a)==null?void 0:b.remove()}},[])}g.DATA_LOSS_STATISTICS_STORAGE_KEY=l;g.useDataLossStatisticsStorageListener=a}),98);
__d("MWChatDataLossCheckerUtil",["FBLogger","I64","LSDatabaseSingleton","MAWBridgeSendAndReceive","MAWMiActOnActThreadReady","MWChatFetchThreadMessageCounts","Promise","QuickPerformanceLogger","WebStorage","asyncToGeneratorRuntime","gkx","globalCryptoSubtle","promiseDone","qpl","useDataLossStatisticsStorageListener"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;function m(a){a=Array.from(new Uint8Array(a));return a.map(function(a){return a.toString(16).padStart(2,"0")}).join("")}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{if(c("gkx")("238"))return a;var b=new TextEncoder();b=b.encode(a).buffer;a=(yield c("globalCryptoSubtle").digest("SHA-256",b));return m(a)}catch(a){return a}});return o.apply(this,arguments)}function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.currentIDBCnt,d=a.currentMsgCnt,e=a.logThreadId,f=a.prevMsgCnt,g=a.qplEvent;a=a.threadId;if(e!=null&&e){e=(yield n(a));b!=null?((j||(j=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),j.markerAnnotate(g,{"int":{current_idb_count:b,current_msg_count:d,prev_msg_count:f},string:{encrypted_threadId:e}}),j.markerEnd(g,2)):((j||(j=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),j.markerAnnotate(g,{"int":{current_msg_count:d,prev_msg_count:f},string:{encrypted_threadId:e}}),j.markerEnd(g,2))}else b!=null?((j||(j=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),j.markerAnnotate(g,{"int":{current_idb_count:b,current_msg_count:d,prev_msg_count:f}}),j.markerEnd(g,2)):((j||(j=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),j.markerAnnotate(g,{"int":{current_msg_count:d,prev_msg_count:f}}),j.markerEnd(g,2))});return q.apply(this,arguments)}function r(a){var b=a.currentMsgCnt,e=a.logThreadId,f=a.prevMsgCnt,g=a.qplEvent,h=a.threadId;return!c("gkx")("7965")?p({currentMsgCnt:b,logThreadId:e,prevMsgCnt:f,qplEvent:g,threadId:h}):(l||(l=c("LSDatabaseSingleton"))).then(function(a){return d("MAWMiActOnActThreadReady").onActThreadReady(a,(i||(i=d("I64"))).of_string(h),"MWChatDataLossCheckerUtil",function(a,i,j){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","fetchArmadilloThreadMessageCount",{threadId:i}).then(function(a){return p({currentIDBCnt:a,currentMsgCnt:b,logThreadId:e,prevMsgCnt:f,qplEvent:g,threadId:h})})["catch"](function(a){c("FBLogger")("labyrinth").catching(a).warn("Failed to fetch IndexDB message count");return p({currentMsgCnt:b,logThreadId:e,prevMsgCnt:f,qplEvent:g,threadId:h})})})})}function a(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{a=(yield d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCount(a,b));var e=(k||(k=c("WebStorage"))).getAllowlistedKeyFromLocalStorage(d("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(e==null)return{isThreadMissingMessages:!1};e=JSON.parse(e);b=(e=e[(i||(i=d("I64"))).to_string(b)])!=null?e:null;if(b==null)return{isThreadMissingMessages:!1};return b>0&&a===0?{currCount:a,isThreadMissingMessages:!0,prevCount:b}:{isThreadMissingMessages:!1}}catch(a){c("FBLogger")("labyrinth").catching(a).warn("Failed to check for data loss");return{isThreadMissingMessages:!1}}});return s.apply(this,arguments)}function e(a){a=d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(a);a.then(function(a){var e=(k||(k=c("WebStorage"))).getAllowlistedKeyFromLocalStorage(d("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(e==null)return(h||(h=b("Promise"))).resolve(null);e=JSON.parse(e);return(h||(h=b("Promise"))).resolve({current:a,previous:e})}).then(function(a){if(a==null)return(h||(h=b("Promise"))).resolve();var c=a.current;a=a.previous;return t(a,c)})["catch"](function(a){return c("FBLogger")("labyrinth").catching(a).warn("Failed to check for data loss")});return a.then(function(){})}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d){var e=[];for(var f in a)Object.prototype.hasOwnProperty.call(d,f)&&e.push(f);f=[];for(var g=0;g<e.length;g++){var i=e[g],j={currentMsgCnt:d[i],prevMsgCnt:a[i],threadId:i};a[i]>0&&d[i]===0?(f.push(r(babelHelpers["extends"]({},j,{qplEvent:c("qpl")._(717553665,"1183")}))),f.push(r(babelHelpers["extends"]({},j,{logThreadId:!0,qplEvent:c("qpl")._(717562243,"1358")})))):(f.push(r(babelHelpers["extends"]({},j,{qplEvent:c("qpl")._(717553666,"1184")}))),f.push(r(babelHelpers["extends"]({},j,{logThreadId:!0,qplEvent:c("qpl")._(717556541,"1361")}))))}yield (h||(h=b("Promise"))).all(f)});return u.apply(this,arguments)}function f(a){var b=function(b){c("promiseDone")(n(b).then(function(d){(j||(j=c("QuickPerformanceLogger"))).markerStartFromNavStart(c("qpl")._(717567419,"1383")),j.markerAnnotate(c("qpl")._(717567419,"1383"),{string:{encryptedThreadId:d,msg_count:a[b].toString()}}),j.markerEnd(c("qpl")._(717567419,"1383"),2)}))};for(var d in a)b(d)}g.qplLog=r;g.checkIsThreadMissingMessages=a;g.fetchCountsAndLogDataLoss=e;g.logThreadCompleteDataLoss=t;g.logLocalStatistics=f}),98);
__d("useOnMawSetupComplete.react",["promiseDone","react","waitForMAWTTRC"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect;function a(a,b){i(function(){var b=!1;c("promiseDone")(d("waitForMAWTTRC").promise.then(function(){if(b)return;a()}));return function(){b=!0}},b)}g.useOnMawSetupComplete=a}),98);
__d("useDataLossChecker",["I64","LSDatabaseSingleton","LSFactory","LSScheduleOccamThreadsIntegrityCheckerStoredProcedure","MWChatDataLossCheckerUtil","asyncToGeneratorRuntime","gkx","justknobx","promiseDone","useDataLossStatisticsStorageListener","useOnMawSetupComplete.react"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(){d("useDataLossStatisticsStorageListener").useDataLossStatisticsStorageListener(),d("useOnMawSetupComplete.react").useOnMawSetupComplete(function(){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield i||(i=c("LSDatabaseSingleton")));return a.runInTransaction(function(a){return d("MWChatDataLossCheckerUtil").fetchCountsAndLogDataLoss(a)},"readwrite")})());var a=c("gkx")("7007"),e=c("justknobx")._("1683");a&&e&&c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield i||(i=c("LSDatabaseSingleton")));return a.runInTransaction(function(a){return c("LSScheduleOccamThreadsIntegrityCheckerStoredProcedure")(c("LSFactory")(a),{delayMs:(h||(h=d("I64"))).zero,maxThreadCount:h.of_int32(20)})},"readonly")})())},[])}g["default"]=a}),98);
__d("useLegacyUserWatchdog",["MAWIssueNewUserVisibleErrors","clearTimeout","react","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect;b=24*60*60*1e3;var j=5*b;function a(){i(function(){var a=c("setTimeout")(function(){var a;(a=d("MAWIssueNewUserVisibleErrors")).issueError(a.MAWLegacyUserErrorMsgBody,a.MAWLegacyUserErrorMsgTitle,a.MAWUserVisibleErrorPresentationType.BANNER)},j);return function(){return c("clearTimeout")(a)}})}g["default"]=a}),98);
__d("useMAWContactSync",["I64","JSScheduler","LSAuthorityLevel","LSContactBitOffset","LSContactBlockedByViewerStatus","LSDatabaseSingleton","LSInitSyncCompleteSubscription","LSIntEnum","MAWBridgeFireAndForget","MAWContactRelationshipType","Promise","ReQL","asyncToGeneratorRuntime","debounceCore","promiseDone","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=(m||d("react")).useEffect;function a(){n(function(){var a=new(l||(l=b("Promise")))(function(a){(h||(h=c("JSScheduler"))).scheduleSpeculativeCallback(function(){c("promiseDone")((k||(k=c("LSDatabaseSingleton"))).then(function(b){return o(b).then(function(a){return r(a)}).then(function(){return p(b)}).then(function(b){return a(b)})}))})});return function(){c("promiseDone")(a.then(function(a){return a()}))}},[])}function o(a){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("contacts")).filter(function(a){return(i||(i=d("I64"))).to_int32(a.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE}))}function p(a){return d("ReQL").fromTableAscending(a.table("contacts")).subscribe(t)}var q=!1;function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(q===!0)return;q=!0;yield d("LSInitSyncCompleteSubscription").use;yield d("MAWBridgeFireAndForget").fireAndForget("backend","updateContacts",{contacts:a.map(u)})});return s.apply(this,arguments)}function t(a,b){if(b.operation==="delete")return;b=b.value;v.set(a,b);w()}function u(a){var b;b=(b=d("LSContactBitOffset").has(66,a))!=null?b:!1;return{fbid:(i||(i=d("I64"))).to_string(a.id),isBlocked:!i.equal(a.blockedByViewerStatus,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED)),isRestricted:b,name:a.name,relationship:d("MAWContactRelationshipType").getContactRelationshipType(a)}}var v=new Map(),w=c("debounceCore")(function(){d("MAWBridgeFireAndForget").fireAndForget("backend","updateContacts",{contacts:Array.from(v.values()).map(u)}),v.clear()},1e3);g.useMAWContactSync=a}),98);
__d("useMAWReregisterDeviceOnError",["LSPersistedDbGating","MAWBridgeSendAndReceive","MAWIssueNewUserVisibleErrors","MAWLoggerUtils","MAWReinitWorker","MAWSetupWorker","MAWStateContext.react","ODS","WATagsLogger","asyncToGeneratorRuntime","react","shouldUseMAWSharedWorker","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to reinit worker ",""]);k=function(){return a};return a}e=i||d("react");var l=e.useCallback,m=e.useContext,n=!1,o=typeof window!=="undefined"?window:self;function p(){n=!0,d("MAWSetupWorker").terminateWorkerPermanently(),(j||(j=d("ODS"))).bumpEntityKey(3185,"armadillo_forced_reregister_fail",o.location.hostname),d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)}function a(a,e){var f=e.getOrSetupWorker,g=e.setupBridge,i=e.terminateWorker,q=(h||(h=c("useReStore")))(),r=d("MAWStateContext.react").useDispatchClearEphemeralSettings();e=m(d("MAWStateContext.react").MAWStateContext);var s=e.dispatch;return l(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(n)return;(j||(j=d("ODS"))).bumpEntityKey(3185,"armadillo_forced_deregister",o.location.hostname);yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","removeCurrentDevice");var b=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();b&&(yield d("MAWSetupWorker").killSharedWorker());i("useMAWReregisterDeviceOnError");try{yield c("MAWReinitWorker")({allTablesPersisted:d("LSPersistedDbGating").allTablesPersisted,db:q,dispatch:s,dispatchClearEphemeralSettings:r,environment:a,getOrSetupWorker:f,logout:p,reregisterDevice:p,setupBridge:g})}catch(a){b=a.description||a.message||a;d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.DeviceRegistration,d("MAWLoggerUtils").Tag.LogoutHandler,d("MAWLoggerUtils").Tag.WorkerSetup,d("MAWLoggerUtils").Tag.MAWWorker,d("MAWLoggerUtils").Tag.MAWInit]).ERROR(k(),b);d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)}}),[i,q,s,r,a,f,g])}g["default"]=a}),98);
__d("useStorageUsageMetricsLogger",["cr:3504","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect;function a(){i(function(){void (b("cr:3504")==null?void 0:b("cr:3504").logMAWDBUsageMetrics())},[])}g["default"]=a}),98);
__d("MAWSetupImpl.react",["BaseHeadingContext","CometRelay","MAWCommonSetup","MAWSetupMutex.react","MAWSetupWorker","MAWStateContext.react","MAWWebWorkerInstance","cr:6159","cr:6160","promiseDone","react","shouldUseMAWSharedWorker","useDataLossChecker","useLegacyUserWatchdog","useMAWContactSync","useMAWReregisterDeviceOnError","useStorageUsageMetricsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));e=h;var j=e.useContext,k=e.useEffect,l=e.useMemo;window.XPlatTesting=b("cr:6159");window.XPlatTestingGroups=b("cr:6160");function a(a){var b,e=a.children,f=a.fbid,g=a.logout,h=a.setupBridge;a=j(d("MAWStateContext.react").MAWStateContext);a=a.dispatch;var m=d("CometRelay").useRelayEnvironment(),n=c("useMAWReregisterDeviceOnError")(m,{doesWorkerExist:d("MAWWebWorkerInstance").doesWorkerExist,getOrSetupWorker:(b=d("MAWSetupWorker")).getOrSetupWorker,isSharedWorkerActive:b.isSharedWorkerActive,setupBridge:h,terminateWorker:b.terminateWorker,terminateWorkerPermanently:b.terminateWorkerPermanently});b=l(function(){return{doesWorkerExist:d("MAWWebWorkerInstance").doesWorkerExist,getOrSetupWorker:d("MAWSetupWorker").getOrSetupWorker,isSharedWorkerActive:d("MAWSetupWorker").isSharedWorkerActive,logout:g!=null?g:function(){return c("promiseDone")(n())},reregisterDevice:function(){return c("promiseDone")(n())},setupBridge:h,terminateWorker:d("MAWSetupWorker").terminateWorker,terminateWorkerPermanently:d("MAWSetupWorker").terminateWorkerPermanently}},[g,n,h]);d("MAWCommonSetup").useArmadillo(b);d("useMAWContactSync").useMAWContactSync();c("useLegacyUserWatchdog")();c("useDataLossChecker")();c("useStorageUsageMetricsLogger")();k(function(){d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker()});var o=j(c("BaseHeadingContext")),p=!d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();return i.jsxs(c("BaseHeadingContext").Provider,{value:o+1,children:[e,p?i.jsx(c("MAWSetupMutex.react"),{dispatch:a,environment:m,fbId:f,platformSetupUtils:b}):null]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MAWSetup.react",["CometPlaceholder.react","CurrentUser","MAWOembedIframeContainer.react","MAWSetupBridge","MAWSetupImpl.react","cr:3487","cr:6809","deferredLoadComponent","react","requireDeferredForDisplay"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useEffect,k=b("cr:6809")!=null?b("cr:6809").CometLogoutProvider:function(a){a=a.children;return i.jsx(i.Fragment,{children:a})},l=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MAWLoadingStateSpinner.react").__setRef("MAWSetup.react"));function a(a){a=a.children;j(function(){var a=d("MAWOembedIframeContainer.react").createMAWOembedIframeContainer();return function(){a==null?void 0:a.stopListening()}},[]);return i.jsxs(k,{children:[i.jsx(c("MAWSetupImpl.react"),{fbid:c("CurrentUser").getID(),logout:void 0,setupBridge:d("MAWSetupBridge").setupBridge,children:a}),i.jsx(c("CometPlaceholder.react"),{fallback:null,children:i.jsx(l,{})}),b("cr:3487")&&i.jsx(b("cr:3487"),{})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWFallbackWithTimeout.react",["FBLogger","react","useTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;h||(h=d("react"));var i=h.useEffect;function a(a){var b=a.children,d=a.message;a=c("useTimeout")(1e4);var e=a.pending;i(function(){e||c("FBLogger")("messenger_web_product","fallback_timeout").warn(d)},[d,e]);return b}g["default"]=a}),98);
__d("MWChatStateV2IsComposeTab",["MWChatStateV2Types"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.tabType;if(a.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return!0;else return!1}g.isComposeTab=a}),98);
__d("MWChatStateV2HeadGroups",["MWChatStateV2CompareTabs","MWChatStateV2IsComposeTab","MWChatStateV2IsMinimized"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){c=Array.from(c.values()).filter(function(b){return d("MWChatStateV2IsMinimized").isMinimized(a,b)}).sort(function(a,b){var c=d("MWChatStateV2CompareTabs").byMostRecentMinimized(a,b);return c===0?d("MWChatStateV2CompareTabs").byMostRecentOpened(a,b):c});b=b.filter(function(a){return!d("MWChatStateV2IsComposeTab").isComposeTab(a)}).concat(c);return[b.slice(0,e),b.slice(e,b.length)]}g.getHeadGroups=a}),98);
__d("MWV2ChatHeadCond.react",["cr:2895"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:2895")}),98);
__d("MWV2ChatHeadsLayout.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){a=a.children;a=a;return i.jsx("div",{className:"x191j7n5 x92rtbv x10l6tqk x1useyqa",children:a})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2ChatOptionsHead.react",["fbt","ix","MWXDeferredPopoverTrigger.react","MWXIcon.react","MWXPressable.react","MWXTooltip.react","fbicon","gkx","react","requireDeferred","stylex"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=k||(k=d("react")),m=k.useState,n=c("requireDeferred")("MWV2ChatOptionsHeadPopover.react").__setRef("MWV2ChatOptionsHead.react"),o={head:{alignItems:"x6s0dn4",backgroundColor:"x1l31dnx",borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",boxShadow:"x1qeybcx",display:"x78zum5",height:"xc9qbxq",justifyContent:"xl56j7k",opacity:"xg01cxk",transform:"x1f85oc2",transitionDuration:"x19bguh7",transitionProperty:"x6o7n8i",width:"x14qfxbe",":hover_boxShadow":"x19xcq9t",$$css:!0},headArea:{borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",height:"xnnlda6",position:"x1n2onr6",start:"xi8xln7",left:null,right:null,width:"x14qfxbe",$$css:!0},headAreaOld:{borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",height:"xc9qbxq",position:"x10l6tqk",start:"xi8xln7",left:null,right:null,width:"x14qfxbe",$$css:!0},headVisible:{opacity:"x1hc1fzr",transform:"x3oybdh",$$css:!0},hoverTarget:{alignItems:"x6s0dn4",backgroundColor:"xjbqb8w",display:"x78zum5",height:"xnnlda6",justifyContent:"xl56j7k",marginStart:"x1tl9596",marginLeft:null,marginRight:null,marginTop:"xhsvlbd",width:"x1dmp6jm",$$css:!0}},p=h._("__JHASH__GqqnGnZcXBj__JHASH__");function a(a){var b=a.isVisible,e=a.openTabCount,f=a.style;a=m(!1);var g=a[0],h=a[1];a=m(!1);var k=a[0],q=a[1];a=m(!1);var r=a[0];a=a[1];return l.jsx(c("MWXDeferredPopoverTrigger.react"),{align:"end",onVisibilityChange:a,popoverProps:{hasOpenTabs:e>0},popoverResource:n,position:"above",children:function(a,e){return l.jsx("div",{className:(j||(j=c("stylex")))(c("gkx")("3599")?o.headArea:o.headAreaOld),style:c("gkx")("3599")?void 0:f,children:l.jsx("div",{className:"x6s0dn4 xjbqb8w x78zum5 xnnlda6 xl56j7k x1tl9596 xhsvlbd x1dmp6jm","data-testid":void 0,onMouseEnter:function(){return h(!0)},onMouseLeave:function(){return h(!1)},children:l.jsx(c("MWXPressable.react"),{label:p,onFocusChange:function(a){return q(a)},onPress:e,ref:a,testid:void 0,xstyle:function(){return[o.head,b||g||k||r?o.headVisible:!1]},children:l.jsx(c("MWXTooltip.react"),{align:"middle",position:"start",tooltip:p,children:l.jsx(c("MWXIcon.react"),{icon:d("fbicon")._(i("484387"),20)})})})})})}})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2PreloadComposeTab",["JSResourceForInteraction","JSScheduler","react","useCometPreloader"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useCallback,k=c("JSResourceForInteraction")("MWV2ComposeTab.react").__setRef("MWV2PreloadComposeTab");function a(){var a=j(function(){(i||(i=d("JSScheduler"))).scheduleSpeculativeCallback(function(){k.preload()})},[]);a=c("useCometPreloader")("button",a,a);var b=a[0];a=a[1];return[b,a]}g["default"]=a}),98);
__d("MWV2ComposeHead.react",["fbt","ix","CometTintedIcon.react","LSThreadAttributionStore","MWChatInteraction","MWChatStateV2.react","MWChatStateV2Types","MWV2PreloadComposeTab","MWXPressable.react","MWXTooltip.react","MessengerWebUXLogger","fbicon","react","useMWNewChatOpenTabTraceProvider"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||d("react"),l={button:{alignItems:"x6s0dn4",appearance:"xjyslct",backgroundColor:"x1l31dnx",borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",boxShadow:"x1qeybcx",display:"x3nfvp2",height:"xsdox4t",justifyContent:"xl56j7k",position:"x1n2onr6",width:"x1useyqa",":hover_boxShadow":"x19xcq9t",$$css:!0}};function a(a){var b=a.onFocusChange;a=a.onHoverChange;var e=d("MWChatStateV2.react").useDispatch(),f=c("MessengerWebUXLogger")==null?void 0:c("MessengerWebUXLogger").useInteractionLogger(),g=c("useMWNewChatOpenTabTraceProvider")(),j=function(){g(function(a){d("MWChatInteraction").set("open_new",a);f==null?void 0:f({eventName:"create_thread"});d("LSThreadAttributionStore").setSourceForNewThread("chatheadsNewMessage");var b=Date.now();a=function(a){return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:a.closeWatermark,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:b,tabId:a.tabId,tabType:a.tabType}};var c=function(a){var c=a.openWatermark<a.closeWatermark;if(c)return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:a.closeWatermark,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:b,tabId:a.tabId,tabType:a.tabType};else return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:b,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:a.openWatermark,tabId:a.tabId,tabType:a.tabType}};return e([{inserter:a,tabConfig:{shouldFocus:!0},tabType:{initialTokens:[],secureThreadToggleEnabled:!1,type:d("MWChatStateV2Types").MWChatStateTabType.ComposeTab},type:d("MWChatStateV2Types").MWChatStateActionsType.UpsertTab,updater:c}])},"chatheadsNewMessage")},m=c("MWV2PreloadComposeTab")(),n=m[0];m=m[1];var o=h._("__JHASH__lMGuJRoIOm8__JHASH__");return k.jsx(c("MWXTooltip.react"),{align:"middle",position:"start",tooltip:o.toString(),children:k.jsx(c("MWXPressable.react"),{"aria-label":o,onFocusChange:b,onHoverChange:a,onHoverIn:n,onHoverOut:m,onPress:j,testid:void 0,xstyle:function(){return[l.button]},children:k.jsx(c("CometTintedIcon.react"),{color:"primary",icon:d("fbicon")._(i("507172"),20)})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2ChatHeads.react",["CometErrorBoundary.react","CometHeroInteractionWithDiv.react","CometPlaceholder.react","I64","JSResourceForInteraction","MWChatInteraction","MWChatStateContext","MWChatStateV2HeadGroups","MWChatStateV2TabGroups","MWChatStateV2Types","MWV2ChatHeadCond.react","MWV2ChatHeadsLayout.react","MWV2ChatOptionsHead.react","MWV2ComposeHead.react","MWXGlimmer.react","WebUXLoggingEntryPointContextProvider","gkx","lazyLoadComponent","react","useMWChatStateV2MaxTabCount"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react")),k=h.useState,l={glimmer:{borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",height:"xsdox4t",width:"x1useyqa",$$css:!0},glimmerContainer:{alignItems:"x6s0dn4",display:"x78zum5",height:"xsdox4t",justifyContent:"xl56j7k",marginBottom:"xyorhqc",width:"x1useyqa",$$css:!0}};function m(a){a=a.index;return!c("gkx")("3599")?null:j.jsx("div",{className:"x6s0dn4 x78zum5 xsdox4t xl56j7k xyorhqc x1useyqa",children:j.jsx(c("MWXGlimmer.react"),{index:a,xstyle:l.glimmer})})}m.displayName=m.name+" [from "+f.id+"]";var n=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatHead.react").__setRef("MWV2ChatHeads.react")),o=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatOverflowHead.react").__setRef("MWV2ChatHeads.react"));function p(a){return{transform:"translateY(-"+Math.imul(a,58)+"px)"}}function q(a){return{transform:"translateY(-"+(Math.imul(a,58)-12)+"px"}}function a(a){a=a.isMediaViewer;var b=d("MWChatStateContext").useChatState(function(a){return[a.tabs,a.focusedTabId,a.mediaViewerOpenWatermark]}),e=b[0],f=b[1];b=b[2];var g=c("useMWChatStateV2MaxTabCount")(a);f=d("MWChatStateV2TabGroups").getTabGroups(b,e,f,g);g=f.openExcessTabs;f=f.openTabs;a=d("MWChatStateV2HeadGroups").getHeadGroups(a?b:void 0,g,e,5);b=a[0];g=a[1];e=f.length;a=b.length;var h=g.length>0?1:0;f=k(!1);var l=f[0],r=f[1],s;f=g[0];var t=c("MWV2ChatHeadCond.react")?c("MWV2ChatHeadCond.react"):n;if(g.length===1&&f.tabType.type!==d("MWChatStateV2Types").MWChatStateTabType.ComposeTab){f=f.tabType.threadKeyDescriptor;s=j.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:j.jsx(c("CometPlaceholder.react"),{fallback:j.jsx(m,{index:a+1}),children:j.jsx(t,{onFocusChange:r,onHoverChange:r,style:p(1),tab:g[0],threadKeyDescriptor:f})})},(i||(i=d("I64"))).to_string(f.threadKey))}else g.length>1&&(s=j.jsx(c("CometPlaceholder.react"),{fallback:j.jsx(m,{index:a+1}),children:j.jsx(o,{excessHeads:g,onHoverChange:r,style:p(1)})}));return j.jsx(d("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider,{value:"chat_heads",children:j.jsx(c("CometHeroInteractionWithDiv.react"),{interactionDesc:"Comet initial load to chatheads VC",interactionUUID:d("MWChatInteraction").get(d("MWChatInteraction").MW_CHATHEADS_LOAD),children:j.jsxs(c("MWV2ChatHeadsLayout.react"),{children:[c("MWV2ChatOptionsHead.react")!=null&&(e>0||a>0)?j.jsx(c("MWV2ChatOptionsHead.react"),{isVisible:l,openTabCount:e,style:q(a+h+1)}):null,b.reverse().map(function(a,b){var e=a.tabType;if(e.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return null;var f=b+h+1;return j.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:j.jsx(c("CometPlaceholder.react"),{fallback:j.jsx(m,{index:b}),children:j.jsx(t,{onFocusChange:r,onHoverChange:r,style:p(f),tab:a,threadKeyDescriptor:e.threadKeyDescriptor})})},(i||(i=d("I64"))).to_string(e.threadKeyDescriptor.threadKey))}),s,j.jsx(c("MWV2ComposeHead.react"),{onFocusChange:r,onHoverChange:r})]})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2ChatTabsLayout.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){a=a.children;a=a;return i.jsx("div",{className:"x1ey2m1c x78zum5 x164qtfw xixxii4 x1vjfegm","data-testid":void 0,children:a})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useMWEnsureCutoverOpenThreadExists",["Int64Hooks","LSFactory","LSIntEnum","LSVerifyThreadRowExistsStoredProcedure","MAWThreadCutover","promiseDone","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=(i||(i=c("useReStore")))(),e=d("MAWThreadCutover").useGetCutoverOpenThreadKey(a),f=d("MAWThreadCutover").useCutoverOpenThread(a);d("Int64Hooks").useEffectInt64(function(){e!=null&&f==null&&c("promiseDone")(b.runInTransaction(function(a){return c("LSVerifyThreadRowExistsStoredProcedure")(c("LSFactory")(a),{syncGroup:(h||(h=d("LSIntEnum"))).ofNumber(1),threadKey:e})},"readwrite"))},[f,e,b,a])}g["default"]=a}),98);
__d("MWV2ChatTabs.react",["CometErrorBoundary.react","CometPlaceholder.react","HeroInteractionIgnoreWithDiv.react","I64","JSResourceForInteraction","MAWEditMessageContext.react","MWChatInteraction","MWChatStateContext","MWChatStateV2CompareTabs","MWChatStateV2TabGroups","MWChatStateV2Types","MWPReplyContext.react","MWV2ChatTabLoadingWithGlimmers.react","MWV2ChatTabsLayout.react","MWV2IsTabFocusedContext.react","cr:7101","gkx","hero-tracing","lazyLoadComponent","react","useCometDisplayTimingTrackerForInteraction","useMWChatStateV2MaxTabCount","useMWEnsureCutoverOpenThreadExists","useMWV2EnsureThatChatTabExists"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react"));e=h;var k=e.useCallback,l=e.useContext;e=b("cr:7101")||{};var m=e.MWComposerKeyCommandFocusManager,n=e.MWComposerKeyCommandFocusManagerTabIndex,o=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ComposeTab.react").__setRef("MWV2ChatTabs.react")),p=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatTab.react").__setRef("MWV2ChatTabs.react")),q=c("gkx")("78")?function(a){var b=a.isMinimized,d=a.tab;a=a.threadKeyDescriptor;c("useMWV2EnsureThatChatTabExists")(a.threadKey,a.threadType,a.clientThreadKey);c("useMWEnsureCutoverOpenThreadExists")(a.threadKey);return j.jsx(p,{isMinimized:b,tab:d,threadKeyDescriptor:a})}:p;function a(a){a=a.isMediaViewer;var b=l(d("MWChatStateContext").stateContext),e=d("MWChatStateContext").useChatState(function(a){return[a.focusedTabId,a.mediaViewerOpenWatermark]}),f=e[0];e=e[1];var g=c("useMWChatStateV2MaxTabCount")(a);a=d("MWChatStateV2TabGroups").getTabGroups(a?e:void 0,b.tabs,f,g);e=a.minimizedTabs;b=a.openExcessTabs;var h=a.openTabs,p=k(function(a){if(a.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return null;else return d("MWChatInteraction").get((i||(i=d("I64"))).to_string(a.threadKeyDescriptor.threadKey))},[]),r=c("useCometDisplayTimingTrackerForInteraction")("ChatMain",!0);g=c("gkx")("1368")?[].concat(h,e,b).sort(d("MWChatStateV2CompareTabs").byMostRecentOpened):h;a=g.map(function(a,b){var e=f===a.tabId,g=a.tabType,i=null,k=h.indexOf(a)===-1;g.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab?i=j.jsx(o,{initialTokens:g.initialTokens,tab:a}):i=j.jsx(q,{isMinimized:k,tab:a,threadKeyDescriptor:g.threadKeyDescriptor});g=j.jsx(d("MWV2IsTabFocusedContext.react").MWV2IsTabFocusedContextProvider,{isFocused:e,children:j.jsx(d("MWPReplyContext.react").MWPReplyContextProvider,{children:j.jsx(d("MAWEditMessageContext.react").MAWEditMessageContext,{children:j.jsx(c("HeroInteractionIgnoreWithDiv.react"),{children:j.jsx(d("hero-tracing").HeroInteraction,{alwaysMarkMutationRootAsVisualChange:c("gkx")("1368"),interactionDesc:"MWV2_CHAT_TAB",interactionUUID:p(a.tabType),pageletName:"ChatTab",ref:r,children:j.jsx(c("CometPlaceholder.react"),{fallback:k?null:j.jsx(c("MWV2ChatTabLoadingWithGlimmers.react"),{tab:a}),children:i})})})})})});return j.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:n==null?g:j.jsx(n,{value:b,children:g})},String(a.tabId))});return j.jsx(c("MWV2ChatTabsLayout.react"),{children:m==null?a:j.jsx(m,{children:a})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useMWChatInit",["MWLSCommunityChatPopper","MWPGetThreadTitle","ReQL","ReQLSuspense","promiseDone","react","useMWLSChatPopperUpper","useReStore","useSubscribeToErrorTableAndShowToast"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useEffect;function a(){var a=(h||(h=c("useReStore")))();j(function(){var b;c("promiseDone")((b=d("ReQL")).toArrayAsync(b.fromTableAscending(a.table("threads")).map(function(b){return[b,d("ReQLSuspense").toArray(d("ReQL").leftJoin(d("ReQL").fromTableAscending(a.table("participants"),[]).getKeyRange(b.threadKey),d("ReQL").fromTableAscending(a.table("contacts"))).take(d("MWPGetThreadTitle").amountToFetchForTitle),f.id+":34")]}).take(30)));c("promiseDone")(b.toArrayAsync(b.fromTableAscending(a.table("pinned_threads").index("pinnedTimestamp"))));c("promiseDone")(b.toArrayAsync(b.fromTableAscending(a.table("community_folders"))))},[a]);c("useSubscribeToErrorTableAndShowToast")();var b=!0;c("useMWLSChatPopperUpper")(a,b);d("MWLSCommunityChatPopper").useOpenCommunityChatTabs(a,b)}g["default"]=a}),98);
__d("useMWV2ChatUpdateMediaViewerOpenWatermark",["MWChatStateActions","MWChatStateV2.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useCallback;function a(){var a=d("MWChatStateV2.react").useDispatch();return i(function(){var b=Date.now();a(d("MWChatStateActions").updateMediaViewerOpenWatermark(b))},[a])}g["default"]=a}),98);
__d("MWV2CookieWriter",["DeferredCookie","I64","MWCMThreadTypes.react","MWChatStateV2Types","Promise","ReQL","promiseDone","qex","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){switch(Number((i||(i=d("I64"))).to_string(a))){case 2:return"g.";case 15:return"sc.";case 16:return"sg.";case 18:return"cg.";case 19:return"cgu.";case 23:return"cbj.";case 24:return"cbu.";case 21:return"cphj.";case 22:return"cphu.";case 150:return"dp.";case 151:return"dpu.";case 152:return"dpb.";case 153:return"dpbu.";case 154:return"dp2.";case 155:return"dp2u.";default:return"u."}}function a(a,e,f){var g=function(a){if(e==null)return!1;var b=e.tabType;if(b.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return!1;else return(i||(i=d("I64"))).equal(b.threadKeyDescriptor.threadKey,a)},k=function(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(f.table("threads")).getKeyRange(a))},l={contents:void 0};a=a.map(function(a){var c=a.threadType,e=a.threadKey,f={o:a.isOpen?1:0};return k(e).then(function(a){if(a!=null)if(g(e)){d("MWCMThreadTypes.react").isJoinedCMThread(c)&&(l.contents=(i||(i=d("I64"))).to_string(a.parentThreadKey));return(h||(h=b("Promise"))).resolve()}else{f.i=j(c)+(i||(i=d("I64"))).to_string(e);d("MWCMThreadTypes.react").isJoinedCMThread(c)&&(f.p=(i||(i=d("I64"))).to_string(a.parentThreadKey));return(h||(h=b("Promise"))).resolve(f)}else{f.i=j(c)+(i||(i=d("I64"))).to_string(e);return(h||(h=b("Promise"))).resolve(f)}})});a=(h||(h=b("Promise"))).all(a).then(function(a){var f;if(e!=null){var g=e.tabType;if(g.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)f=void 0;else{g=g.threadKeyDescriptor;f=j(g.threadType)+(i||(i=d("I64"))).to_string(g.threadKey)}}else f=void 0;g=a.filter(function(a){return a!=null});a=l.contents;a=a!=null?JSON.stringify({lm3:f,lm3p:a,t3:g,utc3:Date.now(),v:1}):JSON.stringify({lm3:f,t3:g,utc3:Date.now(),v:1});if(a!=null){c("DeferredCookie").addToQueue("presence","C"+a,(f=c("qex")._("513"))!=null?f:0,"/",!1,!1,!0)}else c("recoverableViolation")("Failed to serialize cookie","messenger_comet");return(h||(h=b("Promise"))).resolve()});c("promiseDone")(a)}g.write=a}),98);
__d("useMWV2CookieWriter",["MWChatStateContext","MWChatStateV2CompareTabs","MWChatStateV2IsOpen","MWChatStateV2Types","MWV2CookieWriter","gkx","qex","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useEffect;function a(){var a=d("MWChatStateContext").useChatState(function(a){return a.tabs}),b=(h||(h=c("useReStore")))();j(function(){var e=Array.from(a.values()).filter(function(a){return d("MWChatStateV2IsOpen").isOpen(void 0,a)}).sort(d("MWChatStateV2CompareTabs").byMostRecentOpened)[0],f=[];Array.from(a.values()).filter(function(a){if(a.openWatermark>a.closeWatermark)return!0;else return a.minimizeWatermark>a.closeWatermark}).sort(function(a,b){var c=d("MWChatStateV2CompareTabs").byMostRecentMinimized(a,b);if(c===0)return d("MWChatStateV2CompareTabs").byMostRecentOpened(a,b);else return c}).forEach(function(a){var b=a.tabType;if(b.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return;f.push(babelHelpers["extends"]({},b.threadKeyDescriptor,{isOpen:c("qex")._("537")?d("MWChatStateV2IsOpen").isOpen(void 0,a):!1}))});d("MWV2CookieWriter").write(f,e,b)},[b,a])}b=c("gkx")("1812641")?a:function(){};e=b;g["default"]=e}),98);
__d("MWV2ChatTabsRoot.react",["CometContextualLayerAnchorRoot.react","CometPlaceholder.react","FocusRegion.react","MWChatStateV2.react","MWChatVisibilityOverrideContext","MWFallbackWithTimeout.react","MWLSThreadDisplayContext","MWSetupPresenceReportingDeferred.react","MWV2ChatHeads.react","MWV2ChatTabs.react","WebUXLoggingEntryPointContextProvider","cr:4565","cr:571","cr:905","focusScopeQueries","gkx","qex","react","stylex","useMWChatInit","useMWIsOnPushView","useMWIsTopLevelRouteMediaViewerExperiment","useMWV2ChatUpdateMediaViewerOpenWatermark","useMWV2CookieWriter","useShouldShowMessagingEntrypointInCometRoot"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react"));e=i;var k=e.useEffect,l=e.useMemo,m=(e=b("cr:905"))!=null?e:function(){},n=(e=b("cr:571"))!=null?e:function(){return!1},o={chatAbovePushView:{zIndex:"x1vjfegm",$$css:!0},container:{alignItems:"xuk3077",display:"x78zum5",isolation:"xc8icb0",$$css:!0},hidden:{display:"x1s85apg",$$css:!0},root:{bottom:"x1ey2m1c",end:"xds687c",left:null,right:null,position:"xixxii4",$$css:!0}};function p(a){var e=a.isMediaViewer;a=a.showChatAbovePushView;var f=d("MWChatStateV2.react").useChatState(function(a){return a.tabs}),g=n(),i=l(function(){return Array.from(f.values()).some(function(a){return a.openWatermark>a.closeWatermark})},[f]);a=j.jsx(d("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider,{value:"popup_chat_box",children:j.jsx(d("MWLSThreadDisplayContext").MWLSThreadDisplayContextProvider,{value:"ChatTab",children:j.jsx("div",{className:(h||(h=c("stylex")))(o.root,a||c("gkx")("6264")?o.chatAbovePushView:!1,g?o.hidden:null),children:j.jsx(c("CometContextualLayerAnchorRoot.react"),{children:j.jsx("div",{className:"xuk3077 x78zum5 xc8icb0",children:j.jsx(d("FocusRegion.react").FocusRegion,{containFocusQuery:i?d("focusScopeQueries").tabbableScopeQuery:void 0,id:"MWV2ChatTabsRootChatTabsFocusRegion",children:j.jsxs(j.Fragment,{children:[j.jsx(c("MWV2ChatTabs.react"),{isMediaViewer:e}),j.jsx(c("MWV2ChatHeads.react"),{isMediaViewer:e})]})})})})})})});if(b("cr:4565")!=null)return j.jsx(b("cr:4565"),{children:a});else return a}p.displayName=p.name+" [from "+f.id+"]";function q(a){a=a.children;c("useMWV2CookieWriter")();c("useMWChatInit")();return a}q.displayName=q.name+" [from "+f.id+"]";function a(){var a=c("useMWIsOnPushView")(),b=c("useMWIsTopLevelRouteMediaViewerExperiment")(),e=d("MWChatVisibilityOverrideContext").useMWChatVisibilityOverride(b),f=c("useMWV2ChatUpdateMediaViewerOpenWatermark")(),g=c("useShouldShowMessagingEntrypointInCometRoot")(c("qex")._("122")===!0?"CHAT_TABS_ROOT":"CHAT")&&e;k(function(){b&&f()},[b,f]);m();return l(function(){return j.jsxs(c("CometPlaceholder.react"),{fallback:j.jsx(c("MWFallbackWithTimeout.react"),{message:"MWV2ChatTabsRoot suspense timeout"}),children:[j.jsx(c("MWSetupPresenceReportingDeferred.react"),{}),j.jsx(q,{children:g?j.jsx(p,{isMediaViewer:b,showChatAbovePushView:a}):null})]})},[g,a,b])}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2ChatContainer.react",["MWChatEncryptedBackupsHandleRestoreWrapperDeferred.react","MWV2ChatTabsRoot.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(){return i.jsxs(i.Fragment,{children:[i.jsx(c("MWV2ChatTabsRoot.react"),{}),i.jsx(c("MWChatEncryptedBackupsHandleRestoreWrapperDeferred.react"),{})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatBadgeCountUpdater.react",["CometRelay","LSIntEnum","MWChatBadgeCountUpdates.react","MWXacGating.bs","react","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useEffect;function a(){var a=d("CometRelay").useRelayEnvironment(),b=d("MWChatBadgeCountUpdates.react").useUnseenThreadCount((i||(i=d("LSIntEnum"))).ofNumber(0));j(function(){var e={suppress_xac_groups:!d("MWXacGating.bs").isGroupsEnabled()};a.commitUpdate(function(a){a=a.getRoot();if(a==null){c("recoverableViolation")("A store root must be present to move forward.","messenger_comet");return}a=a.getOrCreateLinkedRecord("viewer","Viewer");a=a.getOrCreateLinkedRecord("message_threads","ViewerMessageThreadsConnection");if(b!=null){var d=a.getValue("unseen_count",e);(d===null||d!==b)&&a.setValue(b,"unseen_count",e)}})},[a,b]);return null}g["default"]=a}),98);